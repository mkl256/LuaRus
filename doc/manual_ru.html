<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<TITLE>Lua 5.3 Reference Manual</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="lua.css">
<LINK REL="stylesheet" TYPE="text/css" HREF="manual.css">
<META HTTP-EQUIV="content-type" CONTENT="text/html; charset=UTF-8">
</HEAD>

<body> 
<title>Справочное руководство по Lua 5.3</title>
<link rel="stylesheet" type="text/css" href="lua.css">
<link rel="stylesheet" type="text/css" href="manual.css">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">




<h1>
<a href="http://www.lua.org/"><img src="logo.gif" alt="Lua"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Справочное руководство по Lua 5.3
</font></font></h1>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Роберто Иерусалимский, Луис Энрике де Фигейредо, Вальдемар Селес

</font></font></p><p>
<small><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Copyright © 2015–2017 Lua.org, PUC-Rio. </font><font style="vertical-align: inherit;">Бесплатно доступно в соответствии с условиями
 </font></font><a href="http://www.lua.org/license.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">лицензии Lua</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .
</font></font></small>

</p><div class="menubar">
<a href="contents_ru.html#contents"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">содержание</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
·
 </font></font><a href="contents_ru.html#index"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">индекс</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
·
 </font></font><a href="http://www.lua.org/manual/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">другие версии</font></font></a>
</div>

<!-- ====================================================================== -->
<p>

<!-- $Id: manual.of,v 1.167 2017/01/09 15:18:11 roberto Exp $ -->




</p><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 - </font></font><a name="1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Введение</font></font></a></h1>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua - мощный, эффективный, легкий, встраиваемый язык сценариев. </font><font style="vertical-align: inherit;">Он поддерживает процедурное программирование, объектно-ориентированное программирование, функциональное программирование, программирование на основе данных и описание данных.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua сочетает простой процедурный синтаксис с мощными конструкциями описания данных, основанными на ассоциативных массивах и расширяемой семантике. </font><font style="vertical-align: inherit;">Lua динамически типизируется, работает путем интерпретации байт-кода с помощью виртуальной машины на основе регистров и имеет автоматическое управление памятью с постепенным сбором мусора, что делает его идеальным для настройки, создания сценариев и быстрого прототипирования.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua реализован в виде библиотеки, написанной на </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">чистом C</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , общем подмножестве стандартов C и C ++. </font><font style="vertical-align: inherit;">Дистрибутив Lua включает в себя хост-программу под названием </font></font><code>lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, которая использует библиотеку Lua для предоставления полного автономного интерпретатора Lua для интерактивного или пакетного использования. </font><font style="vertical-align: inherit;">Lua предназначен для использования как в качестве мощного, легкого, встраиваемого языка сценариев для любой программы, которая в нем нуждается, так и в качестве мощного, но легкого и эффективного автономного языка.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В качестве языка расширения Lua не имеет понятия «основная» программа: она работает </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">встроенной</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> в хост-клиент, называемый программой </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">встраивания</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> или просто </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">хостом</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">(Часто этот хост является автономной </font></font><code>lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">программой.) Хост-программа может вызывать функции для выполнения фрагмента кода Lua, может записывать и читать переменные Lua и может регистрировать функции C, которые будут вызываться кодом Lua. </font><font style="vertical-align: inherit;">Благодаря использованию функций C Lua может быть расширен для работы с широким спектром различных областей, создавая, таким образом, настраиваемые языки программирования с общей синтаксической структурой.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua является свободным программным обеспечением и предоставляется как обычно без каких-либо гарантий, как указано в его лицензии. </font><font style="vertical-align: inherit;">Реализация, описанная в этом руководстве, доступна на официальном веб-сайте Lua </font></font><code>www.lua.org</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Как и любое другое справочное руководство, этот документ местами сухой. </font><font style="vertical-align: inherit;">Для обсуждения решений, лежащих в основе дизайна Lua, см. Технические документы, доступные на веб-сайте Lua. </font><font style="vertical-align: inherit;">Подробное введение в программирование на Lua см. В книге Роберто « </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Программирование на Lua»</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .



</font></font></p><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 - </font></font><a name="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Основные понятия</font></font></a></h1>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В этом разделе описываются основные понятия языка.



</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1 - </font></font><a name="2.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Значения и типы</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua - это </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">динамически типизированный язык</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Это означает, что переменные не имеют типов; </font><font style="vertical-align: inherit;">только значения делают. </font><font style="vertical-align: inherit;">В языке нет типовых определений. </font><font style="vertical-align: inherit;">Все значения имеют свой тип.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Все значения в Lua являются </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">первоклассными значениями</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Это означает, что все значения могут храниться в переменных, передаваться в качестве аргументов другим функциям и возвращаться в качестве результатов.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В Lua существует восемь основных типов:
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boolean</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">number</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">строка</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функция</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">userdata</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">thread</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">таблица</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Тип </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> имеет одно значение </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , основное свойство которого должно отличаться от любого другого значения; </font><font style="vertical-align: inherit;">обычно это означает отсутствие полезной ценности. </font><font style="vertical-align: inherit;">Тип </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boolean</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> имеет два значения: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">И </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ложь</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> делают условие ложным; </font><font style="vertical-align: inherit;">любое другое значение делает это правдой. </font><font style="vertical-align: inherit;">Типовое </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">число</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет собой как целые числа, так и действительные (с плавающей запятой) числа. </font><font style="vertical-align: inherit;">Типовая </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">строка</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет неизменяемые последовательности байтов. </font><font style="vertical-align: inherit;">Lua 8-битный чистый: строки могут содержать любое 8-битное значение, включая встроенные нули (' </font></font><code>\0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'). </font><font style="vertical-align: inherit;">Lua также не зависит от кодировки; </font><font style="vertical-align: inherit;">он не делает никаких предположений относительно содержимого строки.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Типовое </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">число</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> использует два внутренних представления или два подтипа, один из которых называется </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">целым числом,</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> а другой - </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">float</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">У Lua есть четкие правила относительно того, когда используется каждое представление, но он также автоматически конвертируется между ними (см. </font></font><a href="#3.4.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Поэтому программист может по большей части игнорировать разницу между целыми числами и числами с плавающей запятой или взять на себя полный контроль над представлением каждого числа. </font><font style="vertical-align: inherit;">Стандартный Lua использует 64-разрядные целые числа и числа с плавающей запятой двойной (64-разрядной), но вы также можете скомпилировать Lua так, чтобы он использовал 32-разрядные целые числа и / или числа с одинарной точностью (32-разрядные). </font><font style="vertical-align: inherit;">Вариант с 32 битами как для целых чисел, так и для чисел с плавающей точкой особенно привлекателен для небольших машин и встроенных систем. </font><font style="vertical-align: inherit;">(Смотрите макрос </font></font><code>LUA_32BITS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в файле </font></font><code>luaconf.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua может вызывать (и манипулировать) функции, написанные на Lua, и функции, написанные на C (см. </font></font><a href="#3.4.10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.10</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Оба представлены </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функцией типа</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Тип </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">userdata</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> предоставлен, чтобы позволить произвольным данным C быть сохраненными в переменных Lua. </font><font style="vertical-align: inherit;">Значение userdata представляет блок необработанной памяти. </font><font style="vertical-align: inherit;">Существует два вида пользовательских данных:
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">полные пользовательские данные</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , которые представляют собой объект с блоком памяти, управляемым Lua, и </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">легкие пользовательские данные</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , которые являются просто значением указателя Си. </font><font style="vertical-align: inherit;">Userdata не имеет предопределенных операций в Lua, кроме назначения и проверки личности. </font><font style="vertical-align: inherit;">Используя </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метатаблицы</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , программист может определять операции для полных значений пользовательских данных (см. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Значения пользовательских данных не могут быть созданы или изменены в Lua, только через C API. </font><font style="vertical-align: inherit;">Это гарантирует целостность данных, принадлежащих хост-программе.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Тип </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">резьбы</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет собой независимые потоки выполнения , </font><font style="vertical-align: inherit;">и используется для реализации сопрограмм (см </font></font><a href="#2.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Потоки Lua не связаны с потоками операционной системы. </font><font style="vertical-align: inherit;">Lua поддерживает сопрограммы во всех системах, даже в тех, которые не поддерживают потоки изначально.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Типовая </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">таблица</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> реализует ассоциативные массивы, то есть массивы, которые можно индексировать не только с помощью чисел, но и с любым значением Lua, кроме </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и NaN. </font><font style="vertical-align: inherit;">(« </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Не число»</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - это специальное значение, используемое для представления неопределенных или непредставляемых числовых результатов, например </font></font><code>0/0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.) Таблицы могут быть </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">разнородными</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">то есть они могут содержать значения всех типов (кроме </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Любой ключ со значением </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> не считается частью таблицы. </font><font style="vertical-align: inherit;">И наоборот, любой ключ, который не является частью таблицы, имеет ассоциированное значение </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Таблицы являются единственным механизмом структурирования данных в Lua; </font><font style="vertical-align: inherit;">их можно использовать для представления обычных массивов, списков, таблиц символов, наборов, записей, графиков, деревьев и т. д. Для представления записей Lua использует имя поля в качестве индекса. </font><font style="vertical-align: inherit;">Язык поддерживает это представление, предоставляя в </font></font><code>a.name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">качестве синтаксического сахара для </font></font><code>a["name"]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Существует несколько удобных способов создания таблиц в Lua (см. </font></font><a href="#3.4.9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.9</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Как и индексы, значения полей таблицы могут быть любого типа. </font><font style="vertical-align: inherit;">В частности, поскольку функции являются первоклассными значениями, поля таблицы могут содержать функции. </font><font style="vertical-align: inherit;">Таким образом, таблицы могут также содержать </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">методы</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (см. </font></font><a href="#3.4.11"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.11</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Индексирование таблиц следует определению сырого равенства в языке. </font><font style="vertical-align: inherit;">Выражения </font></font><code>a[i]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>a[j]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
обозначают один и </font><font style="vertical-align: inherit;">тот же элемент Таблицы тогда и только тогда , </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">сырые равно (то есть равно без метаметоды). </font><font style="vertical-align: inherit;">В частности, числа с плавающей точкой с целыми значениями равны их целым числам (например, </font></font><code>1.0 == 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Чтобы избежать неоднозначностей, любое число с плавающей точкой, используемое в качестве ключа, преобразуется в соответствующее ему целое число. </font><font style="vertical-align: inherit;">Например, если вы напишите </font></font><code>a[2.0] = true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, фактический ключ, вставленный в таблицу, будет целым числом </font></font><code>2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(С другой стороны, 2 и " </font></font><code>2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" - это разные значения Lua и поэтому обозначают разные записи таблицы.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Таблицы, функции, потоки и (полные) значения пользовательских данных являются </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">объектами</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : переменные на самом деле не </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">содержат</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> этих значений, только </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ссылки</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> на них. </font><font style="vertical-align: inherit;">Присваивание, передача параметров и возврат функций всегда манипулируют ссылками на такие значения; </font><font style="vertical-align: inherit;">эти операции не подразумевают какого-либо копирования.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Функция библиотеки </font></font><a href="#pdf-type"><code>тип</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает строку, описывающую тип заданного значения (см. </font></font><a href="#6.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2 - </font></font><a name="2.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Окружающая среда и глобальная среда</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Как будет обсуждено в </font></font><a href="#3.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§ 3.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><a href="#3.3.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.3.3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , любая ссылка на свободное имя (то есть имя не ограничиваясь какой - </font><font style="vertical-align: inherit;">либо декларации) </font></font><code>var</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
синтаксически переводится на </font></font><code>_ENV.var</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Более того, каждый чанк компилируется в области видимости внешней локальной переменной </font></font><code>_ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(см. </font></font><a href="#3.3.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.3.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), поэтому </font></font><code>_ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">сам по себе никогда не является свободным именем в чанке.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Несмотря на существование этой внешней </font></font><code>_ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">переменной и перевод свободных имен,
 </font></font><code>_ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это вполне регулярное имя. </font><font style="vertical-align: inherit;">В частности, вы можете определить новые переменные и параметры с этим именем. </font><font style="vertical-align: inherit;">Каждая ссылка на свободное имя использует то, </font></font><code>_ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">что видно в этой точке программы, следуя обычным правилам видимости Lua (см. </font></font><a href="#3.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Любая таблица, используемая в качестве значения, </font></font><code>_ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">называется </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">средой</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua сохраняет особую среду, называемую </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">глобальной</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Это значение хранится в специальном индексе в реестре C (см. </font></font><a href="#4.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">В Lua глобальная переменная </font></font><a href="#pdf-_G"><code>_G</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">инициализируется с тем же значением. </font><font style="vertical-align: inherit;">( </font></font><a href="#pdf-_G"><code>_G</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">никогда не используется внутри.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда Lua загружает чанк, значением по умолчанию для его </font></font><code>_ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">upvalue является глобальная среда (см. </font></font><a href="#pdf-load"><code>загрузить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Поэтому по умолчанию свободные имена в коде Lua относятся к записям в глобальной среде (и, следовательно, они также называются </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">глобальными переменными</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Более того, все стандартные библиотеки загружаются в глобальную среду, и некоторые функции там работают в этой среде. </font><font style="vertical-align: inherit;">Вы можете использовать </font></font><a href="#pdf-load"><code>загрузить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(или </font></font><a href="#pdf-loadfile"><code>загрузитьфайл</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) для загрузки чанка с другой средой. </font><font style="vertical-align: inherit;">(В C вы должны загрузить чанк, а затем изменить значение его первого повышения.)





</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3 - </font></font><a name="2.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Обработка ошибок</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Поскольку Lua является встроенным языком расширений, все действия Lua начинаются с кода C в основной программе, вызывающей функцию из библиотеки Lua. </font><font style="vertical-align: inherit;">(Когда вы используете Lua standalone, </font></font><code>lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">приложение является программой хоста.) Всякий раз, когда во время компиляции или выполнения фрагмента Lua происходит ощибка, элемент управления возвращается к хосту, который может принять соответствующие меры (например, распечатать сообщение ощибка).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Код Lua может явно генерировать ощибку, вызывая
 </font></font><a href="#pdf-error"><code>ощибка</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функцию. </font><font style="vertical-align: inherit;">Если вам нужно отлавливать ошибки в Lua, вы можете использовать </font></font><a href="#pdf-pcall"><code>рвызов</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или </font></font><a href="#pdf-xpcall"><code>хрвызов</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
вызвать данную функцию в </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">защищенном режиме</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Всякий раз, когда существует ощибка, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">объект ощибка</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (также называемый </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">сообщением ощибка</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) распространяется с информацией об ощибке. </font><font style="vertical-align: inherit;">Сам Lua генерирует только ошибки, у которых объект ощибка является строкой, но программы могут генерировать ошибки с любым значением, как у объекта ощибка. </font><font style="vertical-align: inherit;">Это зависит от программы Lua или ее хоста для обработки таких ощибка объектов.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда вы используете </font></font><a href="#pdf-xpcall"><code>хрвызов</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или </font></font><a href="#lua_pcall"><code>lua_pcall</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, вы можете указать </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">обработчик сообщения для вызова</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
в случае ошибок. </font><font style="vertical-align: inherit;">Эта функция вызывается с исходным объектом ощибка и возвращает новый объект ощибка. </font><font style="vertical-align: inherit;">Он вызывается до того, как ощибка разматывает стек, так что он может собрать больше информации об ощибке, например, путем проверки стека и создания трассировки стека. </font><font style="vertical-align: inherit;">Этот обработчик сообщений все еще защищен защищенным вызовом; </font><font style="vertical-align: inherit;">Итак, ощибка внутри обработчика сообщений снова вызовет обработчик сообщений. </font><font style="vertical-align: inherit;">Если этот цикл продолжается слишком долго, Lua прерывает его и возвращает соответствующее сообщение. </font><font style="vertical-align: inherit;">(Обработчик сообщений вызывается только для обычных ошибок времени выполнения. Он не вызывается ни для ошибок выделения памяти, ни для ошибок во время выполнения финализаторов.)





</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.4 - </font></font><a name="2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Метатаблицы и метаметоды</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Каждое значение в Lua может иметь </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метатабельный</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Этот </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метатабль</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет собой обычную таблицу Lua, которая определяет поведение исходного значения при определенных специальных операциях. </font><font style="vertical-align: inherit;">Вы можете изменить некоторые аспекты поведения операций над значением, установив определенные поля в его метатаблице. </font><font style="vertical-align: inherit;">Например, когда нечисловое значение является операндом сложения, Lua проверяет функцию в поле « </font></font><code>__add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">» метатабельного значения. </font><font style="vertical-align: inherit;">Если он находит, Lua вызывает эту функцию для выполнения сложения.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ключ для каждого события в метатаблице - это строка с именем события, начинающимся с двух подчеркиваний; </font><font style="vertical-align: inherit;">соответствующие значения называются </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметодами</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">В предыдущем примере ключ « </font></font><code>__add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">», а метаметод - это функция, которая выполняет сложение.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вы можете запросить метатаблицу любого значения, используя </font></font><a href="#pdf-getmetatable"><code>дайметатаб</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функцию. </font><font style="vertical-align: inherit;">Lua запрашивает метаметоды в метатаблицах с использованием необработанного доступа (см. </font></font><a href="#pdf-rawget"><code>взятьнапрямую</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Итак, чтобы извлечь метаметод для события </font></font><code>ev</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в объекте </font></font><code>o</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Lua делает эквивалент следующего кода:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     взятьнапрямую (дайметатаб ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) или {}, "__ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ev</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ")
</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вы можете заменить метатаблицу таблиц, используя </font></font><a href="#pdf-setmetatable"><code>устметатаб</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функцию. </font><font style="vertical-align: inherit;">Вы не можете изменить метатабель других типов из кода Lua (кроме как с помощью библиотеки </font></font><a href="#6.10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">отладка</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font><a href="#6.10"><font style="vertical-align: inherit;">§6.10</font></a><font style="vertical-align: inherit;"> )); </font><font style="vertical-align: inherit;">Вы должны использовать C API для этого.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Таблицы и полные пользовательские данные имеют отдельные метатаблицы (хотя несколько таблиц и пользовательских данных могут совместно использовать свои метатаблицы). </font><font style="vertical-align: inherit;">Значения всех других типов имеют одну метатабельность на тип; </font><font style="vertical-align: inherit;">то есть существует одна метатабельная для всех чисел, одна для всех строк и т. д. По умолчанию значение не имеет метатабельной, но библиотека строк устанавливает метатаблицу для тип </font></font><a href="#6.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">строки</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (см. </font><a href="#6.4"><font style="vertical-align: inherit;">§6.4</font></a><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Метатабельный управляет тем, как ведет себя объект в арифметических операциях, побитовых операциях, сравнениях порядков, конкатенации, операции длины, вызовах и индексировании. </font><font style="vertical-align: inherit;">Метатабельный объект также может определять функцию, которая будет вызываться, когда пользовательские данные или </font></font><a href="#2.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">таблица</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> собираются сборщиком мусора ( </font><a href="#2.5"><font style="vertical-align: inherit;">§2.5</font></a><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Для унарных операторов (отрицание, длина и побитовое НЕ) метаметод вычисляется и вызывается с фиктивным вторым операндом, равным первому. </font><font style="vertical-align: inherit;">Этот дополнительный операнд предназначен только для упрощения внутренних функций Lua (заставляя эти операторы вести себя как двоичные операции) и может быть удален в будущих версиях. </font><font style="vertical-align: inherit;">(Для большинства случаев этот дополнительный операнд не имеет значения.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Подробный список событий, контролируемых метатаблицами, приведен ниже. </font><font style="vertical-align: inherit;">Каждая операция идентифицируется соответствующим ключом.



</font></font></p><ul>

<li><b><code>__add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>+</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> операция </font><font style="vertical-align: inherit;">
сложения ( </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Если какой-либо операнд для добавления не является числом (или строкой, принудительно вводимой для числа), Lua попытается вызвать метаметод. </font><font style="vertical-align: inherit;">Сначала Lua проверит первый операнд (даже если он действителен). </font><font style="vertical-align: inherit;">Если этот операнд не определяет метаметод для </font></font><code>__add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, то Lua проверит второй операнд. </font><font style="vertical-align: inherit;">Если Lua может найти метаметод, он вызывает метаметод с двумя операндами в качестве аргументов, а результат вызова (настроенный на одно значение) является результатом операции. </font><font style="vertical-align: inherit;">В противном случае, это вызывает ощибка.
</font></font></li>

<li><b><code>__sub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> операция </font><font style="vertical-align: inherit;">
вычитания ( </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Поведение аналогично операции сложения.
</font></font></li>

<li><b><code>__mul</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> операция </font><font style="vertical-align: inherit;">
умножения ( </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Поведение аналогично операции сложения.
</font></font></li>

<li><b><code>__div</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> операция </font><font style="vertical-align: inherit;">
деления ( </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Поведение аналогично операции сложения.
</font></font></li>

<li><b><code>__mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> операция </font><font style="vertical-align: inherit;">
по модулю ( </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Поведение аналогично операции сложения.
</font></font></li>

<li><b><code>__pow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>^</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> операция </font><font style="vertical-align: inherit;">
возведения в степень ( </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Поведение аналогично операции сложения.
</font></font></li>

<li><b><code>__unm</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
отрицательная (унарная </font></font><code>-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) операция. </font><font style="vertical-align: inherit;">Поведение аналогично операции сложения.
</font></font></li>

<li><b><code>__idiv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
разделение пола ( </font></font><code>//</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) операция. </font><font style="vertical-align: inherit;">Поведение аналогично операции сложения.
</font></font></li>

<li><b><code>__band</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
побитовая </font></font><code>&amp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">операция </font><font style="vertical-align: inherit;">И ( </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Поведение аналогично операции сложения, за исключением того, что Lua будет пытаться использовать метаметод, если какой-либо операнд не является ни целым числом, ни значением, приводимым к целому числу (см. </font></font><a href="#3.4.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).
</font></font></li>

<li><b><code>__bor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
побитовая </font></font><code>|</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">операция </font><font style="vertical-align: inherit;">ИЛИ ( </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Поведение аналогично побитовой операции И.
</font></font></li>

<li><b><code>__bxor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
битовая исключающая </font></font><code>~</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">операция </font><font style="vertical-align: inherit;">ИЛИ (двоичная </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Поведение аналогично побитовой операции И.
</font></font></li>

<li><b><code>__bnot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
побитовое НЕ (унарное </font></font><code>~</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) действие. </font><font style="vertical-align: inherit;">Поведение аналогично побитовой операции И.
</font></font></li>

<li><b><code>__shl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>&lt;&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> операция </font><font style="vertical-align: inherit;">
побитового сдвига влево ( </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Поведение аналогично побитовой операции И.
</font></font></li>

<li><b><code>__shr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>&gt;&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> операция </font><font style="vertical-align: inherit;">
побитового сдвига вправо ( </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Поведение аналогично побитовой операции И.
</font></font></li>

<li><b><code>__concat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>..</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> операция </font><font style="vertical-align: inherit;">
конкатенации ( </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Поведение аналогично операции сложения, за исключением того, что Lua будет пытаться использовать метаметод, если какой-либо операнд не является ни строкой, ни числом (которое всегда является принудительным для строки).
</font></font></li>

<li><b><code>__len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>#</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> операция </font><font style="vertical-align: inherit;">
length ( </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Если объект не является строкой, Lua попробует его метаметод. </font><font style="vertical-align: inherit;">Если есть метаметод, Lua вызывает его с помощью объекта в качестве аргумента, а результат вызова (всегда настроенный на одно значение) является результатом операции. </font><font style="vertical-align: inherit;">Если метаметода нет, но объект является таблицей, тогда Lua использует операцию длины </font></font><a href="#3.4.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">таблицы</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (см. </font><a href="#3.4.7"><font style="vertical-align: inherit;">§3.4.7</font></a><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Иначе Луа поднимает ощибку.
</font></font></li>

<li><b><code>__eq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>==</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> операция </font><font style="vertical-align: inherit;">
равенства ( </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Поведение аналогично операции сложения, за исключением того, что Lua будет пытаться использовать метаметод только тогда, когда сравниваемые значения являются либо обеими таблицами, либо обоими полными пользовательскими данными, и они не равны примитивно. </font><font style="vertical-align: inherit;">Результат вызова всегда преобразуется в логическое значение.
</font></font></li>

<li><b><code>__lt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> операция </font><font style="vertical-align: inherit;">
меньше чем ( </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Поведение аналогично операции сложения, за исключением того, что Lua будет пытаться использовать метаметод, только когда сравниваемые значения не являются ни числами, ни обеими строками. </font><font style="vertical-align: inherit;">Результат вызова всегда преобразуется в логическое значение.
</font></font></li>

<li><b><code>__le</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
менее равная ( </font></font><code>&lt;=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) операция. </font><font style="vertical-align: inherit;">В отличие от других операций, операция менее равных может использовать два разных события. </font><font style="vertical-align: inherit;">Во-первых, Луа ищет </font></font><code>__le</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметод в обоих операндах, как в операции «меньше, чем». </font><font style="vertical-align: inherit;">Если он не может найти такой метаметод, то он попробует </font></font><code>__lt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметод, предполагая, что </font></font><code>a &lt;= b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это эквивалентно </font></font><code>not (b &lt; a)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Как и в случае других операторов сравнения, результат всегда является логическим. </font><font style="vertical-align: inherit;">(Это использование </font></font><code>__lt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">события может быть удалено в будущих версиях; оно также медленнее, чем настоящий </font></font><code>__le</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметод.)
</font></font></li>

<li><b><code>__index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Индексирование доступа </font></font><code>таблица[key]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Это событие происходит, когда </font></font><code>таблица</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нет таблицы или когда </font></font><code>key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нет в </font></font><code>таблица</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Метаметод ищется в </font></font><code>таблица</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Несмотря на название, метаметод этого события может быть либо функцией, либо таблицей. </font><font style="vertical-align: inherit;">Если это функция, она вызывается с </font><font style="vertical-align: inherit;">аргументами </font></font><code>таблица</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и в </font></font><code>key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">качестве аргументов, а результат вызова (с одним значением) является результатом операции. </font><font style="vertical-align: inherit;">Если это таблица, конечный результат будет результатом индексации этой таблицы </font></font><code>key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(Это индексирование является обычным, а не необработанным, и поэтому может вызывать другой метаметод.)
</font></font></p></li>

<li><b><code>__newindex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Назначение индексации </font></font><code>таблица[key] = value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Подобно событию index, это событие происходит, когда </font></font><code>таблица</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нет таблицы или когда </font></font><code>key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ее нет в </font></font><code>таблица</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Метаметод ищется в </font></font><code>таблица</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Как и в случае с индексированием, метаметод этого события может быть функцией или таблицей. </font><font style="vertical-align: inherit;">Если это функция, она вызывается </font></font><code>таблица</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и в </font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">качестве аргументов. </font><font style="vertical-align: inherit;">Если это таблица, Lua выполняет индексирование для этой таблицы с тем же ключом и значением. </font><font style="vertical-align: inherit;">(Это назначение является обычным, а не необработанным, и поэтому может вызывать другой метаметод.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Всякий раз, когда есть </font></font><code>__newindex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметод, Lua не выполняет примитивное назначение. </font><font style="vertical-align: inherit;">(При необходимости сам метаметод может позвонить, </font></font><a href="#pdf-rawset"><code>сыраяуст</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
чтобы выполнить назначение.)
</font></font></p></li>

<li><b><code>__call</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Операция вызова </font></font><code>func(args)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Это событие происходит, когда Lua пытается вызвать нефункциональное значение (то </font></font><code>func</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть не является функцией). </font><font style="vertical-align: inherit;">Метаметод ищется в </font></font><code>func</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если присутствует, метаметод вызывается в </font></font><code>func</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">качестве первого аргумента, за которым следуют аргументы исходного вызова ( </font></font><code>args</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Все результаты звонка являются результатом операции. </font><font style="vertical-align: inherit;">(Это единственный метаметод, который позволяет получить несколько результатов.)
</font></font></li>

</ul>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Хорошей практикой является добавление всех необходимых метаметодов в таблицу перед установкой в ​​качестве метатаблицы какого-либо объекта. </font><font style="vertical-align: inherit;">В частности, </font></font><code>__gc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметод работает только при соблюдении этого порядка (см. </font></font><a href="#2.5.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.5.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Поскольку метатаблицы являются обычными таблицами, они могут содержать произвольные поля, а не только имена событий, определенные выше. </font><font style="vertical-align: inherit;">Некоторые функции в стандартной библиотеке (например, </font></font><a href="#pdf-tostring"><code>строковой</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) используют другие поля в метатаблицах для своих собственных целей.





</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.5 - </font></font><a name="2.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Сборка мусора</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua выполняет автоматическое управление памятью. </font><font style="vertical-align: inherit;">Это означает, что вам не нужно беспокоиться о выделении памяти для новых объектов или освобождении ее, когда объекты больше не нужны. </font><font style="vertical-align: inherit;">Lua управляет памятью автоматически, запустив </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">сборщик мусора</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> для сбора всех </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">мертвых объектов</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
(то есть объектов, которые больше не доступны из Lua). </font><font style="vertical-align: inherit;">Вся используемая Lua память подлежит автоматическому управлению: строки, таблицы, пользовательские данные, функции, потоки, внутренние структуры и т. Д.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua реализует инкрементный сборщик меток и разверток. </font><font style="vertical-align: inherit;">Он использует два числа , </font><font style="vertical-align: inherit;">чтобы контролировать свои циклы мусора Коллекция: </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">пауза мусора коллектора</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">мусора коллектора шаг множителя</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Оба используют процентные точки в качестве единиц (например, значение 100 означает внутреннее значение 1).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Пауза сборщика мусора контролирует, как долго сборщик ждет, прежде чем начать новый цикл. </font><font style="vertical-align: inherit;">Большие значения делают коллектор менее агрессивным. </font><font style="vertical-align: inherit;">Значения меньше 100 означают, что коллектор не будет ждать начала нового цикла. </font><font style="vertical-align: inherit;">Значение 200 означает, что сборщик ожидает удвоения общего объема используемой памяти, прежде чем начинать новый цикл.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Множитель шага сборщика мусора управляет относительной скоростью коллектора относительно выделения памяти. </font><font style="vertical-align: inherit;">Большие значения делают коллектор более агрессивным, но также увеличивают размер каждого шага. </font><font style="vertical-align: inherit;">Вы не должны использовать значения меньше 100, потому что они делают коллектор слишком медленным и могут привести к тому, что коллектор никогда не завершит цикл. </font><font style="vertical-align: inherit;">По умолчанию установлено значение 200, что означает, что сборщик работает с удвоенной скоростью выделения памяти.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если вы установите множитель шага на очень большое число (более 10% от максимального числа байтов, которое может использовать программа), сборщик будет вести себя как сборщик остановок. </font><font style="vertical-align: inherit;">Если затем установить паузу 200, сборщик будет вести себя как в старых версиях Lua, создавая полную коллекцию каждый раз, когда Lua удваивает использование памяти.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вы можете изменить эти номера, позвонив </font></font><a href="#lua_gc"><code>lua_gc</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в C или </font></font><a href="#pdf-collectgarbage"><code>собратьмусор</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в Lua. </font><font style="vertical-align: inherit;">Вы также можете использовать эти функции для непосредственного управления коллектором (например, остановить и перезапустить его).



</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.5.1 - </font></font><a name="2.5.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Метаметоды сбора мусора</font></font></a></h3>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вы можете установить метаметоды сборщика мусора для таблиц и, используя C API, для полных пользовательских данных (см. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Эти метаметоды также называют </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">финализаторами</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Финализаторы позволяют вам координировать сборку мусора Lua с управлением внешними ресурсами (такими как закрытие файлов, подключение к сети или базе данных или освобождение вашей собственной памяти).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Чтобы объект (таблица или пользовательские данные) был завершен при получении, необходимо </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">пометить</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> его для завершения. </font><font style="vertical-align: inherit;">Вы помечаете объект для финализации, когда вы устанавливаете его метатабельным, и у метатаблицы есть поле, индексированное строкой " </font></font><code>__gc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">". </font><font style="vertical-align: inherit;">Обратите внимание, что если вы установите метатабель без </font></font><code>__gc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">поля, а затем создадите это поле в метатабле, объект не будет помечен для завершения.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда помеченный объект становится мусором, он не собирается немедленно сборщиком мусора. </font><font style="vertical-align: inherit;">Вместо этого Луа помещает это в список. </font><font style="vertical-align: inherit;">После сбора Lua проходит через этот список. </font><font style="vertical-align: inherit;">Для каждого объекта в списке он проверяет </font></font><code>__gc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметод </font><font style="vertical-align: inherit;">объекта </font><font style="vertical-align: inherit;">: если это функция, Lua вызывает его с объектом в качестве единственного аргумента; </font><font style="vertical-align: inherit;">если метаметод не является функцией, Lua просто игнорирует его.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В конце каждого цикла сборки мусора финализаторы для объектов вызываются в обратном порядке, в котором объекты были помечены для финализации среди тех, которые были собраны в этом цикле; </font><font style="vertical-align: inherit;">то есть первый финализатор, который будет вызван, это тот, который связан с объектом, отмеченным последним в программе. </font><font style="vertical-align: inherit;">Выполнение каждого финализатора может происходить в любой момент во время выполнения обычного кода.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Поскольку собираемый объект должен все еще использоваться финализатором, этот объект (и другие объекты, доступные только через него) должны быть </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">воскрешены</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lua. </font><font style="vertical-align: inherit;">Обычно это воскресение является временным, и память объекта освобождается в следующем цикле сборки мусора. </font><font style="vertical-align: inherit;">Однако, если финализатор хранит объект в каком-то глобальном месте (например, в глобальной переменной), то воскресение является постоянным. </font><font style="vertical-align: inherit;">Более того, если финализатор помечает завершающий объект для завершения снова, его финализатор будет вызываться снова в следующем цикле, когда объект недоступен. </font><font style="vertical-align: inherit;">В любом случае память объекта освобождается только в цикле GC, где объект недоступен и не помечен для завершения.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда вы закрываете состояние (см. </font></font><a href="#lua_close"><code>lua_close</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), Lua вызывает финализаторы всех объектов, помеченных для завершения, в обратном порядке, в котором они были отмечены. </font><font style="vertical-align: inherit;">Если какой-либо финализатор помечает объекты для сбора на этом этапе, эти пометки не действуют.





</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.5.2 - </font></font><a name="2.5.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Слабые таблицы</font></font></a></h3>

<p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Слабый таблица</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> является таблицей, элементы которой являются
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">слабыми ссылками</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Слабая ссылка игнорируется сборщиком мусора. </font><font style="vertical-align: inherit;">Другими словами, если единственными ссылками на объект являются слабые ссылки, сборщик мусора будет собирать этот объект.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Слабая таблица может иметь слабые ключи, слабые значения или оба. </font><font style="vertical-align: inherit;">Таблица со слабыми значениями позволяет собирать ее значения, но предотвращает сбор ее ключей. </font><font style="vertical-align: inherit;">Таблица со слабыми ключами и слабыми значениями позволяет собирать как ключи, так и значения. </font><font style="vertical-align: inherit;">В любом случае, если собран ключ или значение, вся пара удаляется из таблицы. </font><font style="vertical-align: inherit;">Слабость таблицы контролируется
 </font></font><code>__mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">областью ее метатабельности. </font><font style="vertical-align: inherit;">Если </font></font><code>__mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">поле представляет собой строку, содержащую символ ' </font></font><code>k</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">', ключи в таблице слабые. </font><font style="vertical-align: inherit;">Если </font></font><code>__mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">содержит ' </font></font><code>v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">', значения в таблице слабые.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Таблица со слабыми ключами и сильными значениями также называется </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">таблицей эфемеронов</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">В таблице эфемеронов значение считается достижимым, только если его ключ достижим. </font><font style="vertical-align: inherit;">В частности, если единственная ссылка на ключ поступает через его значение, пара удаляется.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Любое изменение слабости таблицы может вступить в силу только в следующем цикле сбора. </font><font style="vertical-align: inherit;">В частности, если вы измените слабость на более сильный режим, Lua может собрать некоторые элементы из этой таблицы до того, как изменение вступит в силу.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Только объекты, имеющие явную конструкцию, удаляются из слабых таблиц. </font><font style="vertical-align: inherit;">Значения, такие как числа и легкие функции C, не подлежат сборке мусора и, следовательно, не удаляются из слабых таблиц (если не собраны связанные с ними значения). </font><font style="vertical-align: inherit;">Хотя строки подлежат сборке мусора, они не имеют явной конструкции и поэтому не удаляются из слабых таблиц.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Воскресшие объекты (то есть объекты, которые завершаются, и объекты, доступные только через объекты, которые завершаются) имеют особое поведение в слабых таблицах. </font><font style="vertical-align: inherit;">Они удаляются из слабых значений перед запуском их финализаторов, но удаляются из слабых ключей только в следующей коллекции после запуска их финализаторов, когда такие объекты фактически освобождаются. </font><font style="vertical-align: inherit;">Такое поведение позволяет финализатору получать доступ к свойствам, связанным с объектом, через слабые таблицы.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если слабая таблица находится среди воскрешенных объектов в цикле сбора, она не может быть очищена должным образом до следующего цикла.







</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.6 - </font></font><a name="2.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">сопрограммы</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua поддерживает сопрограммы, также называемые </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">совместной многопоточностью</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Сопрограммы в Lua представляют собой самостоятельную нить исполнения. </font><font style="vertical-align: inherit;">В отличие от потоков в многопоточных системах, однако, сопрограммы только приостанавливают свое выполнение, явно вызывая функцию yield.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вы создаете сопрограммы по телефону </font></font><a href="#pdf-coroutine.create"><code>сопрограммы.создать</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Его единственным аргументом является функция, которая является основной функцией сопрограммы. </font></font><code>create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Функция только создает новые сопрограммы и возвращает дескриптор к нему (объекту типа </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">резьбы</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ); </font><font style="vertical-align: inherit;">это не запускает сопрограммы.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вы выполняете сопрограммы по телефону </font></font><a href="#pdf-coroutine.resume"><code>сопрограммы.продолжить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Когда вы в первый раз вызываете </font></font><a href="#pdf-coroutine.resume"><code>сопрограммы.продолжить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, передавая в качестве первого аргумента поток, возвращаемый </font></font><a href="#pdf-coroutine.create"><code>сопрограммы.создать</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, сопрограммы начинают выполнение, вызывая свою основную функцию. </font><font style="vertical-align: inherit;">Дополнительные переданные аргументы передаются в </font></font><a href="#pdf-coroutine.resume"><code>сопрограммы.продолжить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">качестве аргументов этой функции. </font><font style="vertical-align: inherit;">После того, как сопрограммы начинают работать, они работают до тех пор, пока не завершатся или не </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">дадут</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Сопрограммы могут прекратить выполнение двумя способами: обычно, когда возвращается основная функция (явно или неявно, после последней инструкции); </font><font style="vertical-align: inherit;">и ненормально, если есть незащищенная ощибка. </font><font style="vertical-align: inherit;">В случае нормального завершения
 </font></font><a href="#pdf-coroutine.resume"><code>сопрограммы.продолжить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает значение </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> плюс любые значения, возвращаемые основной функцией сопрограммы. </font><font style="vertical-align: inherit;">В случае ошибок </font></font><a href="#pdf-coroutine.resume"><code>сопрограммы.продолжить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
плюс объект ощибка.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
А сопрограммы уступает по коллу </font></font><a href="#pdf-coroutine.yield"><code>сопрограммы.передать</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Когда сопрограммы выходят, соответствующие </font></font><a href="#pdf-coroutine.resume"><code>сопрограммы.продолжить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращаются немедленно, даже если выход происходит внутри вызовов вложенных функций (то есть не в основной функции, а в функции, прямо или косвенно вызванной основной функцией). </font><font style="vertical-align: inherit;">В случае выхода </font></font><a href="#pdf-coroutine.resume"><code>сопрограммы.продолжить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">также возвращает значение </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> плюс любые значения, переданные в </font></font><a href="#pdf-coroutine.yield"><code>сопрограммы.передать</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">В следующий раз, когда вы возобновите ту же сопрограмму, она продолжит свое выполнение с того места, где она дала, с вызовом </font></font><a href="#pdf-coroutine.yield"><code>сопрограммы.передать</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возврата любых дополнительных аргументов, переданных </font></font><a href="#pdf-coroutine.resume"><code>сопрограммы.продолжить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Например </font></font><a href="#pdf-coroutine.create"><code>сопрограммы.создать</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="#pdf-coroutine.wrap"><code>сопрограммы.обернуть</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функция также создает сопрограммы, но вместо возврата самой сопрограммы она возвращает функцию, которая при вызове возобновляет сопрограммы. </font><font style="vertical-align: inherit;">Все аргументы, переданные этой функции, передаются как дополнительные аргументы </font></font><a href="#pdf-coroutine.resume"><code>сопрограммы.продолжить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.
</font></font><a href="#pdf-coroutine.wrap"><code>сопрограммы.обернуть</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает все возвращаемые значения </font></font><a href="#pdf-coroutine.resume"><code>сопрограммы.продолжить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, кроме первого (логический код ощибка). </font><font style="vertical-align: inherit;">В отличие от </font></font><a href="#pdf-coroutine.resume"><code>сопрограммы.продолжить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a href="#pdf-coroutine.wrap"><code>сопрограммы.обернуть</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не ловит ошибки; </font><font style="vertical-align: inherit;">любая ощибка распространяется на звонящего.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В качестве примера работы сопрограмм рассмотрим следующий код:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     функция foo (a)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       печать ("foo", а)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       возврат сопрограммы.передать (2 * а)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     конец</font></font><font></font>
     <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     co = сопрограммы.создать (функция (а, б)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           печать ("co-body", а, б)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           местный r = foo (a + 1)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           печать ("co-body", р)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           местные r, s = сопрограммы.передать (a + b, ab)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           печать ("co-body", r, s)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           возврат б, "конец"</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     конец)</font></font><font></font>
     <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     печать ("main", сопрограммы.продолжить (co, 1, 10))</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     печать ("main", сопрограммы.продолжить (co, "r"))</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     печать ("main", сопрограммы.продолжить (co, "x", "y"))</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     печать ("main", сопрограммы.продолжить (co, "x", "y"))</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда вы запустите его, он выдаст следующий вывод:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     совместное тело 1 10</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     фу 2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     главная правда 4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     совместное тело r</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     главная правда 11 -9</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     тело xy</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     главная правда 10 конец</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     главная ложь не может возобновить мертвые сопрограммы</font></font><font></font>
</pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вы также можете создавать и манипулировать сопрограммы через C API: см функции </font></font><a href="#lua_newthread"><code>lua_newthread</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="#lua_resume"><code>lua_resume</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><a href="#lua_yield"><code>lua_yield</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 - </font></font><a name="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Язык</font></font></a></h1>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В этом разделе описываются лексика, синтаксис и семантика Lua. </font><font style="vertical-align: inherit;">Другими словами, в этом разделе описывается, какие токены являются действительными, как их можно комбинировать и что означают их комбинации.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Языковые конструкции будут объяснены с использованием обычной расширенной нотации BNF, в которой { </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> } означает 0 или более </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , а [ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] означает необязательный </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Нетерминалы</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> показаны как </font><b><font style="vertical-align: inherit;">нетерминальные</font></b><font style="vertical-align: inherit;"> , ключевые слова показаны как </font><b><font style="vertical-align: inherit;">kword</font></b><font style="vertical-align: inherit;"> , а другие терминальные символы показаны как ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '. </font><font style="vertical-align: inherit;">Полный синтаксис Lua можно найти в </font></font><a href="#9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§9</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
в конце этого руководства.



</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1 - </font></font><a name="3.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Лексические соглашения</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua - язык свободной формы. </font><font style="vertical-align: inherit;">Он игнорирует пробелы (включая новые строки) и комментарии между лексическими элементами (токенами), за исключением разделителей между именами и ключевыми словами.


</font></font></p><p>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Имена</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
(также называемые </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">идентификаторами</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) в Lua могут быть любой строкой букв, цифр и символов подчеркивания, не начинающейся с цифры и не являющейся зарезервированным словом. </font><font style="vertical-align: inherit;">Идентификаторы используются для именования переменных, полей таблицы и меток.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Следующие </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ключевые слова</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> зарезервированы и не могут использоваться в качестве имен:


</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     и перерыв сделать еще, если конец</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     false для функции goto, если в</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     местный ноль нет или повторный возврат</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     тогда правда пока</font></font><font></font>
</pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua является чувствительными к </font><font style="vertical-align: inherit;">регистру языка:
 </font></font><code>and</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является зарезервированным словом, но </font></font><code>And</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>AND</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
две разных, действительные имен. </font><font style="vertical-align: inherit;">Как правило, программы должны избегать создания имен, которые начинаются со знака подчеркивания, за которым следуют одна или несколько заглавных букв (например, </font></font><a href="#pdf-_VERSION"><code>_VERSION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Следующие строки обозначают другие токены:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     + - * /% ^ #</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &amp; ~ | </font><font style="vertical-align: inherit;">&lt;&lt; &gt;&gt; //</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     == ~ = &lt;=&gt; = &lt;&gt; =</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     () {} [] ::</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     ; </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">.. ...</font></font><font></font>
</pre>

<p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Короткая буквальным строка</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
может быть ограничена путем сопоставления одинарные или двойные кавычки, и может содержать следующие C-подобные управляющие </font><font style="vertical-align: inherit;">последовательности: « </font></font><code>\a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">» (колокол), « </font></font><code>\b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">» (забой), « </font></font><code>\f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">» (форма подачи), « </font></font><code>\n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">» (перевод строки), ' </font></font><code>\r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (возврат каретки), ' </font></font><code>\t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (горизонтальная табуляция), ' </font></font><code>\v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (вертикальная табуляция), ' </font></font><code>\\</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (обратная косая черта), ' </font></font><code>\"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (кавычка [двойная кавычка]) и ' </font></font><code>\'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (апостроф [одинарная кавычка]). </font><font style="vertical-align: inherit;">Обратная косая черта, за которой следует разрыв строки, приводит к новой строке в строке. </font><font style="vertical-align: inherit;">Экранирующая последовательность ' </font></font><code>\z</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' пропускает следующий интервал символов пробела, включая разрывы строк; </font><font style="vertical-align: inherit;">особенно полезно разбивать и вставлять длинную литеральную строку в несколько строк без добавления новых строк и пробелов в содержимое строки. </font><font style="vertical-align: inherit;">Короткая литеральная строка не может содержать неэкранированные разрывы строк и экранирования, не образующие допустимую escape-последовательность.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Мы можем указать любой байт в короткой литеральной строке по ее числовому значению (включая встроенные нули). </font><font style="vertical-align: inherit;">Это можно сделать с помощью escape-последовательности </font><font style="vertical-align: inherit;">, где </font><em><font style="vertical-align: inherit;">XX</font></em><font style="vertical-align: inherit;"> - это последовательность ровно двух шестнадцатеричных цифр, или с escape-последовательностью </font><font style="vertical-align: inherit;">, где </font><em><font style="vertical-align: inherit;">ddd</font></em><font style="vertical-align: inherit;"> - это последовательность до трех десятичных цифр. </font><font style="vertical-align: inherit;">(Обратите внимание, что если после десятичной escape-последовательности следует цифра, она должна быть выражена ровно тремя цифрами.)


</font></font><code>\x<em>XX</em></code><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><code>\<em>ddd</em></code><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Кодировка UTF-8 символа Unicode может быть вставлена ​​в буквальную строку с escape-последовательностью </font><font style="vertical-align: inherit;">
(обратите внимание на обязательные заключающие в скобки), где </font><em><font style="vertical-align: inherit;">XXX</font></em><font style="vertical-align: inherit;"> - это последовательность из одной или нескольких шестнадцатеричных цифр, представляющих кодовую точку символа.


</font></font><code>\u{<em>XXX</em>}</code><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Литеральные строки также могут быть определены с использованием длинного формата, заключенного в </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">длинные скобки</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Мы определяем </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">открывающую длинную скобку уровня </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></em></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> как открывающую квадратную скобку, за которой следуют </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> знаков равенства, за которыми следует другая открывающая квадратная скобка. </font><font style="vertical-align: inherit;">Итак, открывающая длинная скобка уровня 0 записывается как </font></font><code>[[</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, открывающая длинная скобка уровня 1 записывается как </font></font><code>[=[</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и так далее. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Закрытия длинный кронштейн</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> определяется аналогично; </font><font style="vertical-align: inherit;">например, закрывающая длинная скобка уровня 4 записывается как   </font></font><code>]====]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">А </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">долго буквенные</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> начинается с открывающейся длинного кронштейна любого уровня и заканчивается в первой закрывающей скобки длинной том же уровне. </font><font style="vertical-align: inherit;">Он может содержать любой текст, кроме закрывающей скобки того же уровня. </font><font style="vertical-align: inherit;">Литералы в этой форме в скобках могут работать на несколько строк, не интерпретировать любые escape-последовательности и игнорировать длинные скобки любого другого уровня. </font><font style="vertical-align: inherit;">Любой вид последовательности конца строки (возврат каретки, перевод новой строки, возврат каретки с последующим переводом новой строки или перевод новой строки после возврата каретки) преобразуется в простой перевод новой строки.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Для удобства, когда за открывающей длинной скобкой сразу следует новая строка, новая строка не включается в строку. </font><font style="vertical-align: inherit;">Например, в системе, использующей ASCII (в которой ' </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' кодируется как 97, новая </font></font><code>1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">строка </font><font style="vertical-align: inherit;">кодируется как 10, а ' </font><font style="vertical-align: inherit;">' кодируется как 49), пять литеральных строк ниже обозначают одну и ту же строку:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     a = 'alo \ n123 "'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     a = "alo \ n123 \" "</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     a = '\ 97lo \ 10 \ 04923 "'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     а = [[ало</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     123" ]]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     а = [== [</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Ало</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     123" ] ==]</font></font><font></font>
</pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Любой байт в литеральной строке, на который явно не влияют предыдущие правила, представляет себя. </font><font style="vertical-align: inherit;">Однако Lua открывает файлы для разбора в текстовом режиме, и в функциях системных файлов могут возникнуть проблемы с некоторыми управляющими символами. </font><font style="vertical-align: inherit;">Таким образом, безопаснее представлять нетекстовые данные в виде кавычек с явными escape-последовательностями для нетекстовых символов.


</font></font></p><p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Числовая константа</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (или </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">цифра</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) может быть записана с помощью дополнительной дробной части и необязательной десятичной экспоненты, отмеченной буквой « </font></font><code>e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">» или « </font></font><code>E</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">». </font><font style="vertical-align: inherit;">Lua также принимает шестнадцатеричные константы, которые начинаются с </font></font><code>0x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или </font></font><code>0X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Шестнадцатеричные константы также принимают необязательную дробную часть плюс необязательный двоичный показатель, помеченный буквой </font></font><code>p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«или </font></font><code>P</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">». </font><font style="vertical-align: inherit;">Числовая константа с радикальной точкой или показателем степени означает число с плавающей запятой; </font><font style="vertical-align: inherit;">в противном случае, если его значение соответствует целому числу, оно обозначает целое число. </font><font style="vertical-align: inherit;">Примеры допустимых целочисленных констант:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     3 345 0xff 0xBEBADA
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Примеры допустимых констант:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     3.0 3.1416 314.16e-2 0.31416E1 34e1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     0x0,1E 0xA23p-4 0X1,921FB54442D18P + 1</font></font><font></font>
</pre>

<p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Комментарий</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> начинается с двойным дефисом ( </font></font><code>--</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) где - </font><font style="vertical-align: inherit;">либо за пределами строки. </font><font style="vertical-align: inherit;">Если текст, следующий сразу после </font></font><code>--</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, не является открывающей длинной скобкой, комментарий является </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">кратким комментарием</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , который продолжается до конца строки. </font><font style="vertical-align: inherit;">В противном случае это </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">длинный комментарий</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , который продолжается до соответствующей закрывающей длинной скобки. </font><font style="vertical-align: inherit;">Длинные комментарии часто используются для временного отключения кода.





</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2 - </font></font><a name="3.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Переменные</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Переменные - это места, в которых хранятся значения. </font><font style="vertical-align: inherit;">В Lua есть три вида переменных: глобальные переменные, локальные переменные и поля таблицы.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Одно имя может обозначать глобальную переменную или локальную переменную (или формальный параметр функции, который является специфическим видом локальной переменной):

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	var :: = имя
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Имя обозначает идентификаторы, как определено в </font></font><a href="#3.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Предполагается, что любое имя переменной является глобальным, если оно явно не объявлено как локальное (см. </font></font><a href="#3.3.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.3.7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Локальные переменные имеют </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">лексическую область видимости</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : локальные переменные могут быть свободно доступны с помощью функций, определенных внутри их области видимости (см. </font></font><a href="#3.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Перед первым присваиванием переменной ее значение равно </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нулю</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Квадратные скобки используются для индексации таблицы:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	var :: = prefixexp ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' exp ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Значение доступа к полям таблицы можно изменить с помощью метатаблиц. </font><font style="vertical-align: inherit;">Доступ к индексированной переменной </font></font><code>t[i]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">эквивалентен вызову </font></font><code>gettable_event(t,i)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(См. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> для полного описания
 </font></font><code>gettable_event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функции. Эта функция не определена или не вызывается в Lua. Мы используем ее здесь только для пояснительных целей.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Синтаксис </font></font><code>var.Name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">просто синтаксический сахар для
 </font></font><code>var["Name"]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	var :: = prefixexp ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' Название
</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Доступ к глобальной переменной </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
эквивалентен </font></font><code>_ENV.x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Из-за способа компиляции чанков
 </font></font><code>_ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">никогда не бывает глобальным именем (см. </font></font><a href="#2.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3 - </font></font><a name="3.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Заявления</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua поддерживает почти обычный набор операторов, аналогичный тем, которые используются в Pascal или C. Этот набор включает в себя присваивания, управляющие структуры, вызовы функций и объявления переменных.



</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3.1 - </font></font><a name="3.3.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Блоки</font></font></a></h3>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Блок - это список операторов, которые выполняются последовательно:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	block :: = {stat}
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В Lua есть </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">пустые операторы,</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
которые позволяют разделять операторы точками с запятой, начинать блок с точки с запятой или записывать две точки с запятой последовательно:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	stat :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'
</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вызовы и назначения функций могут начинаться с открытых скобок. </font><font style="vertical-align: inherit;">Эта возможность приводит к неоднозначности в грамматике Луа. </font><font style="vertical-align: inherit;">Рассмотрим следующий фрагмент:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     a = b + c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     (печать или вв.пиши) ('готово')</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Грамматика могла видеть это двумя способами:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     a = b + c (печать или вв.пиши) («сделано»)</font></font><font></font>
     <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     a = b + c; </font><font style="vertical-align: inherit;">(печать или вв.пиши) ('готово')</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Текущий синтаксический анализатор всегда видит такие конструкции первым способом, интерпретируя открытые скобки как начало аргументов вызова. </font><font style="vertical-align: inherit;">Чтобы избежать этой двусмысленности, рекомендуется всегда ставить перед точкой с запятой операторы, начинающиеся с круглых скобок:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     ; (печать или вв.пиши) ('готово')
</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Блок может быть явно разделен для создания одного оператора:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	стат :: = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">сделать</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> блок </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">конца</font></font></b>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Явные блоки полезны для управления областью объявления переменных. </font><font style="vertical-align: inherit;">Явные блоки также иногда используются для добавления оператора </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возврата</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> в середине другого блока (см. </font></font><a href="#3.3.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.3.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3.2 - </font></font><a name="3.3.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Куски</font></font></a></h3>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Единица компиляции Lua называется </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">чанком</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Синтаксически, чанк - это просто блок:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	чанк :: = блок
</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua обрабатывает чанк как тело анонимной функции с переменным числом аргументов (см. </font></font><a href="#3.4.11"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.11</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Таким образом, чанки могут определять локальные переменные, получать аргументы и возвращать значения. </font><font style="vertical-align: inherit;">Кроме того, такая анонимная функция компилируется как в области действия внешней локальной переменной </font></font><code>_ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(см. </font></font><a href="#2.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Результирующая функция всегда имеет </font></font><code>_ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">свое единственное значение, даже если она не использует эту переменную.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Чанк может храниться в файле или в строке внутри хост-программы. </font><font style="vertical-align: inherit;">Чтобы выполнить блок, Lua сначала </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">загружает</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> его, предварительно скомпилировав код блока в инструкции для виртуальной машины, а затем Lua выполняет скомпилированный код с интерпретатором для виртуальной машины.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Куски также могут быть предварительно скомпилированы в двоичную форму; </font><font style="vertical-align: inherit;">см. программу </font></font><code>luac</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и функцию </font></font><a href="#pdf-string.dump"><code>строка.дамп</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для деталей. </font><font style="vertical-align: inherit;">Программы в исходном и скомпилированном виде взаимозаменяемы; </font><font style="vertical-align: inherit;">Lua автоматически определяет тип файла и действует соответственно (см. </font></font><a href="#pdf-load"><code>загрузить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).





</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3.3 - </font></font><a name="3.3.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Назначение</font></font></a></h3>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua позволяет несколько назначений. </font><font style="vertical-align: inherit;">Таким образом, синтаксис для присваивания определяет список переменных слева и список выражений справа. </font><font style="vertical-align: inherit;">Элементы в обоих списках разделены запятыми:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	stat :: = varlist ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' explist</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	varlist :: = var {' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' var}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	explist :: = exp {' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' exp}
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Выражения обсуждаются в п. </font></font><a href="#3.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Перед присвоением список значений </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">корректируется</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> по длине списка переменных. </font><font style="vertical-align: inherit;">Если значений больше, чем необходимо, лишние значения отбрасываются. </font><font style="vertical-align: inherit;">Если значений меньше, чем необходимо, список расширяется на столько   </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нулей</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , сколько необходимо. </font><font style="vertical-align: inherit;">Если список выражений заканчивается вызовом функции, то все значения, возвращаемые этим вызовом, входят в список значений перед корректировкой (кроме случаев, когда вызов заключен в скобки; см. </font></font><a href="#3.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Оператор присваивания сначала оценивает все его выражения, и только затем выполняются присваивания. </font><font style="vertical-align: inherit;">Таким образом, код

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     я = 3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     i, a [i] = i + 1, 20</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
устанавливается </font></font><code>a[3]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">на 20, не влияя, </font></font><code>a[4]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
потому что </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in </font></font><code>a[i]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">оценивается (до 3), прежде чем он назначен 4. Аналогично, строка

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     х, у = у, х
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
обменивается значениями </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, и

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     х, у, z = у, z, х
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
циклически переставляет значения </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>z</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Значение назначений глобальным переменным и полям таблицы можно изменить с помощью метатаблиц. </font><font style="vertical-align: inherit;">Присвоение индексированной переменной </font></font><code>t[i] = val</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">эквивалентно
 </font></font><code>settable_event(t,i,val)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(См. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> для полного описания
 </font></font><code>settable_event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функции. Эта функция не определена или не вызывается в Lua. Мы используем ее здесь только для пояснительных целей.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Присвоение глобальному имени </font></font><code>x = val</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
эквивалентно присваиванию
 </font></font><code>_ENV.x = val</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(см. </font></font><a href="#2.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3.4 - </font></font><a name="3.3.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Управляющие структуры</font></font></a></h3><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Управляющие структуры
 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repeat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> имеют обычное значение и знакомый синтаксис:




</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	stat :: = в </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">то время как</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exp </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">делать </font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">конец</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> блока </font><font style="vertical-align: inherit;">
	stat :: = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">повторять</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> блок </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">до</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exp</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	stat :: = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exp </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">то</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> block { </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elseif</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exp </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">затем</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> block} [ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">else</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> block] </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">end</font></font></b>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua также имеет оператор </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> в двух вариантах (см. </font></font><a href="#3.3.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.3.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Выражение условия управляющей структуры может возвращать любое значение. </font><font style="vertical-align: inherit;">И </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ложь,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> считаются ложными. </font><font style="vertical-align: inherit;">Все значения, отличные от </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , считаются истинными (в частности, число 0 и пустая строка также являются истинными).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В </font><font style="vertical-align: inherit;">цикле </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">повторения</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">до</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> внутренний блок заканчивается не </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">до</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ключевого слова, а только после условия. </font><font style="vertical-align: inherit;">Таким образом, условие может ссылаться на локальные переменные, объявленные внутри блока цикла.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Оператор </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">goto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> передает управление программой на метку. </font><font style="vertical-align: inherit;">По синтаксическим причинам метки в Lua также считаются утверждениями:



</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	stat :: = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Перейти к</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> имени</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	stat :: = label</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	label :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">::</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' Name ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">::</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '
</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Метка видна во всем блоке, где она определена, кроме как во вложенных блоках, где метка с тем же именем определена, и во вложенных функциях. </font><font style="vertical-align: inherit;">Goto может перейти к любой видимой метке, если она не входит в область действия локальной переменной.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Этикетки и пустые заявления называются </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">недействительным заявление</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , так </font><font style="vertical-align: inherit;">как они не выполняют никаких действий.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Оператор </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> завершает выполнение цикла
 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repeat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> или </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , пропуская следующий оператор после цикла:


</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	stat :: = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">перерыв</font></font></b>
</pre><p><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Перерыв</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> заканчивается внутренний цикл ограждающего.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Оператор </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> используется для возврата значений из функции или чанка (который является анонимной функцией). </font><font style="vertical-align: inherit;">Функции могут возвращать более одного значения, поэтому синтаксис </font><font style="vertical-align: inherit;">оператора

 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return</font></font></b><font style="vertical-align: inherit;"></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	stat :: = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [explist] [' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«]
</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Оператор </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возврата</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> может быть записан только как последний оператор блока. </font><font style="vertical-align: inherit;">Если действительно необходимо </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">вернуться</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> в середине блока, то можно использовать явный внутренний блок, как в идиоме </font></font><code>do return end</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, потому что теперь </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - это последний оператор в его (внутреннем) блоке.





</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3.5 - </font></font><a name="3.3.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Для заявления</font></font></a></h3>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

Оператор </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> имеет две формы: одну числовую и одну общую.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Числовой </font><font style="vertical-align: inherit;">цикл </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> повторяет блок кода, в то время как управляющая переменная проходит арифметическую последовательность. </font><font style="vertical-align: inherit;">Он имеет следующий синтаксис:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	стат :: = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Name « </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> » ехр « </font><font style="vertical-align: inherit;">» ехр [ « </font><font style="vertical-align: inherit;">» ехр] </font><b><font style="vertical-align: inherit;">действительно</font></b><font style="vertical-align: inherit;"> блокировать </font><b><font style="vertical-align: inherit;">конец</font></b></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b>
</pre><p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Блок</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> повторяется для </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">имени</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , начиная со значением первого </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ехра</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , пока она не проходит второй </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ехр</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> с шагом третьего </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ехра</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Точнее, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> заявления вроде

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     при у = </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е1</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е2</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е3</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> сделать </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">блок</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> конец
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
эквивалентно коду:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     делать</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       local </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">limit</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">step</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = числовой ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e1</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), числовой ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e2</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), числовой ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e3</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       если нет ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">limit</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">step</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), то ощибка () end
        </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">step</font></font></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       в то время как правда</font></font><font></font>
         <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">step</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
         if ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">step</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; = 0 и </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">limit</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) или ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">step</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &lt;0 и </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &lt; </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">limit</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) тогда</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           перерыв</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         конец</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         локальный v = </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">вар </font></font></em>
         <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">блок</font></font></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       конец</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     конец</font></font><font></font>
</pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Обратите внимание на следующее:

</font></font></p><ul>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Все три управляющих выражения вычисляются только один раз перед началом цикла. </font><font style="vertical-align: inherit;">Все они должны привести к числам.
</font></font></li>

<li>
<code><em>var</em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code><em>limit</em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">И </font></font><code><em>step</em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">невидимые переменные. </font><font style="vertical-align: inherit;">Имена, показанные здесь, только для пояснительных целей.
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если третье выражение (шаг) отсутствует, то используется шаг 1.
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вы можете использовать </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">goto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> для выхода из </font><font style="vertical-align: inherit;">цикла </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Переменная цикла </font></font><code>v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является локальной для тела цикла. </font><font style="vertical-align: inherit;">Если вам нужно его значение после цикла, присвойте его другой переменной перед выходом из цикла.
</font></font></li>

</ul>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Универсальный </font><font style="vertical-align: inherit;">оператор </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> работает над функциями, называемыми </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">итераторами</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">На каждой итерации вызывается функция итератора для получения нового значения, которое останавливается, когда это новое значение равно </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нулю</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Универсальный </font><font style="vertical-align: inherit;">цикл </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> имеет следующий синтаксис:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	стат :: = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> списка имен </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> explist </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ли</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> блокировать </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">конец</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
	список имен :: = Name { ' </font><font style="vertical-align: inherit;">' Name}
</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
А </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> заявления вроде

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     для </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var_1</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ···, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var_n</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> в </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">explist</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> сделать </font><font style="vertical-align: inherit;">конец
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">блока</font></font></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
эквивалентно коду:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     делать</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       local </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">explist</font></font></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       в то время как правда</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         локальный </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var_1</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ..., </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var_n</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         если </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var_1</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> == ноль, конец
          </font><em><font style="vertical-align: inherit;">строки </font></em></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var_1 </font></font></em>
         <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">block</font></font></em><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       конец</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     конец</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Обратите внимание на следующее:

</font></font></p><ul>

<li>
<code><em>explist</em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">оценивается только один раз. </font><font style="vertical-align: inherit;">Его результаты - </font><font style="vertical-align: inherit;">функция </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">итератора</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">состояние</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и начальное значение для первой </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">переменной итератора</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .
</font></font></li>

<li>
<code><em>f</em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code><em>s</em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">И </font></font><code><em>var</em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">невидимые переменные. </font><font style="vertical-align: inherit;">Имена здесь только для пояснительных целей.
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вы можете использовать </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">break</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> для выхода из </font><font style="vertical-align: inherit;">цикла </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Переменные цикла </font></font><code><em>var_i</em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">являются локальными для цикла; </font><font style="vertical-align: inherit;">вы не можете использовать их значения после </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Если вам нужны эти значения, то присвойте их другим переменным, прежде чем прерывать или выходить из цикла.
</font></font></li>

</ul>




<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3.6 - </font></font><a name="3.3.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Вызовы функций как операторы</font></font></a></h3><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Чтобы разрешить возможные побочные эффекты, вызовы функций могут быть выполнены как операторы:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	stat :: = functioncall
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В этом случае все возвращаемые значения отбрасываются. </font><font style="vertical-align: inherit;">Вызовы функций объяснены в </font></font><a href="#3.4.10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.10</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .





</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3.7 - </font></font><a name="3.3.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Локальные объявления</font></font></a></h3><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Локальные переменные могут быть объявлены где угодно внутри блока. </font><font style="vertical-align: inherit;">Декларация может включать начальное присвоение:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	stat :: = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">local</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> namelist [' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' explist]
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если присутствует, начальное назначение имеет ту же семантику множественного назначения (см. </font></font><a href="#3.3.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.3.3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">В противном случае все переменные инициализируются </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нулем</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Блок также является блоком (см. </font></font><a href="#3.3.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.3.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), и поэтому локальные переменные могут быть объявлены в блоке вне любого явного блока.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Правила видимости для локальных переменных объяснены в </font></font><a href="#3.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .







</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4 - </font></font><a name="3.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Выражения</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Основные выражения в Lua следующие:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	exp :: = prefixexp</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	exp :: = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> | </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ложь</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> | </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">правда</font></font></b><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	exp :: = число</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	exp :: = LiteralString</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	exp :: = functiondef</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	exp :: = tableconstructor</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	exp :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	exp :: = exp binop exp</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	exp :: = unop exp</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	prefixexp :: = var | </font><font style="vertical-align: inherit;">функциональный звонок | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' exp ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '
</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Числа и буквенные строки объяснены в </font></font><a href="#3.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">переменные объясняются в п. </font></font><a href="#3.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">определения функций объяснены в </font></font><a href="#3.4.11"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.11</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">вызовы функций объяснены в </font></font><a href="#3.4.10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.10</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">Конструкторы </font></font><a href="#3.4.9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">таблицы</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> объяснены в </font><a href="#3.4.9"><font style="vertical-align: inherit;">§3.4.9</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Выражения Vararg, обозначенные тремя точками (' </font></font><code>...</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'), могут использоваться только тогда, когда они находятся непосредственно внутри функции vararg; </font><font style="vertical-align: inherit;">они объяснены в </font></font><a href="#3.4.11"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.11</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Бинарные операторы включают арифметические операторы (см. </font></font><a href="#3.4.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), побитовые операторы (см. </font></font><a href="#3.4.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), реляционные операторы (см. </font></font><a href="#3.4.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), логические операторы (см. </font></font><a href="#3.4.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) и оператор конкатенации (см. </font></font><a href="#3.4.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§ 3.4.6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Унарные операторы включают унарный минус (см. </font></font><a href="#3.4.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), </font><a href="#3.4.1"><font style="vertical-align: inherit;">унарное</font></a><font style="vertical-align: inherit;"> побитовое НЕ (см. </font></font><a href="#3.4.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), </font><a href="#3.4.2"><font style="vertical-align: inherit;">унарное</font></a><font style="vertical-align: inherit;"> логическое </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (см. </font></font><a href="#3.4.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) и </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">оператор</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> унарной </font><em><font style="vertical-align: inherit;">длины</font></em><font style="vertical-align: inherit;"> (см. </font></font><a href="#3.4.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) ,


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
И вызовы функций, и выражения vararg могут привести к нескольким значениям. </font><font style="vertical-align: inherit;">Если в качестве оператора используется вызов функции (см. </font></font><a href="#3.3.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.3.6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), то его список возвращаемых значений корректируется до нулевых элементов, тем самым отбрасывая все возвращаемые значения. </font><font style="vertical-align: inherit;">Если выражение используется в качестве последнего (или единственного) элемента списка выражений, то никакие корректировки не производятся (если выражение не заключено в скобки). </font><font style="vertical-align: inherit;">Во всех других контекстах Lua корректирует список результатов на один элемент, либо отбрасывая все значения, кроме первого, либо добавляя один </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> если значений нет.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вот некоторые примеры:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     f () - скорректировано до 0 результатов</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     g (f (), x) - f () настроен на 1 результат</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     g (x, f ()) - g получает x плюс все результаты от f ()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     a, b, c = f (), x - f () настроен на 1 результат (c получает ноль)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     a, b = ... - a получает первый параметр vararg, b получает</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                        - второе (и a и b могут получить ноль, если есть</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                        - нет соответствующего параметра vararg)</font></font><font></font>
     <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     a, b, c = x, f () - f () настроен на 2 результата</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     a, b, c = f () - f () настроен на 3 результата</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     return f () - возвращает все результаты из f ()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     return ... - возвращает все полученные параметры vararg</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     return x, y, f () - возвращает x, y и все результаты из f ()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     {f ()} - создает список со всеми результатами из f ()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     {...} - создает список со всеми параметрами vararg</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     {f (), nil} - f () настроен на 1 результат</font></font><font></font>
</pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Любое выражение, заключенное в скобки, всегда приводит только к одному значению. </font><font style="vertical-align: inherit;">Таким образом,
 </font></font><code>(f(x,y,z))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">всегда одно значение, даже если </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает несколько значений. </font><font style="vertical-align: inherit;">(Значение </font></font><code>(f(x,y,z))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является первым значением, возвращаемым </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
или </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> если </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не возвращает никаких значений.)



</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.1 - </font></font><a name="3.4.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Арифметические операторы</font></font></a></h3><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua поддерживает следующие арифметические операторы:

</font></font></p><ul>
<li><b><code>+</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> дополнение</font></font></li>
<li><b><code>-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> вычитание</font></font></li>
<li><b><code>*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> умножение</font></font></li>
<li><b><code>/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> деление поплавка</font></font></li>
<li><b><code>//</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> этажное подразделение</font></font></li>
<li><b><code>%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> по модулю</font></font></li>
<li><b><code>^</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> возведение в степень</font></font></li>
<li><b><code>-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> одинарный минус</font></font></li>
</ul>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
За исключением возведения в степень и деления на числа с плавающей запятой, арифметические операторы работают следующим образом: если оба операнда являются целыми числами, операция выполняется над целыми числами, а результатом является целое число. </font><font style="vertical-align: inherit;">В противном случае, если оба операнда являются числами или строками, которые могут быть преобразованы в числа (см. </font></font><a href="#3.4.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), то они преобразуются в числа с плавающей запятой, операция выполняется в соответствии с обычными правилами для арифметики с плавающей запятой (обычно это стандарт IEEE 754) и в результате получается поплавок.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Экспонирование и деление с плавающей точкой ( </font></font><code>/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) всегда конвертируют свои операнды в числа с плавающей точкой, и результатом всегда является число с плавающей точкой </font><font style="vertical-align: inherit;">Экспонентация использует функцию ISO C </font></font><code>pow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, так что она работает и для нецелых показателей.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Этажное деление ( </font></font><code>//</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) - это деление, которое округляет частное в сторону минус бесконечности, то есть полу деления его операндов.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Модуль определяется как остаток от деления, которое округляет частное в сторону минус бесконечность (деление по полу).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В случае переполнения в целочисленной арифметике все операции </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">выполняются</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> по обычным правилам арифметики с двумя дополнениями. </font><font style="vertical-align: inherit;">(Другими словами, они возвращают единственное представимое целое число, равное по модулю </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64</font></font></sup></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> математическому результату.)



</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.2 - </font></font><a name="3.4.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Битовые операторы</font></font></a></h3><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua поддерживает следующие побитовые операторы:

</font></font></p><ul>
<li><b><code>&amp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> поразрядное И</font></font></li>
<li><b><code>|</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> побитовый ИЛИ</font></font></li>
<li><b><code>~</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> битовое исключающее ИЛИ</font></font></li>
<li><b><code>&gt;&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> сдвиг вправо</font></font></li>
<li><b><code>&lt;&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> сдвиг влево</font></font></li>
<li><b><code>~</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> одинарный поразрядно НЕ</font></font></li>
</ul>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Все побитовые операции преобразуют свои операнды в целые числа (см. </font></font><a href="#3.4.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), оперируют со всеми битами этих целых чисел и приводят к целому числу.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Сдвиг вправо и влево заполняет свободные биты нулями. </font><font style="vertical-align: inherit;">Отрицательные смещения смещаются в другом направлении; </font><font style="vertical-align: inherit;">смещения с абсолютными значениями, равными или превышающими количество битов в целом числе, приводят к нулю (поскольку все биты сдвинуты).





</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.3 - </font></font><a name="3.4.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Принуждения и преобразования</font></font></a></h3><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua обеспечивает некоторые автоматические преобразования между некоторыми типами и представлениями во время выполнения. </font><font style="vertical-align: inherit;">Битовые операторы всегда конвертируют операнды с плавающей точкой в ​​целые числа. </font><font style="vertical-align: inherit;">Экспонирование и деление на числа всегда переводят целочисленные операнды в числа с плавающей точкой. </font><font style="vertical-align: inherit;">Все остальные арифметические операции, применяемые к смешанным числам (целым числам и числам с плавающей точкой), преобразуют целочисленный операнд в число с плавающей точкой; </font><font style="vertical-align: inherit;">это называется </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">обычным правилом</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">C API также при необходимости преобразует оба целых числа в числа с плавающей точкой, а числа с плавающей точкой. </font><font style="vertical-align: inherit;">Кроме того, конкатенация строк принимает числа в качестве аргументов, кроме строк.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua также конвертирует строки в числа, когда ожидается число.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
При преобразовании целого числа в число с плавающей запятой, если целочисленное значение имеет точное представление в виде числа с плавающей запятой, это является результатом. </font><font style="vertical-align: inherit;">В противном случае преобразование получает ближайшее более высокое или ближайшее нижнее представимое значение. </font><font style="vertical-align: inherit;">Этот вид обращения никогда не терпит неудачу.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразование из числа с плавающей точкой в ​​целое число проверяет, имеет ли число с плавающей точкой точное представление в виде целого числа (то есть, число с плавающей точкой имеет целочисленное значение и находится в диапазоне целочисленного представления). </font><font style="vertical-align: inherit;">Если это так, то это представление является результатом. </font><font style="vertical-align: inherit;">В противном случае преобразование не выполняется.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразование из строк в числа происходит следующим образом: во-первых, строка преобразуется в целое число или число с плавающей запятой в соответствии с синтаксисом и правилами лексера Lua. </font><font style="vertical-align: inherit;">(Строка может также иметь начальные и конечные пробелы и знак.) Затем результирующее число (с плавающей точкой или целое число) преобразуется в тип (с плавающей точкой или целое число), требуемый контекстом (например, операция, которая вынудила преобразование).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Все преобразования из строк в числа принимают как точку, так и текущую языковую метку в качестве символа радиуса. </font><font style="vertical-align: inherit;">(Лексер Lua, однако, принимает только точку.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразование чисел в строки использует неуказанный читабельный формат. </font><font style="vertical-align: inherit;">Для полного контроля над тем, как числа преобразуются в строки, используйте </font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функцию из библиотеки </font><font style="vertical-align: inherit;">строк </font><font style="vertical-align: inherit;">(см. </font></font><a href="#pdf-string.format"><code>строка.формат</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).





</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.4 - </font></font><a name="3.4.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Операторы отношений</font></font></a></h3><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua поддерживает следующие реляционные операторы:

</font></font></p><ul>
<li><b><code>==</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> равенство</font></font></li>
<li><b><code>~=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> неравенство</font></font></li>
<li><b><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> меньше чем</font></font></li>
<li><b><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> больше чем</font></font></li>
<li><b><code>&lt;=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> меньше или равно</font></font></li>
<li><b><code>&gt;=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> больше или равно</font></font></li>
</ul><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эти операторы всегда приводят к </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> или </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Equality ( </font></font><code>==</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) сначала сравнивает тип своих операндов. </font><font style="vertical-align: inherit;">Если типы разные, то результат </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ложный</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">В противном случае значения операндов сравниваются. </font><font style="vertical-align: inherit;">Строки сравниваются очевидным образом. </font><font style="vertical-align: inherit;">Числа равны, если они обозначают одно и то же математическое значение.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Таблицы, пользовательские данные и потоки сравниваются по ссылке: два объекта считаются равными, только если они являются одним и тем же объектом. </font><font style="vertical-align: inherit;">Каждый раз, когда вы создаете новый объект (таблицу, пользовательские данные или поток), этот новый объект отличается от любого ранее существующего объекта. </font><font style="vertical-align: inherit;">Замыкания с одинаковой ссылкой всегда равны. </font><font style="vertical-align: inherit;">Замыкания с любой обнаруживаемой разницей (разное поведение, разное определение) всегда различны.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вы можете изменить способ, которым Lua сравнивает таблицы и пользовательские данные, используя метаметод "eq" (см. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Сравнения равенства не преобразуют строки в числа или наоборот. </font><font style="vertical-align: inherit;">Таким образом, </font></font><code>"0"==0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">оценивается как </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ложное</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><code>t[0]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>t["0"]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">обозначает различные записи в таблице.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Оператором </font></font><code>~=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является именно отрицание равенства ( </font></font><code>==</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Операторы заказа работают следующим образом. </font><font style="vertical-align: inherit;">Если оба аргумента являются числами, то они сравниваются в соответствии с их математическими значениями (независимо от их подтипов). </font><font style="vertical-align: inherit;">В противном случае, если оба аргумента являются строками, их значения сравниваются в соответствии с текущей локалью. </font><font style="vertical-align: inherit;">В противном случае Lua пытается вызвать метаметод «lt» или «le» (см. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Сравнение </font></font><code>a &gt; b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">переводится </font></font><code>b &lt; a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
и </font></font><code>a &gt;= b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">переводится </font></font><code>b &lt;= a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Следуя стандарту IEEE 754, NaN считается ни меньшим, ни равным, ни большим, чем любое значение (включая себя).





</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.5 - </font></font><a name="3.4.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Логические операторы</font></font></a></h3><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Логические операторы в Lua - это
 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><b><font style="vertical-align: inherit;">или </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нет</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Как и управляющие структуры (см. </font></font><a href="#3.3.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.3.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), все логические операторы рассматривают как </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ложь, так</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> как ложь, а все остальное как истину.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Оператор отрицания </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> всегда возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> или </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Оператор конъюнкции </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> возвращает свой первый аргумент, если это значение равно </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> или </font><font style="vertical-align: inherit;">равно </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">в противном случае </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> возвращает второй аргумент. </font><font style="vertical-align: inherit;">Оператор дизъюнкции </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> возвращает свой первый аргумент, если это значение отличается от </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">в противном случае </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> возвращает второй аргумент. </font><font style="vertical-align: inherit;">Как </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> использовать короткое замыкание оценки; </font><font style="vertical-align: inherit;">то есть второй операнд вычисляется только при необходимости. </font><font style="vertical-align: inherit;">Вот некоторые примеры:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     10 или 20 -&gt; 10</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     10 или ощибка () -&gt; 10</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     ноль или "а" -&gt; "а"</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     ноль и 10 -&gt; ноль</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     ложь и ощибка () -&gt; ложь</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     ложь и ноль -&gt; ложь</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     ложь или ноль -&gt; ноль</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     10 и 20 -&gt; 20</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(В данном руководстве
 </font></font><code>--&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">указывается результат предыдущего выражения.)





</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.6 - </font></font><a name="3.4.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Конкатенация</font></font></a></h3><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Оператор конкатенации строк в Lua обозначается двумя точками (' </font></font><code>..</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'). </font><font style="vertical-align: inherit;">Если оба операнда являются строками или числами, то они преобразуются в строки в соответствии с правилами, описанными в </font></font><a href="#3.4.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">В противном случае </font></font><code>__concat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметод называется (см. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.7 - </font></font><a name="3.4.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Оператор длины</font></font></a></h3>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Оператор длины обозначается унарным префиксным оператором </font></font><code>#</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Длина строки - это количество байтов (то есть обычное значение длины строки, когда каждый символ равен одному байту).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Оператор длины, примененный к таблице, возвращает границу в этой таблице. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Границы</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> в Таблица </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">любое натуральное число, удовлетворяющее следующему условию:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     (border == 0 или t [border] ~ = nil) и t [border + 1] == nil
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Словом, граница - это любой (естественный) индекс в таблице, где за ненулевым значением следует нулевое значение (или ноль, когда индекс 1 равен нулю).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Таблица с ровно одной границей называется </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">последовательностью</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Например, таблица </font></font><code>{10, 20, 30, 40, 50}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является последовательностью, так как имеет только одну границу (5). </font><font style="vertical-align: inherit;">Таблица </font></font><code>{10, 20, 30, nil, 50}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">имеет две границы (3 и 5), и поэтому она не является последовательностью. </font><font style="vertical-align: inherit;">Таблица </font></font><code>{nil, 20, 30, nil, nil, 60, nil}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
имеет три границы (0, 3 и 6), поэтому она также не является последовательностью. </font><font style="vertical-align: inherit;">Таблица </font></font><code>{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">представляет собой последовательность с границей 0. Обратите внимание, что неестественные ключи не влияют на то, является ли таблица последовательностью.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть последовательность,
 </font></font><code>#t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает ее единственную границу, которая соответствует интуитивному представлению о длине последовательности. </font><font style="vertical-align: inherit;">Когда </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не последовательность,
 </font></font><code>#t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">может вернуть любую из ее границ. </font><font style="vertical-align: inherit;">(Точное значение зависит от деталей внутреннего представления таблицы, что, в свою очередь, может зависеть от того, как таблица была заполнена, и от адресов памяти ее нечисловых ключей.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вычисление длины таблицы имеет гарантированное наихудшее время </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O (log n)</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , где </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - самый большой естественный ключ в таблице.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Программа может изменить поведение оператора длины для любого значения, кроме строк через </font></font><code>__len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметод (см. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.8 - </font></font><a name="3.4.8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Приоритет</font></font></a></h3><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Приоритет оператора в Lua следует таблице ниже, от более низкого до более высокого приоритета:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     или же</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     а также</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &lt;&gt; &lt;=&gt; = ~ = ==</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     ~</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &amp;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     &lt;&lt; &gt;&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     ..</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     + -</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     * / //%</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     унарные операторы (не # - ~)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     ^</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Как обычно, вы можете использовать скобки, чтобы изменить приоритеты выражения. </font><font style="vertical-align: inherit;">Операторы конкатенации (' </font></font><code>..</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">') и возведения в степень (' </font></font><code>^</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">') ассоциативны справа. </font><font style="vertical-align: inherit;">Все остальные бинарные операторы остаются ассоциативными.





</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.9 - </font></font><a name="3.4.9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Конструкторы таблиц</font></font></a></h3><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Конструкторы таблиц - это выражения, которые создают таблицы. </font><font style="vertical-align: inherit;">Каждый раз, когда вычисляется конструктор, создается новая таблица. </font><font style="vertical-align: inherit;">Конструктор может использоваться для создания пустой таблицы или для создания таблицы и инициализации некоторых ее полей. </font><font style="vertical-align: inherit;">Общий синтаксис для конструкторов

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	tableconstructor :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' [fieldlist] ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	fieldlist :: = field {fieldsep field} [fieldsep]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	поле :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' exp ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' exp | </font><font style="vertical-align: inherit;">Имя ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' exp | </font><font style="vertical-align: inherit;">ехр</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	fieldsep :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'
</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Каждое поле формы </font></font><code>[exp1] = exp2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">добавляет в новую таблицу запись с ключом </font></font><code>exp1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и значением </font></font><code>exp2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Поле формы </font></font><code>name = exp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">эквивалентно
 </font></font><code>["name"] = exp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Наконец, поля формы </font></font><code>exp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">эквивалентны
 </font></font><code>[i] = exp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, где </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">целые числа подряд начинаются с 1. Поля в других форматах не влияют на этот подсчет. </font><font style="vertical-align: inherit;">Например,

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     a = {[f (1)] = g; </font><font style="vertical-align: inherit;">"х", "у"; </font><font style="vertical-align: inherit;">х = 1, f (х), [30] = 23; </font><font style="vertical-align: inherit;">45}
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
эквивалентно

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     делать</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       местный т = {}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       t [f (1)] = g</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       t [1] = "x" - 1-й опыт</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       t [2] = "y" - 2-й опыт</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       tx = 1 - t ["x"] = 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       t [3] = f (x) - 3-й опыт</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       t [30] = 23</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       t [4] = 45 - 4-й опыт</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       а = т</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     конец</font></font><font></font>
</pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Порядок присваиваний в конструкторе не определен. </font><font style="vertical-align: inherit;">(Этот порядок будет актуален только при наличии повторяющихся ключей.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если последнее поле в списке имеет форму, </font></font><code>exp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
а выражение является вызовом функции или выражением vararg, то все значения, возвращаемые этим выражением, входят в список последовательно (см. </font></font><a href="#3.4.10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.10</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Список полей может иметь дополнительный конечный разделитель для удобства машинно-генерируемого кода.





</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.10 - </font></font><a name="3.4.10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Функциональные вызовы</font></font></a></h3><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вызов функции в Lua имеет следующий синтаксис:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	functioncall :: = prefixexp args
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
При вызове функции сначала выполняются prefixexp и args. </font><font style="vertical-align: inherit;">Если значение prefixexp имеет </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функцию типа</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , то эта функция вызывается с заданными аргументами. </font><font style="vertical-align: inherit;">В противном случае вызывается метаметод prefixexp «call», имеющий в качестве первого параметра значение prefixexp, за которым следуют исходные аргументы вызова (см. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Форма

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	functioncall :: = prefixexp ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' Name args
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
можно использовать для вызова «методов». </font><font style="vertical-align: inherit;">Вызов </font><font style="vertical-align: inherit;">
является синтаксическим сахаром для </font><font style="vertical-align: inherit;">, за исключением того, что </font><font style="vertical-align: inherit;">оценивается только один раз.


</font></font><code>v:name(<em>args</em>)</code><font style="vertical-align: inherit;"></font><code>v.name(v,<em>args</em>)</code><font style="vertical-align: inherit;"></font><code>v</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Аргументы имеют следующий синтаксис:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	args :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' [explist] ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	args :: = tableconstructor</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	args :: = LiteralString</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Все выражения аргумента оцениваются перед вызовом. </font><font style="vertical-align: inherit;">Зов формы </font><font style="vertical-align: inherit;">является синтаксическим сахаром для </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">то есть список аргументов - это одна новая таблица. </font><font style="vertical-align: inherit;">Вызов формы </font><font style="vertical-align: inherit;">
(или </font><font style="vertical-align: inherit;">или </font><font style="vertical-align: inherit;">) является синтаксическим сахаром для </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">то есть список аргументов является единственной литеральной строкой.


</font></font><code>f{<em>fields</em>}</code><font style="vertical-align: inherit;"></font><code>f({<em>fields</em>})</code><font style="vertical-align: inherit;"></font><code>f'<em>строка</em>'</code><font style="vertical-align: inherit;"></font><code>f"<em>строка</em>"</code><font style="vertical-align: inherit;"></font><code>f[[<em>строка</em>]]</code><font style="vertical-align: inherit;"></font><code>f('<em>строка</em>')</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вызов формы </font><font style="vertical-align: inherit;">называется </font><em><font style="vertical-align: inherit;">хвостовым вызовом</font></em><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Lua реализует </font><em><font style="vertical-align: inherit;">правильные хвостовые вызовы</font></em><font style="vertical-align: inherit;"> 
(или </font><em><font style="vertical-align: inherit;">правильную хвостовую рекурсию</font></em><font style="vertical-align: inherit;"> ): в хвостовом вызове вызываемая функция повторно использует запись в стеке вызывающей функции. </font><font style="vertical-align: inherit;">Следовательно, не существует ограничений на количество вложенных оконечных вызовов, которые может выполнить программа. </font><font style="vertical-align: inherit;">Однако, хвостовой вызов стирает любую отладку информации о вызывающей функции. </font><font style="vertical-align: inherit;">Обратите внимание, что хвостовой вызов происходит только с определенным синтаксисом, где </font><b><font style="vertical-align: inherit;">возвращаемый</font></b><font style="vertical-align: inherit;"> аргумент имеет один единственный вызов функции; </font><font style="vertical-align: inherit;">этот синтаксис заставляет вызывающую функцию возвращать в точности результаты вызванной функции. </font><font style="vertical-align: inherit;">Итак, ни один из следующих примеров не является хвостовыми вызовами:

</font></font><code>return <em>functioncall</em></code><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     return (f (x)) - результаты скорректированы до 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     вернуть 2 * f (x)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     return x, f (x) - дополнительные результаты</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     F (X); </font><font style="vertical-align: inherit;">возврат - результаты отброшены</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     return x или f (x) - результаты скорректированы на 1</font></font><font></font>
</pre>




<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.4.11 - </font></font><a name="3.4.11"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Определения функций</font></font></a></h3>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Синтаксис для определения функции

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	functiondef :: = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">function</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> funcbody</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	funcbody :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' [parlist] ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' </font><b><font style="vertical-align: inherit;">конец</font></b><font style="vertical-align: inherit;"> блока</font></font><b><font style="vertical-align: inherit;"></font></b>
</pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Следующий синтаксический сахар упрощает определения функций:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	stat :: = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функция</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> funcname funcbody</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	stat :: = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">локальная </font></font></b> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функция</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Имя funcbody</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	funcname :: = Name {' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'Имя} [' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'Имя]
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Заявление

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     функция f () </font><font style="vertical-align: inherit;">конец
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">тела</font></font></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
переводит на

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     f = function () </font><font style="vertical-align: inherit;">конец
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">тела</font></font></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Заявление

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     функция tabcf () </font><font style="vertical-align: inherit;">конец
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">тела</font></font></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
переводит на

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     tabcf = function () </font><font style="vertical-align: inherit;">конец
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">тела</font></font></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Заявление

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     локальная функция f () </font><font style="vertical-align: inherit;">конец
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">тела</font></font></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
переводит на

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     местный ж; </font><font style="vertical-align: inherit;">f = function () </font><font style="vertical-align: inherit;">конец
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">тела</font></font></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
не для

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     local f = function () </font><font style="vertical-align: inherit;">конец
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">тела</font></font></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Это имеет значение только тогда, когда тело функции содержит ссылки на </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Определение функции - это исполняемое выражение, значение которого имеет </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функцию типа</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Когда Lua предварительно компилирует блок, все его функциональные тела также прекомпилируются. </font><font style="vertical-align: inherit;">Затем, всякий раз, когда Lua выполняет определение функции, функция </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">создается</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (или </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">закрывается</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Этот экземпляр функции (или </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">замыкание</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) является окончательным значением выражения.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Параметры действуют как локальные переменные, которые инициализируются значениями аргументов:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">	parlist :: = namelist [' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '] | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда вызывается функция, список аргументов корректируется по длине списка параметров, если только эта функция не является </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функцией vararg</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , которая обозначена тремя точками (' </font></font><code>...</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">') в конце списка параметров. </font><font style="vertical-align: inherit;">Функция vararg не корректирует свой список аргументов; </font><font style="vertical-align: inherit;">вместо этого он собирает все дополнительные аргументы и передает их функции через </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">выражение vararg</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , которое также записывается в виде трех точек. </font><font style="vertical-align: inherit;">Значением этого выражения является список всех фактических дополнительных аргументов, аналогично функции с несколькими результатами. </font><font style="vertical-align: inherit;">Если выражение vararg используется внутри другого выражения или в середине списка выражений, то его возвращаемый список настраивается на один элемент. </font><font style="vertical-align: inherit;">Если выражение используется как последний элемент списка выражений, то никакие корректировки не производятся (если это последнее выражение не заключено в скобки).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В качестве примера рассмотрим следующие определения:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     конец функции f (a, b)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     конец функции g (a, b, ...)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     функция r () возвращает 1,2,3 конец</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Затем у нас есть следующее сопоставление аргументов с параметрами и выражением vararg:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     ПАРАМЕТРЫ ВЫЗОВА</font></font><font></font>
     <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     f (3) a = 3, b = ноль</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     f (3, 4) a = 3, b = 4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     f (3, 4, 5) a = 3, b = 4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     f (r (), 10) a = 1, b = 10</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     f (r ()) a = 1, b = 2</font></font><font></font>
     <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     g (3) a = 3, b = ноль, ... -&gt; (ничего)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     g (3, 4) a = 3, b = 4, ... -&gt; (ничего)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     g (3, 4, 5, 8) a = 3, b = 4, ... -&gt; 5 8</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     g (5, r ()) a = 5, b = 1, ... -&gt; 2 3</font></font><font></font>
</pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Результаты возвращаются с помощью </font><font style="vertical-align: inherit;">оператора </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (см. </font></font><a href="#3.3.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.3.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Если управление достигает конца функции, не встретив оператора </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , функция возвращается без результатов.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

Существует системно-зависимое ограничение на число значений, которые может возвращать функция. </font><font style="vertical-align: inherit;">Этот лимит гарантированно будет больше 1000.


</font></font></p><p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Двоеточие</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> синтаксис используется для определения </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">методов</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , то есть функции , </font><font style="vertical-align: inherit;">которые имеют неявный дополнительный параметр </font></font><code>self</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Таким образом, утверждение

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     функция tabc: f ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">params</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">конец
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">тела</font></font></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
является синтаксическим сахаром для

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     tabcf = функция (self, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">params</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">конец
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">тела</font></font></em><font style="vertical-align: inherit;"></font></pre>






<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.5 - </font></font><a name="3.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Правила видимости</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

Lua - это лексически ограниченный язык. </font><font style="vertical-align: inherit;">Область действия локальной переменной начинается с первого оператора после ее объявления и продолжается до последнего не пустого оператора самого внутреннего блока, который включает объявление. </font><font style="vertical-align: inherit;">Рассмотрим следующий пример:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     х = 10 - глобальная переменная</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     до - новый блок</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       локальный x = x - новый 'x' со значением 10</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       печать (x) -&gt; 10</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       х = х + 1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       делать - еще один блок</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         локальный х = х + 1 - еще один «х»</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         печать (x) -&gt; 12</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       конец</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       печать (x) -&gt; 11</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     конец</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     печать (x) -&gt; 10 (глобальная)</font></font><font></font>
</pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Обратите внимание, что в объявлении, подобном объявленному </font></font><code>local x = x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, новое </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">объявленное еще не находится в области видимости, и поэтому второе </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">относится к внешней переменной.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Из-за лексических правил области видимости локальные переменные могут быть свободно доступны с помощью функций, определенных в их области видимости. </font><font style="vertical-align: inherit;">Локальная переменная, используемая внутренней функцией, называется внутренней </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">величиной</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> или </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">внешней локальной переменной</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> внутри внутренней функции.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Обратите внимание, что каждое выполнение </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">локального</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> оператора определяет новые локальные переменные. </font><font style="vertical-align: inherit;">Рассмотрим следующий пример:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     a = {}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     местный х = 20</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     для я = 1,10 до</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       местный у = 0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       a [i] = function () y = y + 1; </font><font style="vertical-align: inherit;">вернуть x + y end</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     конец</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Цикл создает десять замыканий (то есть десять экземпляров анонимной функции). </font><font style="vertical-align: inherit;">Каждое из этих замыканий использует свою </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">переменную, но все они имеют одинаковые значения </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 - </font></font><a name="4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Интерфейс прикладной программы</font></font></a></h1>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

В этом разделе описывается C API для Lua, то есть набор функций C, доступных для хост-программы для связи с Lua. </font><font style="vertical-align: inherit;">Все функции API и связанные с ними типы и константы объявлены в заголовочном файле </font></font><a name="pdf-lua.h"><code>lua.h</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Даже когда мы используем термин «функция», любое средство в API может быть предоставлено как макрос. </font><font style="vertical-align: inherit;">За исключением случаев, когда указано иное, все такие макросы используют каждый из своих аргументов ровно один раз (за исключением первого аргумента, который всегда является состоянием Lua), и поэтому не создают никаких скрытых побочных эффектов.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Как и в большинстве библиотек C, функции Lua API не проверяют свои аргументы на достоверность или согласованность. </font><font style="vertical-align: inherit;">Однако вы можете изменить это поведение, скомпилировав Lua с </font></font><a name="pdf-LUA_USE_APICHECK"><code>LUA_USE_APICHECK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">определенным </font><font style="vertical-align: inherit;">макросом </font><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Библиотека Lua полностью реентерабельна: в ней нет глобальных переменных. </font><font style="vertical-align: inherit;">Он хранит всю необходимую информацию в динамической структуре, называемой </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">состоянием Lua</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Каждое состояние Lua имеет один или несколько потоков, которые соответствуют независимым, кооперативным линиям исполнения. </font><font style="vertical-align: inherit;">Тип </font></font><a href="#lua_State"><code>lua_State</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(несмотря на название) относится к теме. </font><font style="vertical-align: inherit;">(Косвенно через поток это также относится к состоянию Lua, связанному с потоком.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Указатель на поток должен быть передан в качестве первого аргумента каждой функции в библиотеке, кроме to </font></font><a href="#lua_newstate"><code>lua_newstate</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, которая создает состояние Lua с нуля и возвращает указатель на </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">основной поток</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> в новом состоянии.



</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1 - </font></font><a name="4.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Стек</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua использует </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">виртуальный стек</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> для передачи значений в и из C. Каждый элемент в этом стеке представляет значение Lua ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , число, строка и т. Д.). </font><font style="vertical-align: inherit;">Функции в API могут получить доступ к этому стеку через параметр состояния Lua, который они получают.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Всякий раз, когда Lua вызывает C, вызываемая функция получает новый стек, который не зависит от предыдущих стеков и стеков функций C, которые все еще активны. </font><font style="vertical-align: inherit;">Этот стек изначально содержит любые аргументы для функции C, и именно здесь функция C может хранить временные значения Lua и должна выдавать свои результаты для возврата вызывающей стороне (см. </font></font><a href="#lua_CFunction"><code>lua_CFunction</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Для удобства большинство операций запросов в API не придерживаются строгой стековой дисциплины. </font><font style="vertical-align: inherit;">Вместо этого они могут ссылаться на любой элемент в стеке, используя </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">индекс</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : положительный индекс представляет абсолютную позицию стека (начиная с 1); </font><font style="vertical-align: inherit;">отрицательный индекс представляет смещение относительно вершины стека. </font><font style="vertical-align: inherit;">Более конкретно, если в стеке есть </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> элементов, то индекс 1 представляет первый элемент (то есть элемент, который был помещен в стек первым), а индекс&nbsp; </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет последний элемент; </font><font style="vertical-align: inherit;">Индекс -1 также представляет последний элемент (то есть элемент сверху), а индекс </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-n</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет первый элемент.





</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2 - </font></font><a name="4.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Размер стека</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда вы взаимодействуете с Lua API, вы несете ответственность за обеспечение согласованности. </font><font style="vertical-align: inherit;">В частности,
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">вы несете ответственность за контроль переполнения стека</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Вы можете использовать функцию, </font></font><a href="#lua_checkstack"><code>lua_checkstack</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
чтобы убедиться, что в стеке достаточно места для добавления новых элементов.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Всякий раз, когда Lua вызывает C, он гарантирует, что в стеке есть место как минимум для </font></font><a name="pdf-LUA_MINSTACK"><code>LUA_MINSTACK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">дополнительных слотов.
</font></font><code>LUA_MINSTACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">определяется как 20, так что обычно вам не нужно беспокоиться о стековом пространстве, если в вашем коде нет циклов, помещающих элементы в стек.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда вы вызываете функцию Lua без фиксированного количества результатов (см. </font></font><a href="#lua_call"><code>lua_call</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), Lua гарантирует, что в стеке достаточно места для всех результатов, но не обеспечивает дополнительного пространства. </font><font style="vertical-align: inherit;">Поэтому перед тем, как помещать что-либо в стек после такого вызова, вы должны использовать </font></font><a href="#lua_checkstack"><code>lua_checkstack</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3 - </font></font><a name="4.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Действительные и приемлемые показатели</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Любая функция в API, которая получает индексы стека, работает только с </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">допустимыми индексами</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> или </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">допустимыми индексами</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Допустимый индекс</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет собой индекс , </font><font style="vertical-align: inherit;">который относится к положению , </font><font style="vertical-align: inherit;">которое хранит изменяемое значение Lua. </font><font style="vertical-align: inherit;">Он содержит индексы стека от 1 до стека top ( </font></font><code>1 ≤ abs(index) ≤ top</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) плюс </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">псевдоиндексы</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , которые представляют некоторые позиции, которые доступны для кода C, но которых нет в стеке. </font></font><a href="#4.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Псевдоиндексы</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> используются для доступа к реестру (см. </font><a href="#4.5"><font style="vertical-align: inherit;">§4.5</font></a><font style="vertical-align: inherit;"> ) и значениям функции C (см. </font></font><a href="#4.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Функции, которые не нуждаются в определенной изменяемой позиции, а имеют только значение (например, функции запроса), могут вызываться с приемлемыми индексами. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Приемлемым индекс</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> может быть любым допустимым индексом, но она также может быть любым положительным индексом после вершины стека в </font><font style="vertical-align: inherit;">пределах пространства , </font><font style="vertical-align: inherit;">выделенного для стека, то есть, индексы до размера стека. </font><font style="vertical-align: inherit;">(Обратите внимание, что 0 никогда не является приемлемым индексом.) За исключением случаев, когда указано иное, функции в API работают с приемлемыми индексами.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Приемлемые индексы служат для того, чтобы избежать дополнительных тестов на вершине стека при запросе стека </font><font style="vertical-align: inherit;">Например, функция C может запросить свой третий аргумент без необходимости сначала проверять наличие третьего аргумента, то есть без необходимости проверять, является ли 3 допустимым индексом.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Для функций, которые можно вызывать с приемлемыми индексами, любой недопустимый индекс обрабатывается так, как если бы он содержал значение виртуального типа </font></font><a name="pdf-LUA_TNONE"><code>LUA_TNONE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, которое ведет себя как нулевое значение.





</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4 - </font></font><a name="4.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Закрытие C</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда функция C создается, с ней можно ассоциировать некоторые значения, создавая </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">замыкание C</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
(см. </font></font><a href="#lua_pushcclosure"><code>lua_pushcclosure</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">); </font><font style="vertical-align: inherit;">эти значения называются </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">повышающими значениями</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и доступны для функции всякий раз, когда она вызывается.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Всякий раз, когда вызывается функция C, ее значения повышаются в определенных псевдоиндексов. </font><font style="vertical-align: inherit;">Эти псевдоиндексы создаются макросом
 </font></font><a href="#lua_upvalueindex"><code>lua_upvalueindex</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Первое значение, связанное с функцией, находится в index
 </font></font><code>lua_upvalueindex(1)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и т. Д. </font><font style="vertical-align: inherit;">Любой доступ к </font><font style="vertical-align: inherit;">, где </font><em><font style="vertical-align: inherit;">n</font></em><font style="vertical-align: inherit;"> больше, чем число повышений текущей функции (но не превышает 256, то есть один плюс максимальное число повышений в замыкании), создает приемлемый, но недопустимый индекс.





</font></font><code>lua_upvalueindex(<em>n</em>)</code><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5 - </font></font><a name="4.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Реестр</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua предоставляет </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">реестр</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , предопределенную таблицу, которая может использоваться любым кодом C для хранения любых значений Lua, которые ему нужны для хранения. </font><font style="vertical-align: inherit;">Таблица реестра всегда находится в псевдоиндексе
 </font></font><a name="pdf-LUA_REGISTRYINDEX"><code>LUA_REGISTRYINDEX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Любая библиотека C может хранить данные в этой таблице, но она должна позаботиться о том, чтобы выбрать ключи, которые отличаются от тех, которые используются другими библиотеками, чтобы избежать коллизий. </font><font style="vertical-align: inherit;">Как правило, вы должны использовать в качестве ключа строку, содержащую имя вашей библиотеки, или легкие пользовательские данные с адресом объекта C в вашем коде, или любой объект Lua, созданный вашим кодом. </font><font style="vertical-align: inherit;">Как и в случае с именами переменных, ключи строк, начинающиеся со знака подчеркивания, за которым следуют заглавные буквы, зарезервированы для Lua.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Целочисленные ключи в реестре используются механизмом ссылок (см. </font></font><a href="#luaL_ref"><code>luaL_ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) И некоторыми предопределенными значениями. </font><font style="vertical-align: inherit;">Поэтому целочисленные ключи не должны использоваться для других целей.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда вы создаете новое состояние Lua, его реестр поставляется с некоторыми предопределенными значениями. </font><font style="vertical-align: inherit;">Эти предопределенные значения индексируются с помощью целочисленных ключей, определенных как константы в </font></font><code>lua.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Определены следующие константы:

</font></font></p><ul>
<li><b><a name="pdf-LUA_RIDX_MAINTHREAD"><code>LUA_RIDX_MAINTHREAD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> По этому индексу в реестре есть основной поток состояния. </font><font style="vertical-align: inherit;">(Основной поток - тот, который создан вместе с государством.)
</font></font></li>

<li><b><a name="pdf-LUA_RIDX_GLOBALS"><code>LUA_RIDX_GLOBALS</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> По этому индексу реестр имеет глобальную среду.
</font></font></li>
</ul>




<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.6 - </font></font><a name="4.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Обработка ошибок в C</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Внутренне Lua использует </font></font><code>longjmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">средство </font><font style="vertical-align: inherit;">C </font><font style="vertical-align: inherit;">для обработки ошибок. </font><font style="vertical-align: inherit;">(Lua будет использовать исключения, если вы скомпилируете его как C ++; ищите </font></font><code>LUAI_THROW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">подробности в исходном коде.) Когда Lua сталкивается с какой-либо ощибкой (например, с выделением памяти или типом ощибка), </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возникает</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ощибка; </font><font style="vertical-align: inherit;">то есть он делает длинный прыжок. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Защищенная среда</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> используется </font></font><code>setjmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
для установки точки восстановления; </font><font style="vertical-align: inherit;">любая ощибка переходит на самую последнюю активную точку восстановления.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Внутри функции C вы можете вызвать ощибку, вызвав ее </font></font><a href="#lua_error"><code>lua_error</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Большинство функций в API могут вызывать ощибку, например, из-за выделения памяти. </font><font style="vertical-align: inherit;">В документации по каждой функции указывается, может ли она вызывать ошибки.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если ощибка происходит вне какой-либо защищенной среды, Lua вызывает функцию </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">паники</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (см. </font></font><a href="#lua_atpanic"><code>lua_atpanic</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), А затем вызывает </font></font><code>abort</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, таким образом, выход из хост-приложения. </font><font style="vertical-align: inherit;">Ваша функция паники может избежать этого выхода, никогда не возвращаясь (например, делая длинный прыжок к вашей собственной точке восстановления за пределами Lua).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Функция паники, как следует из ее названия, является последним средством. </font><font style="vertical-align: inherit;">Программы должны избегать этого. </font><font style="vertical-align: inherit;">Как правило, когда функция C вызывается Lua с состоянием Lua, она может делать что угодно с этим состоянием Lua, поскольку она должна быть уже защищена. </font><font style="vertical-align: inherit;">Однако, когда код C работает с другими состояниями Lua (например, параметром Lua функции, состоянием Lua, хранящимся в реестре, или результатом </font></font><a href="#lua_newthread"><code>lua_newthread</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), он должен использовать их только в вызовах API, которые не могут вызвать ошибки.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Функция паники работает так, как если бы она была обработчиком сообщений (см. </font></font><a href="#2.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ); </font><font style="vertical-align: inherit;">в частности, объект ощибка находится на вершине стека. </font><font style="vertical-align: inherit;">Тем не менее, нет никаких гарантий относительно места в стеке. </font><font style="vertical-align: inherit;">Чтобы поместить что-либо в стек, функция паники должна сначала проверить доступное пространство (см. </font></font><a href="#4.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.7 - </font></font><a name="4.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Обработка урожая в C</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Внутренне, Луа использует </font></font><code>longjmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">объект </font><font style="vertical-align: inherit;">С </font><font style="vertical-align: inherit;">для создания сопрограммы. </font><font style="vertical-align: inherit;">Поэтому, если функция C </font></font><code>foo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">вызывает функцию API, и эта функция API возвращает (прямо или косвенно, вызывая другую функцию, которая дает), Lua не может вернуться к ней </font></font><code>foo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">больше, потому что </font></font><code>longjmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">удаляет свой фрейм из стека C.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Чтобы избежать такого рода проблем, Lua поднимает ощибка всякий раз , </font><font style="vertical-align: inherit;">когда он пытается дать через вызова API, для трех функций , за </font><font style="vertical-align: inherit;">исключением:
 </font></font><a href="#lua_yieldk"><code>lua_yieldk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="#lua_callk"><code>lua_callk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><a href="#lua_pcallk"><code>lua_pcallk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Все эти функции получают функцию </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">продолжения</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
(в качестве именованного параметра </font></font><code>k</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) для продолжения выполнения после выхода.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Нам нужно установить некоторую терминологию, чтобы объяснить продолжения. </font><font style="vertical-align: inherit;">У нас есть функция C, вызванная из Lua, которую мы будем называть </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">исходной функцией</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Эта оригинальная функция затем вызывает одну из этих трех функций в C API, которую мы будем называть </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функцией вызываемого</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , которая затем возвращает текущий поток. </font><font style="vertical-align: inherit;">(Это может произойти, когда функция вызываемого абонента является </font></font><a href="#lua_yieldk"><code>lua_yieldk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или когда функция вызываемого абонента либо либо, </font></font><a href="#lua_callk"><code>lua_callk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">либо </font></font><a href="#lua_pcallk"><code>lua_pcallk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
и </font><font style="vertical-align: inherit;">вызываемая ими функция </font><font style="vertical-align: inherit;">выдает.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Предположим, что работающий поток уступает при выполнении функции callee. </font><font style="vertical-align: inherit;">После возобновления потока он в конечном итоге завершит выполнение функции callee. </font><font style="vertical-align: inherit;">Однако функция вызываемого не может вернуться к исходной функции, потому что ее кадр в стеке C был уничтожен выходом. </font><font style="vertical-align: inherit;">Вместо этого Lua вызывает функцию </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">продолжения</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , которая была задана в качестве аргумента функции вызываемого абонента. </font><font style="vertical-align: inherit;">Как следует из названия, функция продолжения должна продолжить задачу исходной функции.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В качестве иллюстрации рассмотрим следующую функцию:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     int original_function (lua_State * L) {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       ... / * код 1 * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       status = lua_pcall (L, n, m, h); </font><font style="vertical-align: inherit;">/ * звонит Луа * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       ... / * код 2 * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     }</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Теперь мы хотим, чтобы выполняемый код Lua </font></font><a href="#lua_pcall"><code>lua_pcall</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">дал результат. </font><font style="vertical-align: inherit;">Во-первых, мы можем переписать нашу функцию как здесь:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     int k (lua_State * L, int status, lua_KContext ctx) {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       ... / * код 2 * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     }</font></font><font></font>
     <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     int original_function (lua_State * L) {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       ... / * код 1 * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       return k (L, lua_pcall (L, n, m, h), ctx);</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     }</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В приведенном выше коде новая функция </font></font><code>k</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является
 </font><font style="vertical-align: inherit;">функцией </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">продолжения</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (с типом </font></font><a href="#lua_KFunction"><code>lua_KFunction</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), которая должна выполнять всю работу, которую выполняла исходная функция после вызова </font></font><a href="#lua_pcall"><code>lua_pcall</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Теперь мы должны сообщить Lua, что он должен вызывать, </font></font><code>k</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если выполняемый с помощью кода Lua </font></font><a href="#lua_pcall"><code>lua_pcall</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">каким-либо образом прерывается (ошибки или уступки), поэтому мы переписываем код, как показано здесь, заменяя </font></font><a href="#lua_pcall"><code>lua_pcall</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">на </font></font><a href="#lua_pcallk"><code>lua_pcallk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     int original_function (lua_State * L) {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       ... / * код 1 * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       return k (L, lua_pcallk (L, n, m, h, ctx2, k), ctx1);</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     }</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Обратите внимание на внешний явный вызов продолжения: Lua будет вызывать продолжение только в случае необходимости, то есть в случае ошибок или возобновления после выхода. </font><font style="vertical-align: inherit;">Если вызываемая функция возвращается нормально, никогда не уступая,
 </font></font><a href="#lua_pcallk"><code>lua_pcallk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(и </font></font><a href="#lua_callk"><code>lua_callk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) также будет возвращаться нормально. </font><font style="vertical-align: inherit;">(Конечно, вместо вызова продолжения в этом случае вы можете выполнить эквивалентную работу непосредственно внутри исходной функции.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Помимо состояния Lua, функция продолжения имеет два других параметра: окончательный статус вызова плюс значение контекста ( </font></font><code>ctx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), которое было передано первоначально </font></font><a href="#lua_pcallk"><code>lua_pcallk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(Lua не использует это значение контекста; оно только передает это значение из исходной функции в функцию продолжения.) Для </font></font><a href="#lua_pcallk"><code>lua_pcallk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">состояния это то же значение, которое будет возвращено </font></font><a href="#lua_pcallk"><code>lua_pcallk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, за исключением того, что оно выполняется </font></font><a href="#pdf-LUA_YIELD"><code>LUA_YIELD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">при выполнении после выхода (вместо из </font></font><a href="#pdf-LUA_OK"><code>LUA_OK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Для </font></font><a href="#lua_yieldk"><code>lua_yieldk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><a href="#lua_callk"><code>lua_callk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, статус всегда, </font></font><a href="#pdf-LUA_YIELD"><code>LUA_YIELD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">когда Lua вызывает продолжение. </font><font style="vertical-align: inherit;">(Для этих двух функций Lua не будет вызывать продолжение в случае ошибок, поскольку они не обрабатывают ошибки.) Аналогичным образом, при использовании </font></font><a href="#lua_callk"><code>lua_callk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">вы должны вызывать функцию продолжения со </font></font><a href="#pdf-LUA_OK"><code>LUA_OK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">статусом. </font><font style="vertical-align: inherit;">( </font></font><a href="#lua_yieldk"><code>lua_yieldk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Нет смысла напрямую вызывать функцию продолжения, потому что </font></font><a href="#lua_yieldk"><code>lua_yieldk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">обычно она не возвращается.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua рассматривает функцию продолжения так, как если бы она была исходной функцией. </font><font style="vertical-align: inherit;">Функция продолжения получает тот же стек Lua от исходной функции, в том же состоянии, в котором она была бы, если бы функция вызываемого объекта была возвращена. </font><font style="vertical-align: inherit;">(Например, после того, </font></font><a href="#lua_callk"><code>lua_callk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">как функция и ее аргументы будут удалены из стека и заменены результатами вызова.) Она также имеет те же значения повышения. </font><font style="vertical-align: inherit;">Все, что он возвращает, обрабатывается Lua, как если бы это было возвращение исходной функции.





</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8 - </font></font><a name="4.8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Функции и типы</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Здесь мы перечисляем все функции и типы из C API в алфавитном порядке. </font><font style="vertical-align: inherit;">У каждой функции есть такой индикатор:
 </font></font><span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-o, + p, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>


</p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Первое поле </font></font><code>o</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- это количество элементов, которые функция извлекает из стека. </font><font style="vertical-align: inherit;">Второе поле </font></font><code>p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- это количество элементов, которые функция помещает в стек. </font><font style="vertical-align: inherit;">(Любая функция всегда отправляет свои результаты после добавления аргументов.) Поле в форме </font></font><code>x|y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">означает, что функция может выдвигать (или выдавать)
 </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">элементы, в зависимости от ситуации; </font><font style="vertical-align: inherit;">знак опроса ' </font></font><code>?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' означает, что мы не можем знать, сколько элементов функция выдает / толкает, рассматривая только ее аргументы (например, они могут зависеть от того, что находится в стеке). </font><font style="vertical-align: inherit;">Третье поле, </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">сообщает, может ли функция вызывать ошибки: ' </font></font><code>-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' означает, что функция никогда не вызывает никакой ощибка; </font><font style="vertical-align: inherit;">' </font></font><code>m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' означает, что функция может вызывать ошибки </font></font><code>__gc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нехватки </font><font style="vertical-align: inherit;">памяти и ошибки при выполнении </font><font style="vertical-align: inherit;">метаметода; </font><font style="vertical-align: inherit;">' </font></font><code>e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' означает, что функция может вызвать любые ошибки (она может запускать произвольный код Lua, либо напрямую, либо через метаметоды); </font><font style="vertical-align: inherit;">' </font></font><code>v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' означает, что функция может вызывать ощибку специально.



</font></font></p><hr><h3><a name="lua_absindex"><code>lua_absindex</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_absindex (lua_State * L, int idx);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразует допустимый индекс </font></font><code>idx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
в эквивалентный абсолютный индекс (то есть тот, который не зависит от вершины стека).





</font></font></p><hr><h3><a name="lua_Alloc"><code>lua_Alloc</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typedef void * (* lua_Alloc) (void * ud,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                             void * ptr,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                             size_t osize,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                             size_t nsize);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Тип функции выделения памяти, используемой Lua. </font><font style="vertical-align: inherit;">Функция распределителя должна обеспечивать функциональность, аналогичную </font></font><code>realloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, но не точно такую ​​же. </font><font style="vertical-align: inherit;">Его аргументы
 </font></font><code>ud</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- непрозрачный указатель, переданный </font></font><a href="#lua_newstate"><code>lua_newstate</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font><code>ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">указатель на выделенный / перераспределенный / освобожденный блок;
</font></font><code>osize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">исходный размер блока или некоторый код о том, что распределяется; </font><font style="vertical-align: inherit;">и </font></font><code>nsize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">новый размер блока.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда </font></font><code>ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нет </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><code>osize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это размер блока, на который указывает </font></font><code>ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, то есть размер, указанный при его распределении или перераспределении.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда </font></font><code>ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><code>osize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">кодирует тип объекта, который Lua выделяет.
</font></font><code>osize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">представляет собой любой из
 </font></font><a href="#pdf-LUA_TSTRING"><code>LUA_TSTRING</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="#pdf-LUA_TTABLE"><code>LUA_TTABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="#pdf-LUA_TFUNCTION"><code>LUA_TFUNCTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a href="#pdf-LUA_TUSERDATA"><code>LUA_TUSERDATA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, или , </font></font><a href="#pdf-LUA_TTHREAD"><code>LUA_TTHREAD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">когда (и только тогда , </font><font style="vertical-align: inherit;">когда Лу) создают новый объект этого типа. </font><font style="vertical-align: inherit;">Когда </font></font><code>osize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть какое-то другое значение, Lua выделяет память для чего-то другого.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua предполагает следующее поведение из функции распределителя:


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда </font></font><code>nsize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль, распределитель должен вести себя как </font></font><code>free</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
и возвращать </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда </font></font><code>nsize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не ноль, распределитель должен вести себя как </font></font><code>realloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Распределитель возвращается </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
тогда и только тогда, когда он не может выполнить запрос. </font><font style="vertical-align: inherit;">Lua предполагает, что распределитель никогда не выходит из строя, когда
 </font></font><code>osize &gt;= nsize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вот простая реализация функции распределителя. </font><font style="vertical-align: inherit;">Он используется во вспомогательной библиотеке </font></font><a href="#luaL_newstate"><code>luaL_newstate</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     static void * l_alloc (void * ud, void * ptr, size_t osize,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                                                size_t nsize) {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       (Недействительными) уд; </font><font style="vertical-align: inherit;">(Пустоты) osize; </font><font style="vertical-align: inherit;">/* не используется */</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       if (nsize == 0) {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         свободный (PTR);</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         вернуть NULL;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       еще</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         вернуть realloc (ptr, nsize);</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     }</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Обратите внимание, что Стандарт C гарантирует, что </font></font><code>free(NULL)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это не имеет никакого эффекта и
 </font></font><code>realloc(NULL,size)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">эквивалентно </font></font><code>malloc(size)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">В этом коде предполагается, что </font></font><code>realloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не происходит сбой при сжатии блока. </font><font style="vertical-align: inherit;">(Хотя Стандарт C не обеспечивает такого поведения, это, кажется, безопасное предположение.)





</font></font></p><hr><h3><a name="lua_arith"><code>lua_arith</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- (2 | 1), +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_arith (lua_State * L, int op);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Выполняет арифметическую или побитовую операцию над двумя значениями (или одним, в случае отрицаний) в верхней части стека, причем значение в верхней части является вторым операндом, извлекает эти значения и выводит результат операции. </font><font style="vertical-align: inherit;">Функция следует семантике соответствующего оператора Lua (то есть может вызывать метаметоды).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Значение </font></font><code>op</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должно быть одной из следующих констант:

</font></font></p><ul>

<li><b><a name="pdf-LUA_OPADD"><code>LUA_OPADD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняет сложение ( </font></font><code>+</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><a name="pdf-LUA_OPSUB"><code>LUA_OPSUB</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняет вычитание ( </font></font><code>-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><a name="pdf-LUA_OPMUL"><code>LUA_OPMUL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняет умножение ( </font></font><code>*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><a name="pdf-LUA_OPDIV"><code>LUA_OPDIV</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняет деление поплавка ( </font></font><code>/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><a name="pdf-LUA_OPIDIV"><code>LUA_OPIDIV</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняет разделение по полу ( </font></font><code>//</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><a name="pdf-LUA_OPMOD"><code>LUA_OPMOD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняет по модулю ( </font></font><code>%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><a name="pdf-LUA_OPPOW"><code>LUA_OPPOW</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняет возведение в степень ( </font></font><code>^</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><a name="pdf-LUA_OPUNM"><code>LUA_OPUNM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняет математическое отрицание (унарный </font></font><code>-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><a name="pdf-LUA_OPBNOT"><code>LUA_OPBNOT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняет побитовое НЕ ( </font></font><code>~</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><a name="pdf-LUA_OPBAND"><code>LUA_OPBAND</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняет побитовое И ( </font></font><code>&amp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><a name="pdf-LUA_OPBOR"><code>LUA_OPBOR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняет побитовое ИЛИ ( </font></font><code>|</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><a name="pdf-LUA_OPBXOR"><code>LUA_OPBXOR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняет побитовое исключающее ИЛИ ( </font></font><code>~</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><a name="pdf-LUA_OPSHL"><code>LUA_OPSHL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняет сдвиг влево ( </font></font><code>&lt;&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><a name="pdf-LUA_OPSHR"><code>LUA_OPSHR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняет сдвиг вправо ( </font></font><code>&gt;&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>

</ul>




<hr><h3><a name="lua_atpanic"><code>lua_atpanic</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_CFunction lua_atpanic (lua_State * L, lua_CFunction panicf);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Устанавливает новую функцию паники и возвращает старую (см. </font></font><a href="#4.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><hr><h3><a name="lua_call"><code>lua_call</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- (nargs + 1), + nresults, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_call (lua_State * L, int nargs, int nresults);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вызывает функцию.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Для вызова функции необходимо использовать следующий протокол: сначала вызываемая функция помещается в стек; </font><font style="vertical-align: inherit;">затем аргументы функции передаются в прямом порядке; </font><font style="vertical-align: inherit;">то есть первый аргумент выдвигается первым. </font><font style="vertical-align: inherit;">Наконец вы звоните </font></font><a href="#lua_call"><code>lua_call</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font><code>nargs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это количество аргументов, которые вы выдвинули в стек. </font><font style="vertical-align: inherit;">Все аргументы и значение функции извлекаются из стека при вызове функции. </font><font style="vertical-align: inherit;">Результаты функции помещаются в стек, когда функция возвращается. </font><font style="vertical-align: inherit;">Количество результатов устанавливают </font></font><code>nresults</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, если </font></font><code>nresults</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не </font></font><a name="pdf-LUA_MULTRET"><code>LUA_MULTRET</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">В этом случае все результаты функции передаются; </font><font style="vertical-align: inherit;">Lua заботится о том, чтобы возвращаемые значения помещались в пространство стека, но это не обеспечивает дополнительного пространства в стеке. </font><font style="vertical-align: inherit;">Результаты функции помещаются в стек в прямом порядке (первый результат помещается первым), так что после вызова последний результат находится на вершине стека.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Любая ощибка внутри вызываемой функции распространяется вверх (с помощью а </font></font><code>longjmp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В следующем примере показано, как хост-программа может сделать эквивалент этого кода Lua:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     a = f («как», tx, 14)
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вот это в C:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     lua_getglobal (L, "f"); </font><font style="vertical-align: inherit;">/ * функция для вызова * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     lua_pushliteral (L, "как"); </font><font style="vertical-align: inherit;">/ * 1-й аргумент * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     lua_getglobal (L, "t"); </font><font style="vertical-align: inherit;">/ * таблица для индексации * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     lua_getfield (L, -1, "x"); </font><font style="vertical-align: inherit;">/ * результат нажатия tx (2nd arg) * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     lua_remove (L, -2); </font><font style="vertical-align: inherit;">/ * удалить 't' из стека * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     lua_pushinteger (L, 14); </font><font style="vertical-align: inherit;">/ * 3-й аргумент * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     lua_call (L, 3, 1); </font><font style="vertical-align: inherit;">/ * вызвать 'f' с 3 аргументами и 1 результатом * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     lua_setglobal (L, "a"); </font><font style="vertical-align: inherit;">/ * установить глобальное 'a' * /</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Обратите внимание, что приведенный выше код </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">сбалансирован</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : в конце стек возвращается к своей первоначальной конфигурации. </font><font style="vertical-align: inherit;">Это считается хорошей практикой программирования.





</font></font></p><hr><h3><a name="lua_callk"><code>lua_callk</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- (nargs + 1), + nresults, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_callk (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                Int Nargs,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                int nresults,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                lua_KContext ctx,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                lua_KFunction k);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция ведет себя точно так же </font></font><a href="#lua_call"><code>lua_call</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, но позволяет вызываемой функции дать результат (см. </font></font><a href="#4.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><hr><h3><a name="lua_CFunction"><code>lua_CFunction</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typedef int (* lua_CFunction) (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Тип для функций C.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Чтобы правильно взаимодействовать с Lua, функция C должна использовать следующий протокол, который определяет способ передачи параметров и результатов: функция C получает свои аргументы от Lua в своем стеке в прямом порядке (первый аргумент передается первым). </font><font style="vertical-align: inherit;">Итак, когда функция запускается,
 </font></font><code>lua_gettop(L)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает количество аргументов, полученных функцией. </font><font style="vertical-align: inherit;">Первый аргумент (если есть) находится в индексе 1, а его последний аргумент - в индексе </font></font><code>lua_gettop(L)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Чтобы вернуть значения Lua, функция C просто помещает их в стек в прямом порядке (первый результат помещается первым) и возвращает количество результатов. </font><font style="vertical-align: inherit;">Любое другое значение в стеке ниже результатов будет корректно отброшено Lua. </font><font style="vertical-align: inherit;">Как и функция Lua, функция C, вызываемая Lua, также может возвращать много результатов.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Например, следующая функция получает переменное число числовых аргументов и возвращает их среднее значение и их сумму:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     static int foo (lua_State * L) {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       int n = lua_gettop (L); </font><font style="vertical-align: inherit;">/ * количество аргументов * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       lua_Number sum = 0.0;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       int i;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       для (i = 1; i &lt;= n; i ++) {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         if (! lua_isnumber (L, i)) {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           lua_pushliteral (L, «неверный аргумент»);</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           lua_error (L);</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         sum + = lua_tonumber (L, i);</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       }</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       lua_pushnumber (L, сумма / n); </font><font style="vertical-align: inherit;">/ * первый результат * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       lua_pushnumber (L, сумма); </font><font style="vertical-align: inherit;">/ * второй результат * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       возврат 2; </font><font style="vertical-align: inherit;">/ * количество результатов * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     }</font></font><font></font>
</pre>




<hr><h3><a name="lua_checkstack"><code>lua_checkstack</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_checkstack (lua_State * L, int n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Гарантирует, что в стеке есть место, по крайней мере, для </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">дополнительных слотов (то есть вы можете безопасно увеличивать </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">значения в нем). </font><font style="vertical-align: inherit;">Он возвращает false, если не может выполнить запрос, либо потому, что это приведет к тому, что размер стека будет превышать фиксированный максимальный размер (обычно не менее нескольких тысяч элементов), либо потому, что он не сможет выделить память для дополнительного пространства. </font><font style="vertical-align: inherit;">Эта функция никогда не сжимает стек; </font><font style="vertical-align: inherit;">если в стеке уже есть место для дополнительных слотов, он остается без изменений.





</font></font></p><hr><h3><a name="lua_close"><code>lua_close</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_close (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Уничтожает все объекты в данном состоянии Lua (вызывая соответствующие метаметоды сбора мусора, если таковые имеются) и освобождает всю динамическую память, используемую этим состоянием. </font><font style="vertical-align: inherit;">На некоторых платформах вам может не понадобиться вызывать эту функцию, потому что все ресурсы естественным образом высвобождаются после завершения работы хост-программы. </font><font style="vertical-align: inherit;">С другой стороны, долго работающие программы, которые создают несколько состояний, такие как демоны или веб-серверы, вероятно, должны будут закрывать состояния, как только они не нужны.





</font></font></p><hr><h3><a name="lua_compare"><code>lua_compare</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_compare (lua_State * L, int index1, int index2, int op);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Сравнивает два значения Lua. </font><font style="vertical-align: inherit;">Возвращает 1, если значение по индексу </font></font><code>index1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">удовлетворяет </font></font><code>op</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
при сравнении со значением по индексу </font></font><code>index2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, следуя семантике соответствующего оператора Lua (то есть он может вызывать метаметоды). </font><font style="vertical-align: inherit;">В противном случае возвращает 0. Также возвращает 0, если какой-либо из индексов недействителен.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Значение </font></font><code>op</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должно быть одной из следующих констант:

</font></font></p><ul>

<li><b><a name="pdf-LUA_OPEQ"><code>LUA_OPEQ</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> сравнивает на равенство ( </font></font><code>==</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><a name="pdf-LUA_OPLT"><code>LUA_OPLT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> сравнивается меньше ( </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><a name="pdf-LUA_OPLE"><code>LUA_OPLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> сравнивает для меньших или равных ( </font></font><code>&lt;=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>

</ul>




<hr><h3><a name="lua_concat"><code>lua_concat</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-n, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_concat (lua_State * L, int n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Объединяет </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">значения в верхней части стека, извлекает их и оставляет результат в верхней части. </font><font style="vertical-align: inherit;">Если </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;равно 1, результатом является единственное значение в стеке (то есть функция ничего не делает); </font><font style="vertical-align: inherit;">если </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0, результатом является пустая строка. </font><font style="vertical-align: inherit;">Конкатенация выполняется в соответствии с обычной семантикой Lua (см. </font></font><a href="#3.4.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><hr><h3><a name="lua_copy"><code>lua_copy</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_copy (lua_State * L, int fromidx, int toidx);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Копирует элемент с индексом </font></font><code>fromidx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
в действительный индекс </font></font><code>toidx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, заменяя значение в этой позиции. </font><font style="vertical-align: inherit;">Значения на других позициях не затрагиваются.





</font></font></p><hr><h3><a name="lua_createtable"><code>lua_createtable</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_createtable (lua_State * L, int narr, int nrec);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Создает новую пустую таблицу и помещает ее в стек. </font><font style="vertical-align: inherit;">Параметр </font></font><code>narr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- это подсказка, сколько элементов таблица будет иметь в виде последовательности; </font><font style="vertical-align: inherit;">Параметр </font></font><code>nrec</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является подсказкой, сколько других элементов будет иметь таблица. </font><font style="vertical-align: inherit;">Lua может использовать эти подсказки для предварительного выделения памяти для новой таблицы. </font><font style="vertical-align: inherit;">Это предварительное распределение полезно для производительности, когда вы заранее знаете, сколько элементов будет иметь таблица. </font><font style="vertical-align: inherit;">В противном случае вы можете использовать функцию </font></font><a href="#lua_newtable"><code>lua_newtable</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_dump"><code>lua_dump</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_dump (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                        писатель-писатель,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                        void * data,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                        int strip);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Выдает функцию в виде двоичного фрагмента. </font><font style="vertical-align: inherit;">Получает функцию Lua в верхней части стека и создает двоичный фрагмент, который при повторной загрузке приводит к функции, эквивалентной выгруженной функции. </font><font style="vertical-align: inherit;">Поскольку он генерирует части куска,
 </font></font><a href="#lua_dump"><code>lua_dump</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">вызывает функцию </font></font><code>writer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(см. </font></font><a href="#lua_Writer"><code>lua_Writer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) С заданной </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
для их записи.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>strip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это правда, двоичное представление может не включать всю отладку информации о функции, чтобы сэкономить место.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращаемое значение - это код ощибка, возвращаемый последним вызовом писателя; </font><font style="vertical-align: inherit;">0 означает отсутствие ошибок.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция не извлекает функцию Lua из стека.





</font></font></p><hr><h3><a name="lua_error"><code>lua_error</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_error (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Создает ощибку Lua, используя значение в верхней части стека в качестве объекта ощибка. </font><font style="vertical-align: inherit;">Эта функция делает длинный прыжок и поэтому никогда не возвращается (см. </font></font><a href="#luaL_error"><code>luaL_error</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).





</font></font></p><hr><h3><a name="lua_gc"><code>lua_gc</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_gc (lua_State * L, int what, int data);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Управляет сборщиком мусора.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция выполняет несколько задач в соответствии со значением параметра </font></font><code>what</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:

</font></font></p><ul>

<li><b><code>LUA_GCSTOP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
останавливает сборщик мусора.
</font></font></li>

<li><b><code>LUA_GCRESTART</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
перезапускает сборщик мусора.
</font></font></li>

<li><b><code>LUA_GCCOLLECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
выполняет полный цикл сбора мусора.
</font></font></li>

<li><b><code>LUA_GCCOUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
возвращает текущий объем памяти (в килобайтах), используемый Lua.
</font></font></li>

<li><b><code>LUA_GCCOUNTB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
возвращает остаток от деления текущего количества байтов используемой Lua памяти на 1024.
</font></font></li>

<li><b><code>LUA_GCSTEP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
выполняет пошаговый сбор мусора.
</font></font></li>

<li><b><code>LUA_GCSETPAUSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
устанавливает </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в качестве нового значения </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">паузы</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> коллектора (см. </font></font><a href="#2.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) и возвращает предыдущее значение паузы.
</font></font></li>

<li><b><code>LUA_GCSETSTEPMUL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
устанавливает </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в качестве нового значения </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">множитель шага</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> коллектора (см. </font></font><a href="#2.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) и возвращает предыдущее значение множителя шага.
</font></font></li>

<li><b><code>LUA_GCISRUNNING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
возвращает логическое значение, указывающее, работает ли сборщик (т. е. не остановлен).
</font></font></li>

</ul>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Подробнее об этих параметрах см </font></font><a href="#pdf-collectgarbage"><code>собратьмусор</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_getallocf"><code>lua_getallocf</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_Alloc lua_getallocf (lua_State * L, void ** ud);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает функцию выделения памяти для данного состояния. </font><font style="vertical-align: inherit;">Если </font></font><code>ud</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это не так </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Lua сохраняет </font></font><code>*ud</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">непрозрачный указатель, заданный, когда была установлена ​​функция выделения памяти.





</font></font></p><hr><h3><a name="lua_getfield"><code>lua_getfield</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_getfield (lua_State * L, int index, const char * k);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Выдвигает в стек значение </font></font><code>t[k]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, где </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">находится значение по данному индексу. </font><font style="vertical-align: inherit;">Как и в Lua, эта функция может запускать метаметод для события «index» (см. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает тип толкаемого значения.





</font></font></p><hr><h3><a name="lua_getextraspace"><code>lua_getextraspace</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void * lua_getextraspace (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает указатель на необработанную область памяти, связанную с данным состоянием Lua. </font><font style="vertical-align: inherit;">Приложение может использовать эту область для любых целей; </font><font style="vertical-align: inherit;">Луа не использует это ни для чего.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Каждый новый поток имеет эту область, инициализированную копией области основного потока.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
По умолчанию эта область имеет размер указателя на void, но вы можете перекомпилировать Lua с другим размером для этой области. </font><font style="vertical-align: inherit;">(См </font></font><code>LUA_EXTRASPACE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в </font></font><code>luaconf.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.)





</font></font></p><hr><h3><a name="lua_getglobal"><code>lua_getglobal</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_getglobal (lua_State * L, const char * name);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Выдвигает в стек значение глобала </font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Возвращает тип этого значения.





</font></font></p><hr><h3><a name="lua_geti"><code>lua_geti</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_geti (lua_State * L, int index, lua_Integer i);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Выдвигает в стек значение </font></font><code>t[i]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, где </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">находится значение по данному индексу. </font><font style="vertical-align: inherit;">Как и в Lua, эта функция может запускать метаметод для события «index» (см. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает тип толкаемого значения.





</font></font></p><hr><h3><a name="lua_getmetatable"><code>lua_getmetatable</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, + (0 | 1), -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_getmetatable (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если значение по указанному индексу имеет метатаблицу, функция помещает метатаблицу в стек и возвращает 1. В противном случае функция возвращает 0 и ничего не помещает в стек.





</font></font></p><hr><h3><a name="lua_gettable"><code>lua_gettable</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_gettable (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Выдвигает в стек значение </font></font><code>t[k]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, где </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- значение по данному индексу и </font></font><code>k</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">значение в верхней части стека.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция извлекает ключ из стека, помещая полученное значение на свое место. </font><font style="vertical-align: inherit;">Как и в Lua, эта функция может запускать метаметод для события «index» (см. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает тип толкаемого значения.





</font></font></p><hr><h3><a name="lua_gettop"><code>lua_gettop</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_gettop (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает индекс верхнего элемента в стеке. </font><font style="vertical-align: inherit;">Поскольку индексы начинаются с 1, этот результат равен количеству элементов в стеке; </font><font style="vertical-align: inherit;">в частности, 0 означает пустой стек.





</font></font></p><hr><h3><a name="lua_getuservalue"><code>lua_getuservalue</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_getuservalue (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Помещает в стек значение Lua, связанное с полными данными пользователя по данному индексу.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает тип толкаемого значения.





</font></font></p><hr><h3><a name="lua_insert"><code>lua_insert</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_insert (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Перемещает верхний элемент в заданный допустимый индекс, сдвигая элементы выше этого индекса в открытое пространство. </font><font style="vertical-align: inherit;">Эту функцию нельзя вызывать с помощью псевдоиндекса, поскольку псевдоиндекс не является фактической позицией стека.





</font></font></p><hr><h3><a name="lua_Integer"><code>lua_Integer</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typedef ... lua_Integer;</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Тип целых чисел в Lua.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
По умолчанию это тип </font></font><code>long long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(обычно 64-разрядное целое число из двух дополнений), но его можно изменить на </font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(обычно 32-разрядное целое число из двух дополнений). </font><font style="vertical-align: inherit;">(См </font></font><code>LUA_INT_TYPE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в </font></font><code>luaconf.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua также определяет константы
 </font></font><a name="pdf-LUA_MININTEGER"><code>LUA_MININTEGER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><a name="pdf-LUA_MAXINTEGER"><code>LUA_MAXINTEGER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, с минимальными и максимальными значениями, которые соответствуют этому типу.





</font></font></p><hr><h3><a name="lua_isboolean"><code>lua_isboolean</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_isboolean (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает 1, если значение по данному индексу является логическим, и 0 в противном случае.





</font></font></p><hr><h3><a name="lua_iscfunction"><code>lua_iscfunction</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_iscfunction (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает 1, если значение по данному индексу является функцией C, и 0 в противном случае.





</font></font></p><hr><h3><a name="lua_isfunction"><code>lua_isfunction</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_isfunction (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает 1, если значение по данному индексу является функцией (либо C, либо Lua), и 0 в противном случае.





</font></font></p><hr><h3><a name="lua_isinteger"><code>lua_isinteger</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_isinteger (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает 1, если значение в данном индексе является целым числом (то есть значение является числом и представляется как целое число), и 0 в противном случае.





</font></font></p><hr><h3><a name="lua_islightuserdata"><code>lua_islightuserdata</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_islightuserdata (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает 1, если значение по указанному индексу является легкой пользовательской информацией, и 0 в противном случае.





</font></font></p><hr><h3><a name="lua_isnil"><code>lua_isnil</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_isnil (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает 1, если значение по данному индексу равно </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , и 0 в противном случае.





</font></font></p><hr><h3><a name="lua_isnone"><code>lua_isnone</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_isnone (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает 1, если данный индекс недействителен, и 0 в противном случае.





</font></font></p><hr><h3><a name="lua_isnoneornil"><code>lua_isnoneornil</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_isnoneornil (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает 1, если данный индекс недопустим или если значение этого индекса равно </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нулю</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , и 0 в противном случае.





</font></font></p><hr><h3><a name="lua_isnumber"><code>lua_isnumber</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_isnumber (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает 1, если значение по данному индексу является числом или строкой, конвертируемой в число, и 0 в противном случае.





</font></font></p><hr><h3><a name="lua_isstring"><code>lua_isstring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_isstring (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает 1, если значением по данному индексу является строка или число (которое всегда можно преобразовать в строку), и 0 в противном случае.





</font></font></p><hr><h3><a name="lua_istable"><code>lua_istable</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_istable (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает 1, если значение по данному индексу является таблицей, и 0 в противном случае.





</font></font></p><hr><h3><a name="lua_isthread"><code>lua_isthread</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_isthread (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает 1, если значение по данному индексу является потоком, и 0 в противном случае.





</font></font></p><hr><h3><a name="lua_isuserdata"><code>lua_isuserdata</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_isuserdata (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает 1, если значение по данному индексу является пользовательскими данными (полными или легкими), и 0 в противном случае.





</font></font></p><hr><h3><a name="lua_isyieldable"><code>lua_isyieldable</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_isyieldable (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает 1, если данная сопрограммы может дать, и 0 в противном случае.





</font></font></p><hr><h3><a name="lua_KContext"><code>lua_KContext</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typedef ... lua_KContext;</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Тип для контекстов функции продолжения. </font><font style="vertical-align: inherit;">Это должен быть числовой тип. </font><font style="vertical-align: inherit;">Этот тип определяется как , </font></font><code>intptr_t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
когда </font></font><code>intptr_t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть в </font><font style="vertical-align: inherit;">наличии, так что он может хранить указатели тоже. </font><font style="vertical-align: inherit;">В противном случае он определяется как </font></font><code>ptrdiff_t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_KFunction"><code>lua_KFunction</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typedef int (* lua_KFunction) (lua_State * L, int status, lua_KContext ctx);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Тип для функций продолжения (см. </font></font><a href="#4.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><hr><h3><a name="lua_len"><code>lua_len</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_len (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает длину значения по указанному индексу. </font><font style="vertical-align: inherit;">Он эквивалентен </font></font><code>#</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">оператору </font><font style="vertical-align: inherit;">' </font><font style="vertical-align: inherit;">' в Lua (см. </font></font><a href="#3.4.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) и может вызывать метаметод для события «length» (см. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Результат помещается в стек.





</font></font></p><hr><h3><a name="lua_load"><code>lua_load</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_load (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              читатель lua_Reader,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              void * data,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              const char * chunkname,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              режим const char *);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Загружает кусок Lua без его запуска. </font><font style="vertical-align: inherit;">Если ошибок нет,
 </font></font><code>lua_load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">выталкивает скомпилированный кусок как функцию Lua на вершину стека. </font><font style="vertical-align: inherit;">Иначе, это выдвигает ощибка сообщения.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращаемые значения </font></font><code>lua_load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:

</font></font></p><ul>

<li><b><a href="#pdf-LUA_OK"><code>LUA_OK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> нет ошибок;</font></font></li>

<li><b><a name="pdf-LUA_ERRSYNTAX"><code>LUA_ERRSYNTAX</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
синтаксис ощибка во время прекомпиляции;</font></font></li>

<li><b><a href="#pdf-LUA_ERRMEM"><code>LUA_ERRMEM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
выделение памяти (out-of-memory) ощибка;</font></font></li>

<li><b><a href="#pdf-LUA_ERRGCMM"><code>LUA_ERRGCMM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ощибка во время бега </font></font><code>__gc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметода. </font><font style="vertical-align: inherit;">(Эта ощибка не имеет отношения к загружаемому чанку. Она генерируется сборщиком мусора.)
</font></font></li>

</ul>

<p><font style="vertical-align: inherit;"></font><code>lua_load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Функция использует предоставленный пользователем </font></font><code>reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функцию , </font><font style="vertical-align: inherit;">чтобы прочитать кусок (см </font></font><a href="#lua_Reader"><code>lua_Reader</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Аргумент является непрозрачным значением , </font><font style="vertical-align: inherit;">переданным в функцию устройства считывания.


</font></font></p><p><font style="vertical-align: inherit;"></font><code>chunkname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Аргумент дает название фрагмента, который используется для ощибка сообщений и информации (Отладка см </font></font><a href="#4.9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.9</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).


</font></font></p><p>
<code>lua_load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">автоматически определяет, является ли чанк текстовым или двоичным, и загружает его соответствующим образом (см. программу </font></font><code>luac</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Строка </font></font><code>mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">работает как в функции </font></font><a href="#pdf-load"><code>загрузить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, с добавлением, что </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">значение эквивалентно строке " </font></font><code>bt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">".


</font></font></p><p>
<code>lua_load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> использует стек внутренне, поэтому функция чтения всегда должна оставлять стек неизмененным при возврате.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если результирующая функция имеет значения upval, ее первое значение upvalue устанавливается равным значению глобальной среды, хранящейся в индексе </font></font><code>LUA_RIDX_GLOBALS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в реестре (см. </font></font><a href="#4.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">При загрузке основных блоков это значение будет </font></font><code>_ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">переменной (см. </font></font><a href="#2.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Другие повышения инициализируются с </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нуля</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .





</font></font></p><hr><h3><a name="lua_newstate"><code>lua_newstate</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_State * lua_newstate (lua_Alloc f, void * ud);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Создает новый поток, работающий в новом независимом состоянии. </font><font style="vertical-align: inherit;">Возвращает, </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если не может создать поток или состояние (из-за недостатка памяти). </font><font style="vertical-align: inherit;">Аргумент </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- это функция распределителя; </font><font style="vertical-align: inherit;">Lua делает все выделение памяти для этого состояния через эту функцию (см. </font></font><a href="#lua_Alloc"><code>lua_Alloc</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Второй аргумент </font></font><code>ud</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- это непрозрачный указатель, который Lua передает распределителю при каждом вызове.





</font></font></p><hr><h3><a name="lua_newtable"><code>lua_newtable</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_newtable (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Создает новую пустую таблицу и помещает ее в стек. </font><font style="vertical-align: inherit;">Это эквивалентно </font></font><code>lua_createtable(L, 0, 0)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_newthread"><code>lua_newthread</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_State * lua_newthread (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Создает новый поток, помещает его в стек и возвращает указатель на объект </font></font><a href="#lua_State"><code>lua_State</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, представляющий этот новый поток. </font><font style="vertical-align: inherit;">Новый поток, возвращаемый этой функцией, совместно использует с исходным потоком свою глобальную среду, но имеет независимый стек выполнения.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Не существует явной функции для закрытия или уничтожения потока. </font><font style="vertical-align: inherit;">Потоки подлежат сборке мусора, как и любой объект Lua.





</font></font></p><hr><h3><a name="lua_newuserdata"><code>lua_newuserdata</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void * lua_newuserdata (lua_State * L, size_t size);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция выделяет новый блок памяти с заданным размером, помещает в стек новые полные пользовательские данные с адресом блока и возвращает этот адрес. </font><font style="vertical-align: inherit;">Хост-программа может свободно использовать эту память.





</font></font></p><hr><h3><a name="lua_next"><code>lua_next</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, + (2 | 0), </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_next (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Извлекает ключ из стека и выталкивает пару ключ-значение из таблицы по указанному индексу («следующая» пара после заданного ключа). </font><font style="vertical-align: inherit;">Если в таблице больше нет элементов, </font></font><a href="#lua_next"><code>lua_next</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращается 0 (и ничего не выдвигается).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Типичный обход выглядит так:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     / * таблица находится в стеке с индексом 't' * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     lua_pushnil (L); </font><font style="vertical-align: inherit;">/ * первый ключ * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     while (lua_next (L, t)! = 0) {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       / * использует «ключ» (в индексе -2) и «значение» (в индексе -1) * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       printf ("% s -% s \ n",</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              lua_typename (L, lua_type (L, -2)),</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              lua_typename (L, lua_type (L, -1)));</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       / * удаляет «значение»; </font><font style="vertical-align: inherit;">держит «ключ» для следующей итерации * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       lua_pop (L, 1);</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     }</font></font><font></font>
</pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
При обходе таблицы не вызывайте </font></font><a href="#lua_tolstring"><code>lua_tolstring</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">напрямую ключ, если только вы не знаете, что ключ на самом деле является строкой. </font><font style="vertical-align: inherit;">Напомним, что </font></font><a href="#lua_tolstring"><code>lua_tolstring</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">может изменить значение по данному индексу; </font><font style="vertical-align: inherit;">это смущает следующий вызов </font></font><a href="#lua_next"><code>lua_next</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Смотрите функцию, </font></font><a href="#pdf-next"><code>следующий</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">чтобы </font><font style="vertical-align: inherit;">узнать </font><font style="vertical-align: inherit;">о модификации таблицы во время ее обхода.





</font></font></p><hr><h3><a name="lua_Number"><code>lua_Number</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typedef ... lua_Number;</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Тип плавает в Луа.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
По умолчанию этот тип является двойным, но его можно изменить на одиночное число с плавающей запятой или длинный двойной. </font><font style="vertical-align: inherit;">(См </font></font><code>LUA_FLOAT_TYPE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в </font></font><code>luaconf.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.)





</font></font></p><hr><h3><a name="lua_numbertointeger"><code>lua_numbertointeger</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_numbertointeger (lua_Number n, lua_Integer * p);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразует число с плавающей запятой в Lua в целое число Lua. </font><font style="vertical-align: inherit;">Этот макрос предполагает, что </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">имеет интегральное значение. </font><font style="vertical-align: inherit;">Если это значение находится в диапазоне целых чисел Lua, оно преобразуется в целое число и присваивается </font></font><code>*p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Макрос приводит к логическому значению, указывающему, было ли преобразование успешным. </font><font style="vertical-align: inherit;">(Обратите внимание, что этот тест диапазона может быть сложно сделать правильно без этого макроса из-за округлений.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Этот макрос может оценивать свои аргументы более одного раза.





</font></font></p><hr><h3><a name="lua_pcall"><code>lua_pcall</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- (nargs + 1), + (nresults | 1), -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_pcall (lua_State * L, int nargs, int nresults, int msgh);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вызывает функцию в защищенном режиме.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Оба </font></font><code>nargs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>nresults</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">имеют то же значение, что и в </font></font><a href="#lua_call"><code>lua_call</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если при звонке ошибок нет,
 </font></font><a href="#lua_pcall"><code>lua_pcall</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ведет себя точно так же </font></font><a href="#lua_call"><code>lua_call</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Однако, если есть какая-то ощибка, </font></font><a href="#lua_pcall"><code>lua_pcall</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">она ее </font><font style="vertical-align: inherit;">перехватывает, помещает
 </font><font style="vertical-align: inherit;">в стек одно значение (объект ощибка) и возвращает код ощибка. </font><font style="vertical-align: inherit;">Мол </font></font><a href="#lua_call"><code>lua_call</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a href="#lua_pcall"><code>lua_pcall</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">всегда удаляет функцию и ее аргументы из стека.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>msgh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">равно 0, то объект ощибка, возвращаемый в стеке, является точно исходным объектом ощибка. </font><font style="vertical-align: inherit;">В противном случае </font></font><code>msgh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это индекс стека
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">обработчика сообщений</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">(Этот индекс не может быть псевдоиндексом.) В случае ошибок времени выполнения эта функция будет вызываться с объектом ощибка, а ее возвращаемое значение будет объектом, возвращаемым в стеке </font></font><a href="#lua_pcall"><code>lua_pcall</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Как правило, обработчик сообщений используется для добавления дополнительной информации об отладке к объекту ощибка, такой как трассировка стека. </font><font style="vertical-align: inherit;">Такая информация не может быть собрана после возврата </font></font><a href="#lua_pcall"><code>lua_pcall</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, так как к тому времени стек уже размотан.


</font></font></p><p><font style="vertical-align: inherit;"></font><a href="#lua_pcall"><code>lua_pcall</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Функция возвращает один из следующих констант (определенных в </font></font><code>lua.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">):

</font></font></p><ul>

<li><b><a name="pdf-LUA_OK"><code>LUA_OK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(0):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
успех.</font></font></li>

<li><b><a name="pdf-LUA_ERRRUN"><code>LUA_ERRRUN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
время выполнения ощибка.
</font></font></li>

<li><b><a name="pdf-LUA_ERRMEM"><code>LUA_ERRMEM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
выделение памяти ощибка. </font><font style="vertical-align: inherit;">Для таких ошибок Lua не вызывает обработчик сообщений.
</font></font></li>

<li><b><a name="pdf-LUA_ERRERR"><code>LUA_ERRERR</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ощибка во время работы обработчика сообщений.
</font></font></li>

<li><b><a name="pdf-LUA_ERRGCMM"><code>LUA_ERRGCMM</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ощибка во время бега </font></font><code>__gc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметода. </font><font style="vertical-align: inherit;">Для таких ошибок Lua не вызывает обработчик сообщений (так как этот тип ощибка обычно не имеет отношения к вызываемой функции).
</font></font></li>

</ul>




<hr><h3><a name="lua_pcallk"><code>lua_pcallk</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- (nargs + 1), + (nresults | 1), -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_pcallk (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                Int Nargs,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                int nresults,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                int msgh,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                lua_KContext ctx,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                lua_KFunction k);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция ведет себя точно так же </font></font><a href="#lua_pcall"><code>lua_pcall</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, но позволяет вызываемой функции дать результат (см. </font></font><a href="#4.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><hr><h3><a name="lua_pop"><code>lua_pop</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-n, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_pop (lua_State * L, int n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Извлекает </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">элементы из стека.





</font></font></p><hr><h3><a name="lua_pushboolean"><code>lua_pushboolean</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_pushboolean (lua_State * L, int b);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Помещает логическое значение со значением </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в стек.





</font></font></p><hr><h3><a name="lua_pushcclosure"><code>lua_pushcclosure</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-n, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_pushcclosure (lua_State * L, lua_CFunction fn, int n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Помещает новое закрытие C в стек.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда функция C создается, с ней можно ассоциировать некоторые значения, создавая замыкание C (см. </font></font><a href="#4.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ); </font><font style="vertical-align: inherit;">затем эти значения становятся доступными для функции всякий раз, когда она вызывается. </font><font style="vertical-align: inherit;">Чтобы связать значения с функцией C, сначала эти значения должны быть помещены в стек (при наличии нескольких значений первое значение помещается первым). </font><font style="vertical-align: inherit;">Затем </font></font><a href="#lua_pushcclosure"><code>lua_pushcclosure</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
вызывается для создания и помещения функции C в стек с аргументом, </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">указывающим, сколько значений будет связано с функцией.
</font></font><a href="#lua_pushcclosure"><code>lua_pushcclosure</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">также извлекает эти значения из стека.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Максимальное значение для </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">255.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль, эта функция создает </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">легкую функцию C</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , которая является просто указателем на функцию C. </font><font style="vertical-align: inherit;">В таком случае, это никогда не вызывает в памяти ощибка.





</font></font></p><hr><h3><a name="lua_pushcfunction"><code>lua_pushcfunction</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_pushcfunction (lua_State * L, lua_CFunction f);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Помещает функцию C в стек. </font><font style="vertical-align: inherit;">Эта функция получает указатель на функцию C и помещает в стек значение Lua типа, </font></font><code>function</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">которое при вызове вызывает соответствующую функцию C.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Любая функция, которую должен вызывать Lua, должна следовать правильному протоколу для получения своих параметров и возврата результатов (см. </font></font><a href="#lua_CFunction"><code>lua_CFunction</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).





</font></font></p><hr><h3><a name="lua_pushfstring"><code>lua_pushfstring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * lua_pushfstring (lua_State * L, const char * fmt, ...);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вставляет в стек отформатированную строку и возвращает указатель на эту строку. </font><font style="vertical-align: inherit;">Он похож на функцию ISO C </font></font><code>sprintf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, но имеет некоторые важные отличия:

</font></font></p><ul>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вам не нужно выделять место для результата: результатом является строка Lua, а Lua заботится о распределении памяти (и освобождении, через сборку мусора).
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Спецификаторы преобразования довольно ограничены. </font><font style="vertical-align: inherit;">Там нет флагов, ширины или точности. </font><font style="vertical-align: inherit;">Спецификаторами преобразования могут быть только ' </font></font><code>%%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (вставка символа ' </font></font><code>%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'), ' </font></font><code>%s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (вставка строки с нулевым символом в конце, без ограничений по размеру), ' </font></font><code>%f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (вставка a </font></font><a href="#lua_Number"><code>lua_Number</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), ' </font></font><code>%I</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (вставка a </font></font><a href="#lua_Integer"><code>lua_Integer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), ' </font></font><code>%p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (вставка указатель в виде шестнадцатеричной цифры), ' </font></font><code>%d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (вставка </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), ' </font></font><code>%c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (вставка </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">однобайтового символа) и ' </font></font><code>%U</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (вставка </font></font><code>long int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в виде последовательности байтов UTF-8).
</font></font></li>

</ul>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В отличие от других push-функций, эта функция проверяет пространство стека, в котором она нуждается, включая слот для результата.





</font></font></p><hr><h3><a name="lua_pushglobaltable"><code>lua_pushglobaltable</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_pushglobaltable (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Помещает глобальную среду в стек.





</font></font></p><hr><h3><a name="lua_pushinteger"><code>lua_pushinteger</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_pushinteger (lua_State * L, lua_Integer n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вставляет целое число со значением </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в стек.





</font></font></p><hr><h3><a name="lua_pushlightuserdata"><code>lua_pushlightuserdata</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_pushlightuserdata (lua_State * L, void * p);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Помещает легкие пользовательские данные в стек.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Пользовательские данные представляют значения C в Lua. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Свет UserData</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет собой указатель, </font></font><code>void*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Это значение (например, число): вы не создаете его, у него нет отдельной метатаблицы, и оно не собирается (так как оно никогда не создавалось). </font><font style="vertical-align: inherit;">Легкие пользовательские данные равны «любым» легким пользовательским данным с тем же C-адресом.





</font></font></p><hr><h3><a name="lua_pushliteral"><code>lua_pushliteral</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * lua_pushliteral (lua_State * L, const char * s);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Этот макрос эквивалентен </font></font><a href="#lua_pushstring"><code>lua_pushstring</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, но должен использоваться только тогда, когда </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является литеральной строкой.





</font></font></p><hr><h3><a name="lua_pushlstring"><code>lua_pushlstring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * lua_pushlstring (lua_State * L, const char * s, size_t len);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вставляет строку, на которую указывает </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">размер, </font></font><code>len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
в стек. </font><font style="vertical-align: inherit;">Lua создает (или повторно использует) внутреннюю копию данной строки, поэтому память </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">может быть освобождена или повторно использована сразу после возврата из функции. </font><font style="vertical-align: inherit;">Строка может содержать любые двоичные данные, включая встроенные нули.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает указатель на внутреннюю копию строки.





</font></font></p><hr><h3><a name="lua_pushnil"><code>lua_pushnil</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_pushnil (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Помещает нулевое значение в стек.





</font></font></p><hr><h3><a name="lua_pushnumber"><code>lua_pushnumber</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_pushnumber (lua_State * L, lua_Number n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вставляет поплавок со значением </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в стек.





</font></font></p><hr><h3><a name="lua_pushstring"><code>lua_pushstring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * lua_pushstring (lua_State * L, const char * s);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вставляет строку с нулем в конце, на которую указывает указатель, </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
в стек. </font><font style="vertical-align: inherit;">Lua создает (или повторно использует) внутреннюю копию данной строки, поэтому память </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">может быть освобождена или повторно использована сразу после возврата из функции.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает указатель на внутреннюю копию строки.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, толкает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и возвращает </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_pushthread"><code>lua_pushthread</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_pushthread (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вставляет поток, представленный </font></font><code>L</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в, в стек. </font><font style="vertical-align: inherit;">Возвращает 1, если этот поток является основным потоком своего состояния.





</font></font></p><hr><h3><a name="lua_pushvalue"><code>lua_pushvalue</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_pushvalue (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Помещает копию элемента с указанным индексом в стек.





</font></font></p><hr><h3><a name="lua_pushvfstring"><code>lua_pushvfstring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * lua_pushvfstring (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                              const char * fmt,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                              va_list argp);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эквивалентно </font></font><a href="#lua_pushfstring"><code>lua_pushfstring</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, за исключением того, что он получает </font></font><code>va_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
вместо переменного числа аргументов.





</font></font></p><hr><h3><a name="lua_rawequal"><code>lua_rawequal</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_rawequal (lua_State * L, int index1, int index2);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает 1, если два значения в индексах </font></font><code>index1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и
 </font></font><code>index2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">примитивно равны (то есть без вызова </font></font><code>__eq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметода). </font><font style="vertical-align: inherit;">В противном случае возвращает 0. Также возвращает 0, если какой-либо из индексов недействителен.





</font></font></p><hr><h3><a name="lua_rawget"><code>lua_rawget</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_rawget (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Аналогично </font></font><a href="#lua_gettable"><code>lua_gettable</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, но делает необработанный доступ (т.е. без метаметодов).





</font></font></p><hr><h3><a name="lua_rawgeti"><code>lua_rawgeti</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_rawgeti (lua_State * L, int index, lua_Integer n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Выдвигает в стек значение </font></font><code>t[n]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, где </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">находится таблица по заданному индексу. </font><font style="vertical-align: inherit;">Доступ необработан, то есть он не вызывает </font></font><code>__index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметод.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает тип толкаемого значения.





</font></font></p><hr><h3><a name="lua_rawgetp"><code>lua_rawgetp</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_rawgetp (lua_State * L, int index, const void * p);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Помещает в стек значение </font></font><code>t[k]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, где </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">находится таблица с заданным индексом и
 </font></font><code>k</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">указатель, </font></font><code>p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">представленный в виде легких пользовательских данных. </font><font style="vertical-align: inherit;">Доступ сырой; </font><font style="vertical-align: inherit;">то есть он не вызывает </font></font><code>__index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметод.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает тип толкаемого значения.





</font></font></p><hr><h3><a name="lua_rawlen"><code>lua_rawlen</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">size_t lua_rawlen (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает необработанную «длину» значения по заданному индексу: для строк это длина строки; </font><font style="vertical-align: inherit;">для таблиц это результат оператора длины (' </font></font><code>#</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">') без метаметодов; </font><font style="vertical-align: inherit;">для пользовательских данных - это размер блока памяти, выделенного для пользовательских данных; </font><font style="vertical-align: inherit;">для других значений это 0.





</font></font></p><hr><h3><a name="lua_rawset"><code>lua_rawset</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-2, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_rawset (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Аналогично </font></font><a href="#lua_settable"><code>lua_settable</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, но делает необработанное назначение (т. Е. Без метаметодов).





</font></font></p><hr><h3><a name="lua_rawseti"><code>lua_rawseti</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_rawseti (lua_State * L, int index, lua_Integer i);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Делает эквивалент </font></font><code>t[i] = v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, где </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">находится таблица с заданным индексом и </font></font><code>v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">значение в верхней части стека.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция извлекает значение из стека. </font><font style="vertical-align: inherit;">Назначение является необработанным, то есть не вызывает </font></font><code>__newindex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметод.





</font></font></p><hr><h3><a name="lua_rawsetp"><code>lua_rawsetp</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_rawsetp (lua_State * L, int index, const void * p);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Делает ли эквивалент </font></font><code>t[p] = v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, где </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">таблица по данному индексу,
 </font></font><code>p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">кодируется как легкие пользовательские данные и </font></font><code>v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является значением в верхней части стека.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция извлекает значение из стека. </font><font style="vertical-align: inherit;">Назначение является необработанным, то есть оно не вызывает </font></font><code>__newindex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметод.





</font></font></p><hr><h3><a name="lua_Reader"><code>lua_Reader</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typedef const char * (* lua_Reader) (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                                    void * data,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                                    size_t * size);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Функция чтения используется </font></font><a href="#lua_load"><code>lua_load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Каждый раз, когда ему нужен еще один кусок куска,
 </font></font><a href="#lua_load"><code>lua_load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">вызывает ридер, передавая его </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">параметр. </font><font style="vertical-align: inherit;">Читатель должен вернуть указатель на блок памяти с новым фрагментом фрагмента и установить </font></font><code>size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">размер блока. </font><font style="vertical-align: inherit;">Блок должен существовать, пока функция чтения не будет вызвана снова. </font><font style="vertical-align: inherit;">Чтобы сигнализировать об окончании порции, читатель должен вернуться </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или установить </font></font><code>size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">на ноль. </font><font style="vertical-align: inherit;">Функция чтения может возвращать фрагменты любого размера больше нуля.





</font></font></p><hr><h3><a name="lua_register"><code>lua_register</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_register (lua_State * L, const char * name, lua_CFunction f);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Устанавливает функцию C </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в качестве нового значения global </font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Он определяется как макрос:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     #define lua_register (L, n, f) \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            (lua_pushcfunction (L, f), lua_setglobal (L, n))</font></font><font></font>
</pre>




<hr><h3><a name="lua_remove"><code>lua_remove</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_remove (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Удаляет элемент с заданным допустимым индексом, сдвигая элементы выше этого индекса, чтобы заполнить пробел. </font><font style="vertical-align: inherit;">Эту функцию нельзя вызывать с помощью псевдоиндекса, поскольку псевдоиндекс не является фактической позицией стека.





</font></font></p><hr><h3><a name="lua_replace"><code>lua_replace</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_replace (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Перемещает верхний элемент в заданный допустимый индекс без смещения какого-либо элемента (следовательно, заменяя значение в данном заданном индексе), а затем извлекает верхний элемент.





</font></font></p><hr><h3><a name="lua_resume"><code>lua_resume</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- ?, + ?, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_resume (lua_State * L, lua_State * from, int nargs);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Запускает и возобновляет сопрограммы в данной теме </font></font><code>L</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Чтобы запустить сопрограммы, вы помещаете в стек потока основную функцию плюс любые аргументы; </font><font style="vertical-align: inherit;">тогда вы звоните </font></font><a href="#lua_resume"><code>lua_resume</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, с </font></font><code>nargs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">количеством аргументов. </font><font style="vertical-align: inherit;">Этот вызов возвращается, когда сопрограммы приостанавливает или заканчивает свое выполнение. </font><font style="vertical-align: inherit;">Когда он возвращается, стек содержит все значения, переданные </font></font><a href="#lua_yield"><code>lua_yield</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или все значения, возвращенные функцией body.
</font></font><a href="#lua_resume"><code>lua_resume</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает,
 </font></font><a href="#pdf-LUA_YIELD"><code>LUA_YIELD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если сопрограммы дают,
 </font></font><a href="#pdf-LUA_OK"><code>LUA_OK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если сопрограммы заканчивают свое выполнение без ошибок, или код ощибка в случае ошибок (см. </font></font><a href="#lua_pcall"><code>lua_pcall</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В случае ошибок стек не разматывается, поэтому вы можете использовать API отладка поверх него. </font><font style="vertical-align: inherit;">Объект ощибка находится на вершине стека.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Чтобы возобновить сопрограмму, вы удаляете любые результаты из последней </font></font><a href="#lua_yield"><code>lua_yield</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, кладете в ее стек только те значения, которые должны быть переданы как результаты </font></font><code>yield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, а затем вызываете </font></font><a href="#lua_resume"><code>lua_resume</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Параметр </font></font><code>from</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">представляет сопрограммы, которые возобновляются </font></font><code>L</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если нет такой сопрограммы, этот параметр может быть </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_rotate"><code>lua_rotate</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_rotate (lua_State * L, int idx, int n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вращает элементы стека между действительным индексом </font></font><code>idx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
и вершиной стека. </font><font style="vertical-align: inherit;">Элементы повернуты </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в направлении вверх, для положительного </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, или </font></font><code>-n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в направлении вниз, для отрицательного </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Абсолютное значение </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не должно превышать размер вращаемого среза. </font><font style="vertical-align: inherit;">Эту функцию нельзя вызывать с помощью псевдоиндекса, поскольку псевдоиндекс не является фактической позицией стека.





</font></font></p><hr><h3><a name="lua_setallocf"><code>lua_setallocf</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_setallocf (lua_State * L, lua_Alloc f, void * ud);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Изменяет функцию распределителя данного состояния на </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
пользовательские данные </font></font><code>ud</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_setfield"><code>lua_setfield</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_setfield (lua_State * L, int index, const char * k);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Соответствует ли </font></font><code>t[k] = v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, где </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">значение данного индекса и </font></font><code>v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">значение в верхней части стека.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция извлекает значение из стека. </font><font style="vertical-align: inherit;">Как и в Lua, эта функция может запускать метаметод для события «newindex» (см. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><hr><h3><a name="lua_setglobal"><code>lua_setglobal</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_setglobal (lua_State * L, const char * name);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Извлекает значение из стека и устанавливает его как новое значение global </font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_seti"><code>lua_seti</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_seti (lua_State * L, int index, lua_Integer n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Соответствует ли </font></font><code>t[n] = v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, где </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">значение данного индекса и </font></font><code>v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">значение в верхней части стека.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция извлекает значение из стека. </font><font style="vertical-align: inherit;">Как и в Lua, эта функция может запускать метаметод для события «newindex» (см. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><hr><h3><a name="lua_setmetatable"><code>lua_setmetatable</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_setmetatable (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Извлекает таблицу из стека и устанавливает ее в качестве новой метатаблицы для значения по данному индексу.





</font></font></p><hr><h3><a name="lua_settable"><code>lua_settable</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-2, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_settable (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Соответствует ли </font></font><code>t[k] = v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, где </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">значение данного индекса индексу,
 </font></font><code>v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является значением в верхней части стека и </font></font><code>k</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">значением непосредственно под вершиной.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция извлекает ключ и значение из стека. </font><font style="vertical-align: inherit;">Как и в Lua, эта функция может запускать метаметод для события «newindex» (см. </font></font><a href="#2.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><hr><h3><a name="lua_settop"><code>lua_settop</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- ?, + ?, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_settop (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Принимает любой индекс или 0 и устанавливает вершину стека в этот индекс. </font><font style="vertical-align: inherit;">Если новая вершина больше старой, то новые элементы заполняются </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нулем</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Если </font></font><code>index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0, то все элементы стека удаляются.





</font></font></p><hr><h3><a name="lua_setuservalue"><code>lua_setuservalue</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_setuservalue (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Извлекает значение из стека и устанавливает его как новое значение, связанное с полными данными пользователя по данному индексу.





</font></font></p><hr><h3><a name="lua_State"><code>lua_State</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typedef struct lua_State lua_State;</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Непрозрачная структура, которая указывает на поток и косвенно (через поток) на все состояние интерпретатора Lua. </font><font style="vertical-align: inherit;">Библиотека Lua полностью реентерабельна: в ней нет глобальных переменных. </font><font style="vertical-align: inherit;">Вся информация о состоянии доступна через эту структуру.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Указатель на эту структуру должен быть передан в качестве первого аргумента каждой функции в библиотеке, кроме </font></font><a href="#lua_newstate"><code>lua_newstate</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, которая создает состояние Lua с нуля.





</font></font></p><hr><h3><a name="lua_status"><code>lua_status</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_status (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает состояние потока </font></font><code>L</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Статус может быть 0 ( </font></font><a href="#pdf-LUA_OK"><code>LUA_OK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) для нормального потока, кода ощибка, если поток завершил выполнение </font></font><a href="#lua_resume"><code>lua_resume</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">с ощибкой, или </font></font><a name="pdf-LUA_YIELD"><code>LUA_YIELD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если поток приостановлен.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вы можете вызывать функции только в потоках со статусом </font></font><a href="#pdf-LUA_OK"><code>LUA_OK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Вы можете возобновить темы со статусом </font></font><a href="#pdf-LUA_OK"><code>LUA_OK</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(чтобы начать новую сопрограммы) или </font></font><a href="#pdf-LUA_YIELD"><code>LUA_YIELD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(чтобы возобновить сопрограммы).





</font></font></p><hr><h3><a name="lua_stringtonumber"><code>lua_stringtonumber</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">size_t lua_stringtonumber (lua_State * L, const char * s);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразует строку с нулем в конце </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в число, помещает это число в стек и возвращает общий размер строки, то есть ее длину плюс единицу. </font><font style="vertical-align: inherit;">Преобразование может привести к целому числу или числу с плавающей точкой, согласно лексическим соглашениям Lua (см. </font></font><a href="#3.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Строка может иметь начальные и конечные пробелы и знак. </font><font style="vertical-align: inherit;">Если строка не является допустимым числом, возвращает 0 и ничего не выдвигает. </font><font style="vertical-align: inherit;">(Обратите внимание, что результат может быть использован как логическое значение, true, если преобразование выполнено успешно.)





</font></font></p><hr><h3><a name="lua_toboolean"><code>lua_toboolean</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_toboolean (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразует значение Lua по данному индексу в логическое значение C (0 или 1). </font><font style="vertical-align: inherit;">Как и все тесты в Lua,
 </font></font><a href="#lua_toboolean"><code>lua_toboolean</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает true для любого значения Lua, отличного от </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">в противном случае возвращается false. </font><font style="vertical-align: inherit;">(Если вы хотите принимать только действительные логические значения, используйте </font></font><a href="#lua_isboolean"><code>lua_isboolean</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для проверки тип значения.)





</font></font></p><hr><h3><a name="lua_tocfunction"><code>lua_tocfunction</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_CFunction lua_tocfunction (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразует значение по указанному индексу в функцию C. </font><font style="vertical-align: inherit;">Это значение должно быть функцией C; </font><font style="vertical-align: inherit;">в противном случае возвращается </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_tointeger"><code>lua_tointeger</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_Integer lua_tointeger (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эквивалентно </font></font><a href="#lua_tointegerx"><code>lua_tointegerx</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">с </font></font><code>isnum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">равным </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_tointegerx"><code>lua_tointegerx</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_Integer lua_tointegerx (lua_State * L, int index, int * isnum);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразует значение Lua по данному индексу в подписанный интеграл тип </font></font><a href="#lua_Integer"><code>lua_Integer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Значение Lua должно быть целым числом или числом или строкой, преобразуемой в целое число (см. </font></font><a href="#3.4.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ); </font><font style="vertical-align: inherit;">в противном случае </font></font><code>lua_tointegerx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает 0.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>isnum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нет </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, его референту присваивается логическое значение, которое указывает, была ли операция выполнена успешно.





</font></font></p><hr><h3><a name="lua_tolstring"><code>lua_tolstring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * lua_tolstring (lua_State * L, int index, size_t * len);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразует значение Lua по заданному индексу в строку C. </font><font style="vertical-align: inherit;">Если </font></font><code>len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нет </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, то устанавливается </font></font><code>*len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">с длиной строки. </font><font style="vertical-align: inherit;">Значение Lua должно быть строкой или числом; </font><font style="vertical-align: inherit;">в противном случае функция возвращает </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если значение является числом, то </font></font><code>lua_tolstring</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">также
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">изменяет фактическое значение в стеке на строку</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">(Это изменение сбивает с толку, </font></font><a href="#lua_next"><code>lua_next</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
когда </font></font><code>lua_tolstring</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">применяется к ключам во время обхода таблицы.)


</font></font></p><p>
<code>lua_tolstring</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает указатель на строку внутри состояния Lua. </font><font style="vertical-align: inherit;">Эта строка всегда имеет ноль (' </font></font><code>\0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">') после своего последнего символа (как в C), но может содержать другие нули в своем теле.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Поскольку Lua имеет сборку мусора, нет гарантии, что возвращаемый указатель </font></font><code>lua_tolstring</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
будет действительным после удаления соответствующего значения Lua из стека.





</font></font></p><hr><h3><a name="lua_tonumber"><code>lua_tonumber</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_Number lua_tonumber (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эквивалентно </font></font><a href="#lua_tonumberx"><code>lua_tonumberx</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">с </font></font><code>isnum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">равным </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_tonumberx"><code>lua_tonumberx</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_Number lua_tonumberx (lua_State * L, int index, int * isnum);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразует значение Lua по данному индексу в тип C </font></font><a href="#lua_Number"><code>lua_Number</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(см. </font></font><a href="#lua_Number"><code>lua_Number</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Значение Lua должно быть числом или строкой, конвертируемой в число (см. </font></font><a href="#3.4.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ); </font><font style="vertical-align: inherit;">в противном случае </font></font><a href="#lua_tonumberx"><code>lua_tonumberx</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает 0.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>isnum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нет </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, его референту присваивается логическое значение, которое указывает, была ли операция выполнена успешно.





</font></font></p><hr><h3><a name="lua_topointer"><code>lua_topointer</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const void * lua_topointer (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразует значение по указанному индексу в общий указатель C ( </font></font><code>void*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Значение может быть пользовательскими данными, таблицей, потоком или функцией; </font><font style="vertical-align: inherit;">в противном случае </font></font><code>lua_topointer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращается </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Разные объекты будут давать разные указатели. </font><font style="vertical-align: inherit;">Невозможно преобразовать указатель обратно в исходное значение.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Обычно эта функция используется только для хеширования и отладки информации.





</font></font></p><hr><h3><a name="lua_tostring"><code>lua_tostring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * lua_tostring (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эквивалентно </font></font><a href="#lua_tolstring"><code>lua_tolstring</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">с </font></font><code>len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">равным </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_tothread"><code>lua_tothread</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_State * lua_tothread (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразует значение по указанному индексу в поток Lua (представлен как </font></font><code>lua_State*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Это значение должно быть потоком; </font><font style="vertical-align: inherit;">в противном случае функция возвращает </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_touserdata"><code>lua_touserdata</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void * lua_touserdata (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если значение по данному индексу является полными данными пользователя, возвращает адрес его блока. </font><font style="vertical-align: inherit;">Если значение является легким userdata, возвращает его указатель. </font><font style="vertical-align: inherit;">В противном случае возвращается </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_type"><code>lua_type</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_type (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает тип значения в указанном допустимом индексе или </font></font><code>LUA_TNONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для недопустимого (но приемлемого) индекса. </font><font style="vertical-align: inherit;">Типы возвращаемых </font></font><a href="#lua_type"><code>lua_type</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">кодируются с </font><font style="vertical-align: inherit;">помощью следующих констант , </font><font style="vertical-align: inherit;">определенных в </font></font><code>lua.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:
 </font></font><a name="pdf-LUA_TNIL"><code>LUA_TNIL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(0),
 </font></font><a name="pdf-LUA_TNUMBER"><code>LUA_TNUMBER</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a name="pdf-LUA_TBOOLEAN"><code>LUA_TBOOLEAN</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a name="pdf-LUA_TSTRING"><code>LUA_TSTRING</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a name="pdf-LUA_TTABLE"><code>LUA_TTABLE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a name="pdf-LUA_TFUNCTION"><code>LUA_TFUNCTION</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a name="pdf-LUA_TUSERDATA"><code>LUA_TUSERDATA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a name="pdf-LUA_TTHREAD"><code>LUA_TTHREAD</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, и
 </font></font><a name="pdf-LUA_TLIGHTUSERDATA"><code>LUA_TLIGHTUSERDATA</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_typename"><code>lua_typename</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * lua_typename (lua_State * L, int tp);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает имя типа, закодированного значением </font></font><code>tp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, которое должно быть одним из значений, возвращаемых </font></font><a href="#lua_type"><code>lua_type</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_Unsigned"><code>lua_Unsigned</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typedef ... lua_Unsigned;</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Неподписанная версия </font></font><a href="#lua_Integer"><code>lua_Integer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_upvalueindex"><code>lua_upvalueindex</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_upvalueindex (int i);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает псевдоиндекс, который представляет </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-е повышение значения запущенной функции (см. </font></font><a href="#4.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).





</font></font></p><hr><h3><a name="lua_version"><code>lua_version</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const lua_Number * lua_version (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает адрес номера версии (статическая переменная C), хранящийся в ядре Lua. </font><font style="vertical-align: inherit;">При вызове с допустимым </font></font><a href="#lua_State"><code>lua_State</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает адрес версии, использованной для создания этого состояния. </font><font style="vertical-align: inherit;">При вызове с </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает адрес версии, выполняющей вызов.





</font></font></p><hr><h3><a name="lua_Writer"><code>lua_Writer</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typedef int (* lua_Writer) (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                           const void * p,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                           size_t sz,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                           void * ud);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Тип функции писателя, используемый </font></font><a href="#lua_dump"><code>lua_dump</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Каждый раз, когда он генерирует другой кусок чанка,
 </font></font><a href="#lua_dump"><code>lua_dump</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">вызывает писатель, передавая буфер для записи ( </font></font><code>p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), его размер ( </font></font><code>sz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) и </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">параметр, предоставленный </font></font><a href="#lua_dump"><code>lua_dump</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Автор возвращает код ощибка: 0 означает отсутствие ошибок; </font><font style="vertical-align: inherit;">любое другое значение означает «ощибка» и перестает </font></font><a href="#lua_dump"><code>lua_dump</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">звонить писателю снова.





</font></font></p><hr><h3><a name="lua_xmove"><code>lua_xmove</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- ?, + ?, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_xmove (lua_State * from, lua_State * to, int n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Обмен значениями между разными потоками одного и того же состояния.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция извлекает </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">значения из стека </font></font><code>from</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и помещает их в стек </font></font><code>to</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_yield"><code>lua_yield</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- ?, + ?, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_yield (lua_State * L, int nresults);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция эквивалентна </font></font><a href="#lua_yieldk"><code>lua_yieldk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, но не имеет продолжения (см. </font></font><a href="#4.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Поэтому, когда поток возобновляет работу, он продолжает функцию, вызвавшую вызов функции </font></font><code>lua_yield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_yieldk"><code>lua_yieldk</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- ?, + ?, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_yieldk (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                int nresults,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                lua_KContext ctx,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                lua_KFunction k);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Выходит сопрограммы (нить).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда вызывается функция C </font></font><a href="#lua_yieldk"><code>lua_yieldk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, запущенная сопрограмма приостанавливает свое выполнение, и вызов </font></font><a href="#lua_resume"><code>lua_resume</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">этой запущенной этой сопрограммы возвращается. </font><font style="vertical-align: inherit;">Параметр </font></font><code>nresults</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- это число значений из стека, которые будут переданы в качестве результатов </font></font><a href="#lua_resume"><code>lua_resume</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда сопрограммы возобновляются снова, Lua вызывает данную функцию продолжения, </font></font><code>k</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">чтобы продолжить выполнение полученной функции C (см. </font></font><a href="#4.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Эта функция продолжения получает тот же стек от предыдущей функции, </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">результаты удаляются и заменяются аргументами, переданными </font></font><a href="#lua_resume"><code>lua_resume</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Кроме того, функция продолжения получает значение, </font></font><code>ctx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
которое было передано </font></font><a href="#lua_yieldk"><code>lua_yieldk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Обычно эта функция не возвращает; </font><font style="vertical-align: inherit;">когда сопрограммы в конечном итоге возобновляются, она продолжает выполнять функцию продолжения. </font><font style="vertical-align: inherit;">Тем не менее, есть один особый случай, когда эта функция вызывается изнутри строки или подсчета (см. </font></font><a href="#4.9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.9</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">В этом случае </font></font><code>lua_yieldk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должен быть вызван без продолжения (вероятно, в виде </font></font><a href="#lua_yield"><code>lua_yield</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) и без результатов, и ловушка должна вернуться сразу после вызова. </font><font style="vertical-align: inherit;">Lua уступит и, когда сопрограммы возобновятся, продолжит нормальное выполнение функции (Lua), которая запустила ловушку.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция может вызвать ощибку, если она вызывается из потока с ожидающим вызовом C без функции продолжения, или она вызывается из потока, который не выполняется внутри резюме (например, основного потока).







</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.9 - </font></font><a name="4.9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Интерфейс отладки</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
У Lua нет встроенных средств отладки. </font><font style="vertical-align: inherit;">Вместо этого он предлагает специальный интерфейс с помощью функций и </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">хуков</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Этот интерфейс позволяет создавать различные виды отладчиков, профилировщиков и других инструментов, которым требуется «внутренняя информация» от интерпретатора.



</font></font></p><hr><h3><a name="lua_Debug"><code>lua_Debug</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typedef struct lua_Debug {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  Int событие;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  const char * name; </font><font style="vertical-align: inherit;">/ * (n) * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  const char * name what; </font><font style="vertical-align: inherit;">/ * (n) * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  const char * что; </font><font style="vertical-align: inherit;">/ * (S) * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  const char * source; </font><font style="vertical-align: inherit;">/ * (S) * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  int currentline; </font><font style="vertical-align: inherit;">/ * (л) * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  int linedefined; </font><font style="vertical-align: inherit;">/ * (S) * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  int lastlinedefined; </font><font style="vertical-align: inherit;">/ * (S) * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  беззнаковые символы; </font><font style="vertical-align: inherit;">/ * (u) количество повышений * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  без знака char nparams; </font><font style="vertical-align: inherit;">/ * (u) количество параметров * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  чар ишвараг; </font><font style="vertical-align: inherit;">/ * (и) * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  char istailcall; </font><font style="vertical-align: inherit;">/ * (т) * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  char short_src [LUA_IDSIZE]; </font><font style="vertical-align: inherit;">/ * (S) * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  / * приватная часть * /</font></font><font></font>
  <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">другие поля</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
} lua_Debug;</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Структура, используемая для передачи различной информации о функции или записи активации.
</font></font><a href="#lua_getstack"><code>lua_getstack</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">заполняет только частную часть этой структуры для последующего использования. </font><font style="vertical-align: inherit;">Чтобы заполнить другие поля </font></font><a href="#lua_Debug"><code>lua_Debug</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">полезной информацией, звоните </font></font><a href="#lua_getinfo"><code>lua_getinfo</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Поля </font></font><a href="#lua_Debug"><code>lua_Debug</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">имеют следующие значения:

</font></font></p><ul>

<li><b><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
имя чанка, который создал функцию. </font><font style="vertical-align: inherit;">Если </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">начинается с « </font></font><code>@</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">», это означает, что функция была определена в файле, где имя файла следует за « </font></font><code>@</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">». </font><font style="vertical-align: inherit;">Если </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">начинается с ' </font></font><code>=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">', остальная часть его содержимого описывает источник в зависимости от пользователя. </font><font style="vertical-align: inherit;">В противном случае функция была определена в строке, где
 </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">находится эта строка.
</font></font></li>

<li><b><code>short_src</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
версия для печати </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, которая будет использоваться в сообщениях ощибка.
</font></font></li>

<li><b><code>linedefined</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
номер строки, с которой начинается определение функции.
</font></font></li>

<li><b><code>lastlinedefined</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
номер строки, где заканчивается определение функции.
</font></font></li>

<li><b><code>what</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
строка, </font></font><code>"Lua"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если функция является функцией Lua,
 </font></font><code>"C"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если это функция C,
 </font></font><code>"main"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если она является основной частью фрагмента.
</font></font></li>

<li><b><code>currentline</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
текущая строка, в которой выполняется данная функция. </font><font style="vertical-align: inherit;">Если информация о линии недоступна,
 </font></font><code>currentline</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">устанавливается значение -1.
</font></font></li>

<li><b><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
разумное имя для данной функции. </font><font style="vertical-align: inherit;">Поскольку функции в Lua являются первоклассными значениями, они не имеют фиксированного имени: некоторые функции могут быть значением нескольких глобальных переменных, в то время как другие могут храниться только в поле таблицы. </font></font><code>lua_getinfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Функция проверяет , </font><font style="vertical-align: inherit;">как функция была вызвана , </font><font style="vertical-align: inherit;">чтобы найти подходящее имя. </font><font style="vertical-align: inherit;">Если не удается найти имя, </font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">устанавливается значение </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.
</font></font></li>

<li><b><code>namewhat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
объясняет </font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">поле. </font><font style="vertical-align: inherit;">Значение </font></font><code>namewhat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">может быть
 </font></font><code>"global"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>"local"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>"method"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><code>"field"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>"upvalue"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, или </font></font><code>""</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(пустая строка), в </font><font style="vertical-align: inherit;">соответствии с тем, </font><font style="vertical-align: inherit;">как была вызвана функция. </font><font style="vertical-align: inherit;">(Lua использует пустую строку, когда никакая другая опция не применима.)
</font></font></li>

<li><b><code>istailcall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
true, если этот вызов функции был вызван хвостовым вызовом. </font><font style="vertical-align: inherit;">В этом случае вызывающая сторона этого уровня не находится в стеке.
</font></font></li>

<li><b><code>nups</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
количество значений функции.
</font></font></li>

<li><b><code>nparams</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
количество фиксированных параметров функции (всегда 0 для функций C).
</font></font></li>

<li><b><code>isvararg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
true, если функция является функцией vararg (всегда верно для функций C).
</font></font></li>

</ul>




<hr><h3><a name="lua_gethook"><code>lua_gethook</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_Hook lua_gethook (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает текущую функцию ловушки.





</font></font></p><hr><h3><a name="lua_gethookcount"><code>lua_gethookcount</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_gethookcount (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает текущий счетчик хуков.





</font></font></p><hr><h3><a name="lua_gethookmask"><code>lua_gethookmask</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_gethookmask (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает текущую маску крючка.





</font></font></p><hr><h3><a name="lua_getinfo"><code>lua_getinfo</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- (0 | 1), + (0 | 1 | 2), </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_getinfo (lua_State * L, const char * what, lua_Debug * ar);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Получает информацию о конкретной функции или вызове функции.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Чтобы получить информацию о вызове функции, параметр </font></font><code>ar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должен быть действительной записью активации, которая была заполнена предыдущим вызовом </font></font><a href="#lua_getstack"><code>lua_getstack</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или передана в качестве аргумента ловушке (см. </font></font><a href="#lua_Hook"><code>lua_Hook</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Чтобы получить информацию о функции, вы помещаете ее в стек и начинаете </font></font><code>what</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">строку с символа ' </font></font><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'. </font><font style="vertical-align: inherit;">(В этом случае
 </font></font><code>lua_getinfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">извлекает функцию из верхней части стека.) Например, чтобы узнать, в какой строке </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">была определена </font><font style="vertical-align: inherit;">функция </font><font style="vertical-align: inherit;">, вы можете написать следующий код:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     lua_Debug ar;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     lua_getglobal (L, "f"); </font><font style="vertical-align: inherit;">/ * получить глобальный 'F' * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     lua_getinfo (L, "&gt; S", &amp; ar);</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     printf ("% d \ n", ar.linedefined);</font></font><font></font>
</pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Каждый символ в строке </font></font><code>what</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
выбирает некоторые поля структуры, которую </font></font><code>ar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нужно заполнить, или значение, которое нужно поместить в стек:

</font></font></p><ul>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">':</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> заполняет поле </font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>namewhat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' </font></font><code>S</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Заполняет поля </font></font><code>source</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>short_src</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><code>linedefined</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>lastlinedefined</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, и </font></font><code>what</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' </font></font><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">':</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> заполняет поле </font></font><code>currentline</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">':</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> заполняет поле </font></font><code>istailcall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' </font></font><code>u</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Заполняет поля
 </font></font><code>nups</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>nparams</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>isvararg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">':</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
помещает в стек функцию, которая работает на данном уровне;
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' </font></font><code>L</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">':</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
помещает в стек таблицу, индексы которой представляют собой номера строк, допустимых для функции. </font><font style="vertical-align: inherit;">( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Допустимая строка</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - это строка с некоторым связанным кодом, то есть строка, в которую можно поставить точку останова. Недопустимые строки содержат пустые строки и комментарии.)


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если эта опция указана вместе с опцией ' </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">', ее таблица помещается после функции.
</font></font></p></li>

</ul>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция возвращает 0 на ощибка (например, неверная опция в </font></font><code>what</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).





</font></font></p><hr><h3><a name="lua_getlocal"><code>lua_getlocal</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, + (0 | 1), -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * lua_getlocal (lua_State * L, const lua_Debug * ar, int n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Получает информацию о локальной переменной заданной записи активации или заданной функции.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В первом случае параметр </font></font><code>ar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должен быть действительной записью активации, которая была заполнена предыдущим вызовом </font></font><a href="#lua_getstack"><code>lua_getstack</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или передана в качестве аргумента ловушке (см. </font></font><a href="#lua_Hook"><code>lua_Hook</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Индекс </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">выбирает, какую локальную переменную проверять; </font><font style="vertical-align: inherit;">см. </font></font><a href="#pdf-debug.getlocal"><code>отладка.дайлокал</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">подробности об индексах и именах переменных.


</font></font></p><p>
<a href="#lua_getlocal"><code>lua_getlocal</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> помещает значение переменной в стек и возвращает ее имя.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Во втором случае </font></font><code>ar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должна быть </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и проверяемая функция должна быть наверху стека. </font><font style="vertical-align: inherit;">В этом случае видны только параметры функций Lua (так как нет никакой информации о том, какие переменные активны) и никакие значения не помещаются в стек.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(и ничего не выдвигает), когда индекс превышает количество активных локальных переменных.





</font></font></p><hr><h3><a name="lua_getstack"><code>lua_getstack</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int lua_getstack (lua_State * L, int level, lua_Debug * ar);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Получает информацию о стеке выполнения интерпретатора.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция заполняет части </font></font><a href="#lua_Debug"><code>lua_Debug</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">структуры идентификатором </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">записи активации</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
функции, выполняемой на данном уровне. </font><font style="vertical-align: inherit;">Уровень 0 - это текущая выполняемая функция, тогда как уровень </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n + 1</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - это функция, которая вызвала уровень </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
(кроме хвостовых вызовов, которые не учитываются в стеке). </font><font style="vertical-align: inherit;">Если ошибок нет, </font></font><a href="#lua_getstack"><code>lua_getstack</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает 1; </font><font style="vertical-align: inherit;">при вызове с уровнем, превышающим глубину стека, он возвращает 0.





</font></font></p><hr><h3><a name="lua_getupvalue"><code>lua_getupvalue</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, + (0 | 1), -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * lua_getupvalue (lua_State * L, int funcindex, int n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Получает информацию о </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ом повышении значения закрытия по индексу </font></font><code>funcindex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Он помещает значение upvalue в стек и возвращает его имя. </font><font style="vertical-align: inherit;">Возвращает </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(и ничего не выдвигает), когда индекс </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">больше, чем число повышений.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Для функций C эта функция использует пустую строку </font></font><code>""</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
в качестве имени для всех значений upvalue. </font><font style="vertical-align: inherit;">(Для функций Lua, upvalues ​​- это внешние локальные переменные, которые использует функция, и которые, следовательно, включены в ее закрытие.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Повышающие значения не имеют определенного порядка, так как они активны через всю функцию. </font><font style="vertical-align: inherit;">Они пронумерованы в произвольном порядке.





</font></font></p><hr><h3><a name="lua_Hook"><code>lua_Hook</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typedef void (* lua_Hook) (lua_State * L, lua_Debug * ar);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Тип для отладки хуков.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Всякий раз, когда вызывается ловушка, ее </font></font><code>ar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">аргумент имеет свое поле,
 </font></font><code>event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">установленное на конкретное событие, которое вызвало ловушку. </font><font style="vertical-align: inherit;">Lua идентифицирует эти события со следующими константами:
 </font></font><a name="pdf-LUA_HOOKCALL"><code>LUA_HOOKCALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a name="pdf-LUA_HOOKRET"><code>LUA_HOOKRET</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a name="pdf-LUA_HOOKTAILCALL"><code>LUA_HOOKTAILCALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a name="pdf-LUA_HOOKLINE"><code>LUA_HOOKLINE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><a name="pdf-LUA_HOOKCOUNT"><code>LUA_HOOKCOUNT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Кроме того, для линейных событий поле </font></font><code>currentline</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">также установлено. </font><font style="vertical-align: inherit;">Чтобы получить значение любого другого поля </font></font><code>ar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, хук должен вызвать </font></font><a href="#lua_getinfo"><code>lua_getinfo</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Для событий вызова </font></font><code>event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">может быть </font></font><code>LUA_HOOKCALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нормальное значение или </font></font><code>LUA_HOOKTAILCALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для хвостового вызова; </font><font style="vertical-align: inherit;">в этом случае не будет соответствующего события возврата.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Пока Lua запускает ловушку, он отключает другие вызовы ловушек. </font><font style="vertical-align: inherit;">Следовательно, если ловушка вызывает Lua для выполнения функции или блока, это выполнение происходит без каких-либо вызовов ловушек.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Функции Крюк не может иметь продолжений, то есть, они не могут назвать </font></font><a href="#lua_yieldk"><code>lua_yieldk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a href="#lua_pcallk"><code>lua_pcallk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или </font></font><a href="#lua_callk"><code>lua_callk</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">с ненулевым </font></font><code>k</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Хук-функции могут выдавать при следующих условиях: только подсчет и линейные события могут дать; </font><font style="vertical-align: inherit;">чтобы получить, хук-функция должна завершить выполнение вызова </font></font><a href="#lua_yield"><code>lua_yield</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">с </font></font><code>nresults</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нулем (то есть без значений).





</font></font></p><hr><h3><a name="lua_sethook"><code>lua_sethook</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_sethook (lua_State * L, lua_Hook f, int mask, int count);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Устанавливает функцию отладочного хука.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Аргумент </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- это функция hook.
</font></font><code>mask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">указывает на какие события крючок будет называться: она формируется побитового OR констант
 </font></font><a name="pdf-LUA_MASKCALL"><code>LUA_MASKCALL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a name="pdf-LUA_MASKRET"><code>LUA_MASKRET</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a name="pdf-LUA_MASKLINE"><code>LUA_MASKLINE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><a name="pdf-LUA_MASKCOUNT"><code>LUA_MASKCOUNT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Аргумент имеет смысл только , </font><font style="vertical-align: inherit;">когда маска включает в </font><font style="vertical-align: inherit;">себя </font></font><code>LUA_MASKCOUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Для каждого события ловушка вызывается, как описано ниже:

</font></font></p><ul>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Хук вызова:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> вызывается, когда интерпретатор вызывает функцию. </font><font style="vertical-align: inherit;">Хук вызывается сразу после того, как Lua входит в новую функцию, прежде чем функция получит свои аргументы.
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Хук возврата:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> вызывается, когда интерпретатор возвращается из функции. </font><font style="vertical-align: inherit;">Хук вызывается как раз перед тем, как Lua покидает функцию. </font><font style="vertical-align: inherit;">Не существует стандартного способа доступа к значениям, возвращаемым функцией.
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Перехват строки:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> вызывается, когда интерпретатор собирается начать выполнение новой строки кода или когда он возвращается в код (даже к той же строке). </font><font style="vertical-align: inherit;">(Это событие происходит только тогда, когда Lua выполняет функцию Lua.)
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Счетчик ловушек:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> вызывается после того, как интерпретатор выполняет все
 </font></font><code>count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">инструкции. </font><font style="vertical-align: inherit;">(Это событие происходит только тогда, когда Lua выполняет функцию Lua.)
</font></font></li>

</ul>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Крюк отключен путем установки </font></font><code>mask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">на ноль.





</font></font></p><hr><h3><a name="lua_setlocal"><code>lua_setlocal</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- (0 | 1), +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * lua_setlocal (lua_State * L, const lua_Debug * ar, int n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Устанавливает значение локальной переменной данной записи активации. </font><font style="vertical-align: inherit;">Он присваивает значение в верхней части стека переменной и возвращает ее имя. </font><font style="vertical-align: inherit;">Он также извлекает значение из стека.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(и ничего не выдает), когда индекс превышает количество активных локальных переменных.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Параметры </font></font><code>ar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть как в функции </font></font><a href="#lua_getlocal"><code>lua_getlocal</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_setupvalue"><code>lua_setupvalue</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- (0 | 1), +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * lua_setupvalue (lua_State * L, int funcindex, int n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Устанавливает значение повышения значения замыкания. </font><font style="vertical-align: inherit;">Он присваивает значение в верхней части стека верхнему значению и возвращает его имя. </font><font style="vertical-align: inherit;">Он также извлекает значение из стека.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(и ничего не </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">выводит </font><font style="vertical-align: inherit;">), когда индекс </font><font style="vertical-align: inherit;">больше, чем число повышений.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Параметры </font></font><code>funcindex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть как в функции </font></font><a href="#lua_getupvalue"><code>lua_getupvalue</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="lua_upvalueid"><code>lua_upvalueid</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void * lua_upvalueid (lua_State * L, int funcindex, int n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает уникальный идентификатор для повышающего значения, пронумерованного </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
из замыкания по индексу </font></font><code>funcindex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эти уникальные идентификаторы позволяют программе проверять, имеют ли разные замыкания общие значения. </font><font style="vertical-align: inherit;">Закрытия Lua с общим значением повышения (то есть с доступом к одной и той же внешней локальной переменной) будут возвращать идентичные идентификаторы для этих индексов повышения.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Параметры </font></font><code>funcindex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">такие , </font><font style="vertical-align: inherit;">как в функции </font></font><a href="#lua_getupvalue"><code>lua_getupvalue</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, но </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не может быть больше , </font><font style="vertical-align: inherit;">чем количество upvalues.





</font></font></p><hr><h3><a name="lua_upvaluejoin"><code>lua_upvaluejoin</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void lua_upvaluejoin (lua_State * L, int funcindex1, int n1,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                                    int funcindex2, int n2);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Сделайте, чтобы </font></font><code>n1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-th upvalue закрытия Lua по индексу </font></font><code>funcindex1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ссылался на </font></font><code>n2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-th upvalue закрытия Lua по индексу </font></font><code>funcindex2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.







</font></font></p><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 - </font></font><a name="5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Вспомогательная библиотека</font></font></a></h1>

<p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Вспомогательная библиотека</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> предоставляет несколько удобных функций для взаимодействия C с Lua. </font><font style="vertical-align: inherit;">В то время как базовый API предоставляет примитивные функции для всех взаимодействий между C и Lua, вспомогательная библиотека предоставляет функции более высокого уровня для некоторых общих задач.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Все функции и типы из вспомогательной библиотеки определены в заголовочном файле </font></font><code>lauxlib.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и имеют префикс </font></font><code>luaL_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Все функции во вспомогательной библиотеке построены поверх базового API, и поэтому они не предоставляют ничего, что нельзя сделать с этим API. </font><font style="vertical-align: inherit;">Тем не менее, использование вспомогательной библиотеки обеспечивает большую согласованность вашего кода.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Несколько функций во вспомогательной библиотеке внутренне используют несколько дополнительных слотов стека. </font><font style="vertical-align: inherit;">Когда функция во вспомогательной библиотеке использует менее пяти слотов, она не проверяет размер стека; </font><font style="vertical-align: inherit;">это просто предполагает, что слотов достаточно.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Несколько функций из вспомогательной библиотеки используются для проверки аргументов функции C. </font><font style="vertical-align: inherit;">Поскольку сообщение ощибка отформатировано для аргументов (например, " </font></font><code>bad argument #1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"), вы не должны использовать эти функции для других значений стека.


</font></font></p><p><font style="vertical-align: inherit;"></font><code>luaL_check*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вызываемые </font><font style="vertical-align: inherit;">
функции </font><font style="vertical-align: inherit;">всегда поднимают ощибку, если проверка не выполняется.



</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1 - </font></font><a name="5.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Функции и типы</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Здесь мы перечисляем все функции и типы из вспомогательной библиотеки в алфавитном порядке.



</font></font></p><hr><h3><a name="luaL_addchar"><code>luaL_addchar</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- ?, + ?, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_addchar (luaL_Buffer * B, char c);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Добавляет байт </font></font><code>c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в буфер </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(см. </font></font><a href="#luaL_Buffer"><code>luaL_Buffer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).





</font></font></p><hr><h3><a name="luaL_addlstring"><code>luaL_addlstring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- ?, + ?, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_addlstring (luaL_Buffer * B, const char * s, size_t l);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Добавляет строку, на которую указывает </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">длина, </font></font><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в буфер </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(см. </font></font><a href="#luaL_Buffer"><code>luaL_Buffer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Строка может содержать встроенные нули.





</font></font></p><hr><h3><a name="luaL_addsize"><code>luaL_addsize</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- ?, + ?, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_addsize (luaL_Buffer * B, size_t n);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Добавляет в буфер </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(см. </font></font><a href="#luaL_Buffer"><code>luaL_Buffer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Строку длины, </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ранее скопированную в область буфера (см. </font></font><a href="#luaL_prepbuffer"><code>luaL_prepbuffer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).





</font></font></p><hr><h3><a name="luaL_addstring"><code>luaL_addstring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- ?, + ?, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_addstring (luaL_Buffer * B, const char * s);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Добавляет строку с нулем в конце, на которую указывает указатель, </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
в буфер </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(см. </font></font><a href="#luaL_Buffer"><code>luaL_Buffer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).





</font></font></p><hr><h3><a name="luaL_addvalue"><code>luaL_addvalue</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, + ?, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_addvalue (luaL_Buffer * B);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Добавляет значение в верхней части стека в буфер </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(см. </font></font><a href="#luaL_Buffer"><code>luaL_Buffer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Выскакивает значение.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Это единственная функция в строковых буферах, которую можно (и нужно) вызывать с дополнительным элементом в стеке, который является значением, добавляемым в буфер.





</font></font></p><hr><h3><a name="luaL_argcheck"><code>luaL_argcheck</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_argcheck (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    Int Cond,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    Int Arg,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    const char * extramsg);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Проверяет, </font></font><code>cond</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">правда </font><font style="vertical-align: inherit;">ли </font><font style="vertical-align: inherit;">это. </font><font style="vertical-align: inherit;">Если это не так, возникает ощибка со стандартным сообщением (см. </font></font><a href="#luaL_argerror"><code>luaL_argerror</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).





</font></font></p><hr><h3><a name="luaL_argerror"><code>luaL_argerror</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_argerror (lua_State * L, int arg, const char * extramsg);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вызывает ощибку, сообщающую о проблеме с аргументом вызывающей ее </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
функции C, используя стандартное сообщение, включающее </font></font><code>extramsg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в качестве комментария:

</font></font></p><pre><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;">неверный</font></em><font style="vertical-align: inherit;">      аргумент # </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arg</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> для ' </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funcname</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extramsg</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция никогда не возвращается.





</font></font></p><hr><h3><a name="luaL_Buffer"><code>luaL_Buffer</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typedef struct luaL_Buffer luaL_Buffer;</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Тип для </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">буфера строки</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Строковый буфер позволяет коду C создавать строки Lua по частям. </font><font style="vertical-align: inherit;">Его схема использования выглядит следующим образом:

</font></font></p><ul>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Сначала объявите переменную </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">типа </font></font><a href="#luaL_Buffer"><code>luaL_Buffer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Затем инициализируйте его с помощью вызова </font></font><code>luaL_buffinit(L, &amp;b)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Затем добавьте фрагменты строки в буфер, вызывающий любую из </font></font><code>luaL_add*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функций.
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Завершите, позвонив </font></font><code>luaL_pushresult(&amp;b)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Этот вызов оставляет последнюю строку в верхней части стека.
</font></font></li>

</ul>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если вы заранее знаете общий размер полученной строки, вы можете использовать буфер следующим образом:

</font></font></p><ul>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Сначала объявите переменную </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">типа </font></font><a href="#luaL_Buffer"><code>luaL_Buffer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Затем инициализируйте его и предварительно выделите пространство размера </font></font><code>sz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">с помощью вызова </font></font><code>luaL_buffinitsize(L, &amp;b, sz)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Затем скопируйте строку в это пространство.</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Завершите, вызвав </font></font><code>luaL_pushresultsize(&amp;b, sz)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, где </font></font><code>sz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">общий размер результирующей строки, скопированной в это пространство.
</font></font></li>

</ul>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Во время своей нормальной работы строковый буфер использует переменное количество слотов стека. </font><font style="vertical-align: inherit;">Таким образом, используя буфер, вы не можете предполагать, что знаете, где находится вершина стека. </font><font style="vertical-align: inherit;">Вы можете использовать стек между последовательными вызовами операций буфера, пока это использование сбалансировано; </font><font style="vertical-align: inherit;">то есть, когда вы вызываете операцию с буфером, стек находится на том же уровне, на котором был сразу после предыдущей операции с буфером. </font><font style="vertical-align: inherit;">(Единственное исключение из этого правила </font></font><a href="#luaL_addvalue"><code>luaL_addvalue</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.) После вызова </font></font><a href="#luaL_pushresult"><code>luaL_pushresult</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">стека возвращается к его уровню, когда буфер был инициализирован, плюс последняя строка в его верхней части.





</font></font></p><hr><h3><a name="luaL_buffinit"><code>luaL_buffinit</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_buffinit (lua_State * L, luaL_Buffer * B);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Инициализирует буфер </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Эта функция не выделяет места; </font><font style="vertical-align: inherit;">буфер должен быть объявлен как переменная (см. </font></font><a href="#luaL_Buffer"><code>luaL_Buffer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).





</font></font></p><hr><h3><a name="luaL_buffinitsize"><code>luaL_buffinitsize</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- ?, + ?, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char * luaL_buffinitsize (lua_State * L, luaL_Buffer * B, size_t sz);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эквивалент последовательности
 </font></font><a href="#luaL_buffinit"><code>luaL_buffinit</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="#luaL_prepbuffsize"><code>luaL_prepbuffsize</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="luaL_callmeta"><code>luaL_callmeta</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, + (0 | 1), </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_callmeta (lua_State * L, int obj, const char * e);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Называет метаметод.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если у объекта в индексе </font></font><code>obj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть метатабель, а у этого метатабеля есть поле </font></font><code>e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, эта функция вызывает это поле, передавая объект в качестве единственного аргумента. </font><font style="vertical-align: inherit;">В этом случае эта функция возвращает true и помещает в стек значение, возвращаемое вызовом. </font><font style="vertical-align: inherit;">Если нет метатабельного или метаметода, эта функция возвращает false (без добавления какого-либо значения в стек).





</font></font></p><hr><h3><a name="luaL_checkany"><code>luaL_checkany</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_checkany (lua_State * L, int arg);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Проверяет, имеет ли функция аргумент любого типа (включая </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) в позиции </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="luaL_checkinteger"><code>luaL_checkinteger</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_Integer luaL_checkinteger (lua_State * L, int arg);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Проверяет, является ли аргумент функции </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">целым числом (или может быть преобразовано в целое число), и возвращает это целочисленное приведение к a </font></font><a href="#lua_Integer"><code>lua_Integer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="luaL_checklstring"><code>luaL_checklstring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * luaL_checklstring (lua_State * L, int arg, size_t * l);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Проверяет, является ли аргумент функции </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">строкой, и возвращает эту строку; </font><font style="vertical-align: inherit;">if </font></font><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">заполняется </font></font><code>*l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
длиной строки.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция используется </font></font><a href="#lua_tolstring"><code>lua_tolstring</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для получения результата, поэтому здесь применяются все преобразования и предостережения этой функции.





</font></font></p><hr><h3><a name="luaL_checknumber"><code>luaL_checknumber</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_Number luaL_checknumber (lua_State * L, int arg);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Проверяет, является ли аргумент функции </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">числом, и возвращает это число.





</font></font></p><hr><h3><a name="luaL_checkoption"><code>luaL_checkoption</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_checkoption (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      Int Arg,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      const char * def,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      const char * const lst []);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Проверяет, является ли аргумент функции </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">строкой, и ищет эту строку в массиве </font></font><code>lst</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(который должен заканчиваться NULL). </font><font style="vertical-align: inherit;">Возвращает индекс в массиве, где была найдена строка. </font><font style="vertical-align: inherit;">Вызывает ощибку, если аргумент не является строкой или если строка не может быть найдена.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>def</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это не так </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, функция использует </font></font><code>def</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">значение по умолчанию, когда аргумент отсутствует </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или этот аргумент равен </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нулю</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Это полезная функция для отображения строк в перечисления C. </font><font style="vertical-align: inherit;">(Обычно в библиотеках Lua принято использовать строки вместо чисел для выбора опций.)





</font></font></p><hr><h3><a name="luaL_checkstack"><code>luaL_checkstack</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_checkstack (lua_State * L, int sz, const char * msg);</font></font></pre>

<p><font style="vertical-align: inherit;"></font><code>top + sz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Увеличивает </font><font style="vertical-align: inherit;">
размер стека до </font><font style="vertical-align: inherit;">элементов, увеличивая размер, если стек не может расти до этого размера.
</font></font><code>msg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это дополнительный текст, который нужно ввести в сообщение ощибка (или </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">без дополнительного текста).





</font></font></p><hr><h3><a name="luaL_checkstring"><code>luaL_checkstring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * luaL_checkstring (lua_State * L, int arg);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Проверяет, является ли аргумент функции </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">строкой, и возвращает эту строку.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция используется </font></font><a href="#lua_tolstring"><code>lua_tolstring</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для получения результата, поэтому здесь применяются все преобразования и предостережения этой функции.





</font></font></p><hr><h3><a name="luaL_checktype"><code>luaL_checktype</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_checktype (lua_State * L, int arg, int t);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Проверяет, имеет ли аргумент функции </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">тип </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">См. </font></font><a href="#lua_type"><code>lua_type</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Для кодирования типов для </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="luaL_checkudata"><code>luaL_checkudata</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void * luaL_checkudata (lua_State * L, int arg, const char * tname);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Проверяет, является ли аргумент функции </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">пользовательскими данными типа </font></font><code>tname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(см. </font></font><a href="#luaL_newmetatable"><code>luaL_newmetatable</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), И возвращает адрес пользовательских данных (см. </font></font><a href="#lua_touserdata"><code>lua_touserdata</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).





</font></font></p><hr><h3><a name="luaL_checkversion"><code>luaL_checkversion</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_checkversion (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Проверяет, используют ли ядро, выполняющее вызов, ядро, создавшее состояние Lua, и код, выполняющий вызов, одну и ту же версию Lua. </font><font style="vertical-align: inherit;">Также проверяет, используют ли ядро, выполняющее вызов, и ядро, создавшее состояние Lua, одно и то же адресное пространство.





</font></font></p><hr><h3><a name="luaL_dofile"><code>luaL_dofile</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, + ?, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_dofile (lua_State * L, const char * filename);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Загружает и запускает данный файл. </font><font style="vertical-align: inherit;">Он определяется как следующий макрос:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     (luaL_loadfile (L, имя файла) || lua_pcall (L, 0, LUA_MULTRET, 0))
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает false, если ошибок нет, или true в случае ошибок.





</font></font></p><hr><h3><a name="luaL_dostring"><code>luaL_dostring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, + ?, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_dostring (lua_State * L, const char * str);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Загружает и запускает данную строку. </font><font style="vertical-align: inherit;">Он определяется как следующий макрос:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     (luaL_loadstring (L, str) || lua_pcall (L, 0, LUA_MULTRET, 0))
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает false, если ошибок нет, или true в случае ошибок.





</font></font></p><hr><h3><a name="luaL_error"><code>luaL_error</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_error (lua_State * L, const char * fmt, ...);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Повышает ощибка. </font><font style="vertical-align: inherit;">Формат сообщения ощибка задается </font></font><code>fmt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
плюс любые дополнительные аргументы, следуя тем же правилам </font></font><a href="#lua_pushfstring"><code>lua_pushfstring</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Он также добавляет в начале сообщения имя файла и номер строки, где произошла ощибка, если эта информация доступна.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция никогда не возвращается, но это идиома, чтобы использовать ее в функциях C как </font><font style="vertical-align: inherit;">.





</font></font><code>return luaL_error(<em>args</em>)</code><font style="vertical-align: inherit;"></font></p><hr><h3><a name="luaL_execresult"><code>luaL_execresult</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +3, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_execresult (lua_State * L, int stat);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция создает возвращаемые значения для функций, связанных с процессом, в стандартной библиотеке ( </font></font><a href="#pdf-os.execute"><code>ос.выполнить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><a href="#pdf-io.close"><code>вв.закрой</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).





</font></font></p><hr><h3><a name="luaL_fileresult"><code>luaL_fileresult</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, + (1 | 3), </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_fileresult (lua_State * L, int stat, const char * fname);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция производит возвращаемые значения для функций , </font><font style="vertical-align: inherit;">относящихся к </font><font style="vertical-align: inherit;">файлам в стандартной библиотеке ( </font></font><a href="#pdf-io.open"><code>вв.открой</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="#pdf-os.rename"><code>ос.переименовать</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="#pdf-file:seek"><code>file:seek</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и т.д.).





</font></font></p><hr><h3><a name="luaL_getmetafield"><code>luaL_getmetafield</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, + (0 | 1), </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_getmetafield (lua_State * L, int obj, const char * e);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Помещает в стек поле </font></font><code>e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">из метатаблицы объекта по индексу </font></font><code>obj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и возвращает тип толкаемого значения. </font><font style="vertical-align: inherit;">Если у объекта нет метатаблицы или если у метатаблицы нет этого поля, ничего не выдвигается и возвращается </font></font><code>LUA_TNIL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="luaL_getmetatable"><code>luaL_getmetatable</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_getmetatable (lua_State * L, const char * tname);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Помещает в стек метатаблицу, связанную с именем </font></font><code>tname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
в реестре (см. </font></font><a href="#luaL_newmetatable"><code>luaL_newmetatable</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ноль,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> если нет метатаблицы, связанной с этим именем). </font><font style="vertical-align: inherit;">Возвращает тип переданного значения.





</font></font></p><hr><h3><a name="luaL_getsubtable"><code>luaL_getsubtable</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_getsubtable (lua_State * L, int idx, const char * fname);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Гарантирует, что значение </font></font><code>t[fname]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, где </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть значение в индексе </font></font><code>idx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, является таблицей, и помещает эту таблицу в стек. </font><font style="vertical-align: inherit;">Возвращает true, если находит там предыдущую таблицу, и false, если создает новую таблицу.





</font></font></p><hr><h3><a name="luaL_gsub"><code>luaL_gsub</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * luaL_gsub (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                       const char * s,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                       const char * p,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                       const char * r);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Создает копию строки </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, заменяя любое вхождение строки </font></font><code>p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
строкой </font></font><code>r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Вставляет полученную строку в стек и возвращает ее.





</font></font></p><hr><h3><a name="luaL_len"><code>luaL_len</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_Integer luaL_len (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает «длину» значения по заданному индексу в виде числа; </font><font style="vertical-align: inherit;">он эквивалентен </font></font><code>#</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">оператору </font><font style="vertical-align: inherit;">' </font><font style="vertical-align: inherit;">' в Lua (см. </font></font><a href="#3.4.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Вызывает ощибку, если результат операции не является целым числом. </font><font style="vertical-align: inherit;">(Этот случай может происходить только через метаметоды.)





</font></font></p><hr><h3><a name="luaL_loadbuffer"><code>luaL_loadbuffer</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_loadbuffer (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                     const char * buff,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                     size_t sz,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                     const char * name);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эквивалентно </font></font><a href="#luaL_loadbufferx"><code>luaL_loadbufferx</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">с </font></font><code>mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">равным </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="luaL_loadbufferx"><code>luaL_loadbufferx</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_loadbufferx (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      const char * buff,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      size_t sz,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      const char * name,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                      режим const char *);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Загружает буфер как кусок Lua. </font><font style="vertical-align: inherit;">Эта функция используется </font></font><a href="#lua_load"><code>lua_load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для загрузки чанка в буфер, на который указывает </font></font><code>buff</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">размер </font></font><code>sz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция возвращает те же результаты, что и </font></font><a href="#lua_load"><code>lua_load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.
</font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">имя чанка, используемое для отладки информации и ощибка сообщений. </font><font style="vertical-align: inherit;">Строка </font></font><code>mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">работает как в функции </font></font><a href="#lua_load"><code>lua_load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="luaL_loadfile"><code>luaL_loadfile</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_loadfile (lua_State * L, const char * filename);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эквивалентно </font></font><a href="#luaL_loadfilex"><code>luaL_loadfilex</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">с </font></font><code>mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">равным </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="luaL_loadfilex"><code>luaL_loadfilex</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_loadfilex (lua_State * L, const char * filename,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                                            режим const char *);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Загружает файл как кусок Lua. </font><font style="vertical-align: inherit;">Эта функция используется </font></font><a href="#lua_load"><code>lua_load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для загрузки чанка в файл с именем </font></font><code>filename</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если </font></font><code>filename</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, то он загружается со стандартного ввода. </font><font style="vertical-align: inherit;">Первая строка в файле игнорируется, если она начинается с </font></font><code>#</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Строка </font></font><code>mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">работает как в функции </font></font><a href="#lua_load"><code>lua_load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция возвращает те же результаты, что и </font></font><a href="#lua_load"><code>lua_load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, но у нее есть дополнительный код ощибка </font></font><a name="pdf-LUA_ERRFILE"><code>LUA_ERRFILE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
для ошибок, связанных с файлом (например, она не может открыть или прочитать файл).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Так как </font></font><a href="#lua_load"><code>lua_load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">эта функция загружает только чанк; </font><font style="vertical-align: inherit;">он не запускается.





</font></font></p><hr><h3><a name="luaL_loadstring"><code>luaL_loadstring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_loadstring (lua_State * L, const char * s);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Загружает строку как кусок Lua. </font><font style="vertical-align: inherit;">Эта функция используется </font></font><a href="#lua_load"><code>lua_load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для загрузки чанка в строку с нулевым символом в конце </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция возвращает те же результаты, что и </font></font><a href="#lua_load"><code>lua_load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Кроме того </font></font><a href="#lua_load"><code>lua_load</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, эта функция загружает только чанк; </font><font style="vertical-align: inherit;">он не запускается.





</font></font></p><hr><h3><a name="luaL_newlib"><code>luaL_newlib</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_newlib (lua_State * L, const luaL_Reg l []);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Создает новую таблицу и регистрирует там свои функции в списке </font></font><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Это реализовано в виде следующего макроса:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     (luaL_newlibtable (L, l), luaL_setfuncs (L, l, 0))
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Массив </font></font><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должен быть фактическим массивом, а не указателем на него.





</font></font></p><hr><h3><a name="luaL_newlibtable"><code>luaL_newlibtable</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_newlibtable (lua_State * L, const luaL_Reg l []);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Создает новую таблицу с размером, оптимизированным для хранения всех записей в массиве </font></font><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(но на самом деле не сохраняет их). </font><font style="vertical-align: inherit;">Он предназначен для использования вместе с </font></font><a href="#luaL_setfuncs"><code>luaL_setfuncs</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(см. </font></font><a href="#luaL_newlib"><code>luaL_newlib</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Это реализовано как макрос. </font><font style="vertical-align: inherit;">Массив </font></font><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должен быть фактическим массивом, а не указателем на него.





</font></font></p><hr><h3><a name="luaL_newmetatable"><code>luaL_newmetatable</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_newmetatable (lua_State * L, const char * tname);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если в реестре уже есть ключ </font></font><code>tname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, возвращается 0. В противном случае создает новую таблицу, которая будет использоваться в качестве метатаблицы для пользовательских данных, добавляет в эту новую таблицу пару </font></font><code>__name = tname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, добавляет в реестр пару </font></font><code>[tname] = new таблица</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и возвращает 1. (Запись </font></font><code>__name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">используется некоторыми функциями сообщения об ошибках.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В обоих случаях помещает в стек окончательное значение, связанное с </font></font><code>tname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">реестром.





</font></font></p><hr><h3><a name="luaL_newstate"><code>luaL_newstate</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_State * luaL_newstate (void);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Создает новое состояние Lua. </font><font style="vertical-align: inherit;">Он вызывает </font></font><a href="#lua_newstate"><code>lua_newstate</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">распределитель на основе стандартной </font></font><code>realloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функции </font><font style="vertical-align: inherit;">C, </font><font style="vertical-align: inherit;">а затем устанавливает функцию паники (см. </font></font><a href="#4.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), которая печатает сообщение ощибка на стандартный вывод ощибка в случае фатальных ошибок.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает новое состояние, или </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если есть выделение памяти ощибка.





</font></font></p><hr><h3><a name="luaL_openlibs"><code>luaL_openlibs</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_openlibs (lua_State * L);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Открывает все стандартные библиотеки Lua в заданное состояние.





</font></font></p><hr><h3><a name="luaL_opt"><code>luaL_opt</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T luaL_opt (L, func, arg, dflt);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Этот макрос определяется следующим образом:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     (lua_isnoneornil (L, (arg))? (dflt): func (L, (arg)))
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Словом, если аргумент </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">равен нулю или отсутствует, макрос приводит к значению по умолчанию </font></font><code>dflt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">В противном случае это приводит к результату вызова </font></font><code>func</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
с состоянием </font></font><code>L</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и индексом аргумента в </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">качестве параметров. </font><font style="vertical-align: inherit;">Обратите внимание, что оно вычисляет выражение </font></font><code>dflt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">только при необходимости.





</font></font></p><hr><h3><a name="luaL_optinteger"><code>luaL_optinteger</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_Integer luaL_optinteger (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                             Int Arg,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                             lua_Integer d);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если аргумент функции </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является целым числом (или может быть преобразован в целое число), возвращает это целое число. </font><font style="vertical-align: inherit;">Если этот аргумент отсутствует или равен </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нулю</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , возвращает </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Иначе поднимает ощибка.





</font></font></p><hr><h3><a name="luaL_optlstring"><code>luaL_optlstring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * luaL_optlstring (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                             Int Arg,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                             const char * d,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                             size_t * l);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если аргумент функции </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является строкой, возвращает эту строку. </font><font style="vertical-align: inherit;">Если этот аргумент отсутствует или равен </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нулю</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , возвращает </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Иначе поднимает ощибка.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нет </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, заполняет позицию </font></font><code>*l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">длиной результата. </font><font style="vertical-align: inherit;">Если результат </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(возможен только при возврате </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>d == NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), его длина считается нулевой.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция используется </font></font><a href="#lua_tolstring"><code>lua_tolstring</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для получения результата, поэтому здесь применяются все преобразования и предостережения этой функции.





</font></font></p><hr><h3><a name="luaL_optnumber"><code>luaL_optnumber</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lua_Number luaL_optnumber (lua_State * L, int arg, lua_Number d);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если аргумент функции </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является числом, возвращает это число. </font><font style="vertical-align: inherit;">Если этот аргумент отсутствует или равен </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нулю</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , возвращает </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Иначе поднимает ощибка.





</font></font></p><hr><h3><a name="luaL_optstring"><code>luaL_optstring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * luaL_optstring (lua_State * L,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                            Int Arg,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                            const char * d);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если аргумент функции </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является строкой, возвращает эту строку. </font><font style="vertical-align: inherit;">Если этот аргумент отсутствует или равен </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нулю</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , возвращает </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Иначе поднимает ощибка.





</font></font></p><hr><h3><a name="luaL_prepbuffer"><code>luaL_prepbuffer</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- ?, + ?, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char * luaL_prepbuffer (luaL_Buffer * B);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эквивалентно </font></font><a href="#luaL_prepbuffsize"><code>luaL_prepbuffsize</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
с заранее заданным размером </font></font><a name="pdf-LUAL_BUFFERSIZE"><code>LUAL_BUFFERSIZE</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="luaL_prepbuffsize"><code>luaL_prepbuffsize</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- ?, + ?, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char * luaL_prepbuffsize (luaL_Buffer * B, size_t sz);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает адрес в пространство размера, </font></font><code>sz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
где вы можете скопировать строку для добавления в буфер </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(см. </font></font><a href="#luaL_Buffer"><code>luaL_Buffer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">После копирования строки в это пространство вы должны вызвать
 </font></font><a href="#luaL_addsize"><code>luaL_addsize</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">размер строки, чтобы фактически добавить ее в буфер.





</font></font></p><hr><h3><a name="luaL_pushresult"><code>luaL_pushresult</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- ?, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_pushresult (luaL_Buffer * B);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Завершает использование буфера, </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">оставляя последнюю строку в верхней части стека.





</font></font></p><hr><h3><a name="luaL_pushresultsize"><code>luaL_pushresultsize</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[- ?, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_pushresultsize (luaL_Buffer * B, size_t sz);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эквивалент последовательности </font></font><a href="#luaL_addsize"><code>luaL_addsize</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="#luaL_pushresult"><code>luaL_pushresult</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="luaL_ref"><code>luaL_ref</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-1, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int luaL_ref (lua_State * L, int t);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Создает и возвращает </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ссылку</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> в таблице at index </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для объекта на вершине стека (и извлекает объект).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ссылка - это уникальный целочисленный ключ. </font><font style="vertical-align: inherit;">Пока вы не добавляете вручную целочисленные ключи в таблицу </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, вы
 </font></font><a href="#luaL_ref"><code>luaL_ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">гарантируете уникальность возвращаемого ключа. </font><font style="vertical-align: inherit;">Вы можете получить объект, на который ссылается ссылка </font></font><code>r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
, вызывая </font></font><code>lua_rawgeti(L, t, r)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Функция </font></font><a href="#luaL_unref"><code>luaL_unref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">освобождает ссылку и связанный с ней объект.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если объект на вершине стека равен </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нулю</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,
 </font></font><a href="#luaL_ref"><code>luaL_ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает константу </font></font><a name="pdf-LUA_REFNIL"><code>LUA_REFNIL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Константа </font></font><a name="pdf-LUA_NOREF"><code>LUA_NOREF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">гарантированно будет отличаться от любой ссылки, возвращаемой </font></font><a href="#luaL_ref"><code>luaL_ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="luaL_Reg"><code>luaL_Reg</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typedef struct luaL_Reg {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  const char * name;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  lua_CFunction func;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
} luaL_Reg;</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Тип для массивов функций, которые будут зарегистрированы
 </font></font><a href="#luaL_setfuncs"><code>luaL_setfuncs</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.
</font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является именем функции и </font></font><code>func</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является указателем на функцию. </font><font style="vertical-align: inherit;">Любой массив </font></font><a href="#luaL_Reg"><code>luaL_Reg</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должен заканчиваться сторожевой записью, в которой оба </font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>func</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">находятся </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><hr><h3><a name="luaL_requiref"><code>luaL_requiref</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_requiref (lua_State * L, const char * modname,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    lua_CFunction openf, int glb);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если его </font></font><code>modname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">еще нет </font></font><a href="#pdf-package.loaded"><code>модули.loaded</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, вызывает функцию </font></font><code>openf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">со строкой </font></font><code>modname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в качестве аргумента и устанавливает результат вызова </font></font><code>модули.loaded[modname]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, как если бы эта функция была вызвана </font></font><a href="#pdf-require"><code>require</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>glb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это правда, также сохраняет модуль в глобальном </font></font><code>modname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Оставляет копию модуля в стеке.





</font></font></p><hr><h3><a name="luaL_setfuncs"><code>luaL_setfuncs</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-nup, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_setfuncs (lua_State * L, const luaL_Reg * l, int nup);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Регистрирует все функции в массиве </font></font><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(см. </font></font><a href="#luaL_Reg"><code>luaL_Reg</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) В таблицу на вершине стека (ниже необязательных значений повышений, см. Следующее).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>nup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не ноль, все функции создаются с </font></font><code>nup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">общими значениями повышения, которые должны быть предварительно помещены в стек поверх таблицы библиотеки. </font><font style="vertical-align: inherit;">Эти значения выталкиваются из стека после регистрации.





</font></font></p><hr><h3><a name="luaL_setmetatable"><code>luaL_setmetatable</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_setmetatable (lua_State * L, const char * tname);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Устанавливает метатаблицу объекта в верхней части стека в качестве метатаблицы, связанной с именем </font></font><code>tname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
в реестре (см. </font></font><a href="#luaL_newmetatable"><code>luaL_newmetatable</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).





</font></font></p><hr><h3><a name="luaL_Stream"><code>luaL_Stream</code></a></h3>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typedef struct luaL_Stream {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ФАЙЛ * f;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  lua_CFunction closef;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
} luaL_Stream;</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Стандартное представление для файловых дескрипторов, которое используется стандартной библиотекой ввода / вывода.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Дескриптор файла реализован как полные пользовательские данные, с метатаблицей, называемой </font></font><code>LUA_FILEHANDLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(где </font></font><code>LUA_FILEHANDLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">макрос с фактическим именем метатаблицы). </font><font style="vertical-align: inherit;">Метатабель создается библиотекой ввода / вывода (см. </font></font><a href="#luaL_newmetatable"><code>luaL_newmetatable</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эти пользовательские данные должны начинаться со структуры </font></font><code>luaL_Stream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">он может содержать другие данные после этой исходной структуры. </font><font style="vertical-align: inherit;">Поле </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">указывает на соответствующий поток C (или может </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">указывать на не полностью созданный дескриптор). </font><font style="vertical-align: inherit;">Поле </font></font><code>closef</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">указывает на функцию Lua, которая будет вызываться для закрытия потока, когда дескриптор закрыт или собран; </font><font style="vertical-align: inherit;">эта функция получает дескриптор файла в качестве единственного аргумента и должна возвращать либо </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (в случае успеха), либо </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> плюс сообщение ощибка (в случае ощибка). </font><font style="vertical-align: inherit;">Как только Lua вызывает это поле, оно меняет значение поля на, </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
чтобы сигнализировать, что дескриптор закрыт.





</font></font></p><hr><h3><a name="luaL_testudata"><code>luaL_testudata</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void * luaL_testudata (lua_State * L, int arg, const char * tname);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция работает так </font></font><a href="#luaL_checkudata"><code>luaL_checkudata</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, за исключением того, что, когда тест не </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">пройден </font><font style="vertical-align: inherit;">, он возвращает </font><font style="vertical-align: inherit;">вместо вызова ощибка.





</font></font></p><hr><h3><a name="luaL_tolstring"><code>luaL_tolstring</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * luaL_tolstring (lua_State * L, int idx, size_t * len);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразует любое значение Lua по данному индексу в строку C в приемлемом формате. </font><font style="vertical-align: inherit;">Результирующая строка помещается в стек и также возвращается функцией. </font><font style="vertical-align: inherit;">Если </font></font><code>len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нет </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, функция также устанавливает </font></font><code>*len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">длину строки.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если значение имеет метатаблицу с </font></font><code>__tostring</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">полем, то </font></font><code>luaL_tolstring</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">вызывает соответствующий метаметод со значением в качестве аргумента и использует результат вызова в качестве своего результата.





</font></font></p><hr><h3><a name="luaL_traceback"><code>luaL_traceback</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_traceback (lua_State * L, lua_State * L1, const char * msg,</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                     уровень int);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Создает и отправляет трассировку стека </font></font><code>L1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если </font></font><code>msg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это не так, </font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">он добавляется в начале трассировки. </font></font><code>level</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Параметр указывает , </font><font style="vertical-align: inherit;">на каком уровне , </font><font style="vertical-align: inherit;">чтобы начать отслеживающий.





</font></font></p><hr><h3><a name="luaL_typename"><code>luaL_typename</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char * luaL_typename (lua_State * L, int index);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает имя типа значения по указанному индексу.





</font></font></p><hr><h3><a name="luaL_unref"><code>luaL_unref</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +0, -]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_unref (lua_State * L, int t, int ref);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Освобождает ссылку </font></font><code>ref</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">из таблицы по индексу </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(см. </font></font><a href="#luaL_ref"><code>luaL_ref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Запись удаляется из таблицы, так что указанный объект может быть собран. </font><font style="vertical-align: inherit;">Ссылка </font></font><code>ref</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">также освобождается для повторного использования.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>ref</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть </font></font><a href="#pdf-LUA_NOREF"><code>LUA_NOREF</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или </font></font><a href="#pdf-LUA_REFNIL"><code>LUA_REFNIL</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a href="#luaL_unref"><code>luaL_unref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ничего не делает.





</font></font></p><hr><h3><a name="luaL_where"><code>luaL_where</code></a></h3><p>
<span class="apii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-0, +1, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">м</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></span>
</p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void luaL_where (lua_State * L, int lvl);</font></font></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вставляет в стек строку, идентифицирующую текущую позицию элемента управления на уровне </font></font><code>lvl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в стеке вызовов. </font><font style="vertical-align: inherit;">Обычно эта строка имеет следующий формат:

</font></font></p><pre>     <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chunkname</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentline</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Уровень 0 - это функция запуска, уровень 1 - это функция, которая вызвала функцию запуска и т. Д.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция используется для построения префикса для сообщений ощибка.







</font></font></p><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6 - </font></font><a name="6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Стандартные библиотеки</font></font></a></h1>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Стандартные библиотеки Lua предоставляют полезные функции, которые реализуются непосредственно через C API. </font><font style="vertical-align: inherit;">Некоторые из этих функций предоставляют основные услуги языку (например, </font></font><a href="#pdf-type"><code>тип</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><a href="#pdf-getmetatable"><code>дайметатаб</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">); </font><font style="vertical-align: inherit;">другие предоставляют доступ к «внешним» услугам (например, ввод / вывод); </font><font style="vertical-align: inherit;">и другие могут быть реализованы в самом Lua, но весьма полезны или имеют критические требования к производительности, которые заслуживают реализации в C (например, </font></font><a href="#pdf-table.sort"><code>таблица.сортировать</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Все библиотеки реализованы через официальный C API и предоставляются в виде отдельных C-модулей. </font><font style="vertical-align: inherit;">В настоящее время Lua имеет следующие стандартные библиотеки:

</font></font></p><ul>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">базовая библиотека ( </font></font><a href="#6.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">сопрограммы библиотеки ( </font></font><a href="#6.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">библиотека </font></font><a href="#6.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">модулей</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font><a href="#6.3"><font style="vertical-align: inherit;">§6.3</font></a><font style="vertical-align: inherit;"> );</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">манипулирование </font></font><a href="#6.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">строкой</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font><a href="#6.4"><font style="vertical-align: inherit;">§6.4</font></a><font style="vertical-align: inherit;"> );</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">базовая поддержка UTF-8 ( </font></font><a href="#6.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">таблица манипуляций ( </font></font><a href="#6.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">математические функции ( </font></font><a href="#6.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) (sin, log и т. д.);</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ввод и вывод ( </font></font><a href="#6.8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.8</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">средства операционной системы ( </font></font><a href="#6.9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.9</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Услуги отладка ( </font></font><a href="#6.10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.10</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></li>

</ul><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
За исключением базовых библиотек и библиотек модулей, каждая библиотека предоставляет все свои функции в качестве полей глобальной таблицы или в качестве методов ее объектов.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Чтобы получить доступ к этим библиотекам, хост-программа C должна вызвать </font></font><a href="#luaL_openlibs"><code>luaL_openlibs</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функцию, которая открывает все стандартные библиотеки. </font><font style="vertical-align: inherit;">В качестве альтернативы, хост-программа может открывать их по отдельности, используя
 </font></font><a href="#luaL_requiref"><code>luaL_requiref</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для вызова
 </font></font><a name="pdf-luaopen_base"><code>luaopen_base</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(для базовой библиотеки),
 </font></font><a name="pdf-luaopen_package"><code>luaopen_package</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(для библиотеки
 </font></font><a name="pdf-luaopen_coroutine"><code>luaopen_coroutine</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">модулей), </font></font><a name="pdf-luaopen_string"><code>luaopen_string</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(для </font><font style="vertical-align: inherit;">библиотеки сопрограммы), </font><font style="vertical-align: inherit;">(для </font><font style="vertical-align: inherit;">библиотеки строк),
 </font><font style="vertical-align: inherit;">(для библиотеки
 </font></font><a name="pdf-luaopen_utf8"><code>luaopen_utf8</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTF8),
 </font></font><a name="pdf-luaopen_table"><code>luaopen_table</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(для библиотека таблиц),
 </font></font><a name="pdf-luaopen_math"><code>luaopen_math</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(для математической библиотеки),
 </font></font><a name="pdf-luaopen_io"><code>luaopen_io</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(для библиотеки ввода-вывода),
 </font></font><a name="pdf-luaopen_os"><code>luaopen_os</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(для библиотеки операционной системы) и </font></font><a name="pdf-luaopen_debug"><code>luaopen_debug</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(для библиотеки отладка). </font><font style="vertical-align: inherit;">Эти функции объявлены в </font></font><a name="pdf-lualib.h"><code>lualib.h</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.



</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1 - </font></font><a name="6.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Основные функции</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Базовая библиотека предоставляет основные функции Lua. </font><font style="vertical-align: inherit;">Если вы не включили эту библиотеку в свое приложение, вам следует тщательно проверить, нужно ли предоставлять реализации для некоторых из ее средств.


</font></font></p><p>
</p><hr><h3><a name="pdf-assert"><code>утв (v [, message])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вызывает, </font></font><a href="#pdf-error"><code>ощибка</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если значение его аргумента </font></font><code>v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ложно (т. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Е. Ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> или </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ложь</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ); </font><font style="vertical-align: inherit;">в противном случае возвращает все свои аргументы. </font><font style="vertical-align: inherit;">В случае ощибка,
 </font></font><code>message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это объект ощибка; </font><font style="vertical-align: inherit;">если отсутствует, по умолчанию " </font></font><code>assertion failed!</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"




</font></font></p><p>
</p><hr><h3><a name="pdf-collectgarbage"><code>собратьмусор ([opt [, arg]])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция является универсальным интерфейсом для сборщика мусора. </font><font style="vertical-align: inherit;">Он выполняет различные функции в соответствии со своим первым аргументом </font></font><code>opt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:

</font></font></p><ul>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><code>collect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">":</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
выполняет полный цикл сбора мусора. </font><font style="vertical-align: inherit;">Это опция по умолчанию.
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">« </font></font><code>stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">»:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
останавливает автоматическое выполнение сборщика мусора. </font><font style="vertical-align: inherit;">Сборщик будет работать только при явном вызове, пока не будет вызван его перезапуск.
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">« </font></font><code>restart</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">»:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
возобновляет автоматическое выполнение сборщика мусора.
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><code>count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">":</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
возвращает общее количество памяти, используемой Lua в килобайтах. </font><font style="vertical-align: inherit;">Значение имеет дробную часть, поэтому оно умножается на 1024 и дает точное количество байтов, используемых Lua (за исключением переполнений).
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><code>step</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">":</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
выполняет шаг сборки мусора. </font><font style="vertical-align: inherit;">Шаг «размер» контролируется </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">При нулевом значении коллектор выполнит один основной (неделимый) шаг. </font><font style="vertical-align: inherit;">Для ненулевых значений сборщик будет работать так, как если бы Lua выделил этот объем памяти (в килобайтах). </font><font style="vertical-align: inherit;">Возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> если шаг завершил цикл сбора.
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">« </font></font><code>setpause</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">»:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
устанавливает </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в качестве нового значения </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">паузы</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> коллектора (см. </font></font><a href="#2.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Возвращает предыдущее значение для </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">паузы</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">« </font></font><code>setstepmul</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">»:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
устанавливает </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в качестве нового значения </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">множитель шага</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> коллектора (см. </font></font><a href="#2.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Возвращает предыдущее значение для </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">шага</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">« </font></font><code>isrunning</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">»:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
возвращает логическое значение, которое сообщает, работает ли сборщик (т. е. не остановлен).
</font></font></li>

</ul>



<p>
</p><hr><h3><a name="pdf-dofile"><code>испфайл ([filename])</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Открывает указанный файл и выполняет его содержимое в виде фрагмента Lua. </font><font style="vertical-align: inherit;">При вызове без аргументов
 </font></font><code>испфайл</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">выполняет содержимое стандартного input ( </font></font><code>stdin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Возвращает все значения, возвращаемые чанком. </font><font style="vertical-align: inherit;">В случае ошибок </font></font><code>испфайл</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">передает ощибка своему вызывающему (то есть </font></font><code>испфайл</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не работает в защищенном режиме).




</font></font><p>
</p><hr><h3><a name="pdf-error"><code>ощибка (message [, level])</code></a></h3><font style="vertical-align: inherit;"></font><code>message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Завершает последнюю вызванную </font><font style="vertical-align: inherit;">
защищенную функцию и возвращает </font><font style="vertical-align: inherit;">как объект ощибка. </font><font style="vertical-align: inherit;">Функция </font></font><code>ощибка</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">никогда не возвращается.


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Обычно </font></font><code>ощибка</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">добавляет некоторую информацию о позиции ощибка в начале сообщения, если сообщение является строкой. </font></font><code>level</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Аргумент определяет , </font><font style="vertical-align: inherit;">как получить позицию ощибка. </font><font style="vertical-align: inherit;">На уровне 1 (по умолчанию) позиция ощибка - это то место, где
 </font></font><code>ощибка</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">была вызвана функция. </font><font style="vertical-align: inherit;">Уровень 2 указывает ощибка туда, где </font></font><code>ощибка</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">была вызвана </font><font style="vertical-align: inherit;">вызывающая функция </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">и так далее. </font><font style="vertical-align: inherit;">Прохождение уровня 0 позволяет избежать добавления ощибка информации о положении в сообщение.




</font></font></p><p>
</p><hr><h3><a name="pdf-_G"><code>_G</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Глобальная переменная (не функция), которая содержит глобальную среду (см. </font></font><a href="#2.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Сам Lua не использует эту переменную; </font><font style="vertical-align: inherit;">изменение его значения не влияет ни на окружающую среду, ни наоборот.




</font></font><p>
</p><hr><h3><a name="pdf-getmetatable"><code>дайметатаб (object)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нет метатаблицы, возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">В противном случае, если у метатаблицы объекта есть </font></font><code>__metatable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">поле, возвращается соответствующее значение. </font><font style="vertical-align: inherit;">В противном случае возвращает метатаблицу данного объекта.




</font></font></p><p>
</p><hr><h3><a name="pdf-ipairs"><code>перечисли (t)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает три значения (функция итератора, таблица </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и 0), чтобы конструкция

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     для i, v в перечисли (t) </font><font style="vertical-align: inherit;">конец
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">тела</font></font></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
будет перебирать ключ-значение пар ( </font></font><code>1,t[1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), ( </font></font><code>2,t[2]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), ..., до первого значения nil.




</font></font></p><p>
</p><hr><h3><a name="pdf-load"><code>загрузить (chunk [, chunkname [, mode [, env]]])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Загружает кусок.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>chunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это строка, чанк это строка. </font><font style="vertical-align: inherit;">Если </font></font><code>chunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это функция,
 </font></font><code>загрузить</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">она вызывается повторно, чтобы получить куски фрагментов. </font><font style="vertical-align: inherit;">Каждый вызов </font></font><code>chunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должен возвращать строку, которая объединяется с предыдущими результатами. </font><font style="vertical-align: inherit;">Возврат пустой строки, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> или </font><b><font style="vertical-align: inherit;">нулевого</font></b><font style="vertical-align: inherit;"> значения сигнализирует об окончании фрагмента.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если нет синтаксических ошибок, возвращает скомпилированный кусок как функцию; </font><font style="vertical-align: inherit;">в противном случае возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> плюс сообщение ощибка.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если результирующая функция имеет значения upvalue, первое значение upvalue устанавливается равным значению </font></font><code>env</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, если задан этот параметр, или значению глобальной среды. </font><font style="vertical-align: inherit;">Другие повышения инициализируются с </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нуля</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">(Когда вы загружаете основной чанк, результирующая функция всегда будет иметь ровно одно значение повышения, </font></font><code>_ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">переменную (см. </font></font><a href="#2.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Однако, когда вы загружаете бинарный чанк, созданный из функции (см. </font></font><a href="#pdf-string.dump"><code>строка.дамп</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), Результирующая функция может иметь произвольное число upvalues.) Все upvalues ​​являются свежими, то есть они не разделяются с любой другой функцией.


</font></font></p><p>
<code>chunkname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">используется в качестве имени чанка для сообщений ощибка и информации отладки (см. </font></font><a href="#4.9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§4.9</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Если отсутствует, по умолчанию используется значение </font></font><code>chunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if, если </font></font><code>chunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это строка, или « </font></font><code>=(загрузить)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">» в противном случае.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Строка </font></font><code>mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">определяет, может ли фрагмент быть текстовым или двоичным (то есть предварительно скомпилированным фрагментом). </font><font style="vertical-align: inherit;">Это может быть строка " </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" (только двоичные блоки), " </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" (только текстовые блоки) или " </font></font><code>bt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" (как двоичная, так и текстовая). </font><font style="vertical-align: inherit;">По умолчанию это " </font></font><code>bt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">".


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua не проверяет согласованность двоичных фрагментов. </font><font style="vertical-align: inherit;">Вредоносно созданные двоичные фрагменты могут привести к сбою интерпретатора.




</font></font></p><p>
</p><hr><h3><a name="pdf-loadfile"><code>загрузитьфайл ([filename [, mode [, env]]])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Аналогично </font></font><a href="#pdf-load"><code>загрузить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, но получает фрагмент из файла </font></font><code>filename</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
или из стандартного ввода, если имя файла не указано.




</font></font></p><p>
</p><hr><h3><a name="pdf-next"><code>следующий (таблица [, index])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Позволяет программе пересекать все поля таблицы. </font><font style="vertical-align: inherit;">Его первый аргумент - это таблица, а второй аргумент - это индекс в этой таблице.
</font></font><code>следующий</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает следующий индекс таблицы и связанное с ней значение. </font><font style="vertical-align: inherit;">При вызове с </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil в</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> качестве второго аргумента
 </font></font><code>следующий</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает начальный индекс и соответствующее значение. </font><font style="vertical-align: inherit;">При вызове с последним индексом или с </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нулем</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> в пустой таблице
 </font></font><code>следующий</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Если второй аргумент отсутствует, то он интерпретируется как </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">В частности, вы можете использовать, </font></font><code>следующий(t)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">чтобы проверить, пуста ли таблица.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Порядок, в котором перечислены индексы, не указан,
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">даже для числовых индексов</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">(Чтобы просмотреть таблицу в числовом порядке, используйте числовое значение </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Поведение </font></font><code>следующий</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не определено, если во время обхода вы присваиваете какое-либо значение несуществующему полю в таблице. </font><font style="vertical-align: inherit;">Однако вы можете изменить существующие поля. </font><font style="vertical-align: inherit;">В частности, вы можете очистить существующие поля.




</font></font></p><p>
</p><hr><h3><a name="pdf-pairs"><code>пар (t)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">имеет метаметод </font></font><code>__pairs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, вызывает его </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">как аргумент и возвращает первые три результата вызова.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В противном случае возвращает три значения: </font></font><a href="#pdf-next"><code>следующий</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функцию, таблицу </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , чтобы конструкция

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     для k, v в пар (t) </font><font style="vertical-align: inherit;">конец
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">тела</font></font></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
будет перебирать все значение ключа пар таблицы </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Смотрите функцию, </font></font><a href="#pdf-next"><code>следующий</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">чтобы </font><font style="vertical-align: inherit;">узнать </font><font style="vertical-align: inherit;">о модификации таблицы во время ее обхода.




</font></font></p><p>
</p><hr><h3><a name="pdf-pcall"><code>рвызов (f [, arg1, ···])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вызывает функцию </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">с заданными аргументами в </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">защищенном режиме</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Это означает, что любая ощибка внутри&nbsp; </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не размножается; </font><font style="vertical-align: inherit;">вместо этого </font></font><code>рвызов</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ловит ощибка и возвращает код состояния. </font><font style="vertical-align: inherit;">Его первым результатом является код состояния (логическое значение), который имеет значение true, если вызов выполнен без ошибок. </font><font style="vertical-align: inherit;">В таком случае </font></font><code>рвызов</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">также возвращает все результаты вызова, после этого первого результата. </font><font style="vertical-align: inherit;">В случае любой ощибки, </font></font><code>рвызов</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и сообщение ощибка.




</font></font></p><p>
</p><hr><h3><a name="pdf-print"><code>печать (···)</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Получает любое количество аргументов и печатает их значения </font></font><code>stdout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, используя </font></font><a href="#pdf-tostring"><code>строковой</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функцию для преобразования каждого аргумента в строку.
</font></font><code>печать</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не предназначен для форматированного вывода, а только как быстрый способ показать значение, например, для отладки. </font><font style="vertical-align: inherit;">Для полного контроля над выходом используйте </font></font><a href="#pdf-string.format"><code>строка.формат</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><a href="#pdf-io.write"><code>вв.пиши</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font><p>
</p><hr><h3><a name="pdf-rawequal"><code>сравнитьнапрямую (v1, v2)</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Проверяет, </font></font><code>v1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">равен ли </font></font><code>v2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, не вызывая </font></font><code>__eq</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметод. </font><font style="vertical-align: inherit;">Возвращает логическое значение.




</font></font><p>
</p><hr><h3><a name="pdf-rawget"><code>взятьнапрямую (таблица, index)</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Получает реальную стоимость </font></font><code>таблица[index]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, не вызывая </font></font><code>__index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметод.
</font></font><code>таблица</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должна быть таблица;
</font></font><code>index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">может иметь любое значение




</font></font><p>
</p><hr><h3><a name="pdf-rawlen"><code>длинанапрямую (v)</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает длину объекта </font></font><code>v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, которая должна быть таблицей или строкой, без вызова </font></font><code>__len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметода. </font><font style="vertical-align: inherit;">Возвращает целое число.




</font></font><p>
</p><hr><h3><a name="pdf-rawset"><code>сыраяуст (таблица, index, value)</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Устанавливает реальное значение </font></font><code>таблица[index]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to </font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, не вызывая </font></font><code>__newindex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">метаметод.
</font></font><code>таблица</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должен быть таблицей,
 </font></font><code>index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">любым значением, отличным от </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и NaN, и </font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">любым значением Lua.


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция возвращает </font></font><code>таблица</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-select"><code>выбор (index, ···)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это число, возвращает все аргументы после номера аргумента </font></font><code>index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">отрицательное число указывает на конец (-1 - последний аргумент). </font><font style="vertical-align: inherit;">В противном случае </font></font><code>index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должна быть строка </font></font><code>"#"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>выбор</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает общее количество дополнительных аргументов, которые она получила.




</font></font></p><p>
</p><hr><h3><a name="pdf-setmetatable"><code>устметатаб (таблица, metatable)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Устанавливает метатаблицу для данной таблицы. </font><font style="vertical-align: inherit;">(Чтобы изменить метатабель других типов из кода Lua, вы должны использовать библиотеку </font></font><a href="#6.10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">отладка</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font><a href="#6.10"><font style="vertical-align: inherit;">§6.10</font></a><font style="vertical-align: inherit;"> ).) Если </font></font><code>metatable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , удаляет метатабиль данной таблицы. </font><font style="vertical-align: inherit;">Если у оригинального метатабеля есть </font></font><code>__metatable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">поле, возникает ощибка.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция возвращает </font></font><code>таблица</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-tonumber"><code>числовой (e [, base])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда вызывается без </font></font><code>base</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><code>числовой</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">пытается преобразовать свой аргумент в число. </font><font style="vertical-align: inherit;">Если аргумент уже является числом или строкой, конвертируемой в число, то </font></font><code>числовой</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращается это число; </font><font style="vertical-align: inherit;">в противном случае возвращается </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразование строк может привести к целым числам или числам с плавающей точкой, в соответствии с лексическими соглашениями Lua (см. </font></font><a href="#3.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">(Строка может иметь начальные и конечные пробелы и знак.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда вызывается с </font></font><code>base</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, тогда </font></font><code>e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должна быть строка, которая должна интерпретироваться как целое число в этой базе. </font><font style="vertical-align: inherit;">Основание может быть любым целым числом от 2 до 36 включительно. </font><font style="vertical-align: inherit;">В основаниях выше 10 буква « </font></font><code>A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">» (в верхнем или нижнем регистре) представляет 10, « </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">» представляет 11 и т. Д., Причем « </font></font><code>Z</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">» представляет 35. Если строка </font></font><code>e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не является допустимым числом в данном основании, функция возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NIL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .




</font></font></p><p>
</p><hr><h3><a name="pdf-tostring"><code>строковой (v)</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Получает значение любого типа и преобразует его в строку в удобочитаемом формате. </font><font style="vertical-align: inherit;">(Для полного контроля над тем, как числа конвертируются, используйте </font></font><a href="#pdf-string.format"><code>строка.формат</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.)


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если у метатаблицы </font></font><code>v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть </font></font><code>__tostring</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">поле, то оно </font></font><code>строковой</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">вызывает соответствующее значение с </font></font><code>v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">аргументом as и использует результат вызова в качестве своего результата.




</font></font></p><p>
</p><hr><h3><a name="pdf-type"><code>тип (v)</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает тип своего единственного аргумента, закодированный как строка. </font><font style="vertical-align: inherit;">Возможные результаты этой функции: " </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" (строка, а не значение </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), " </font></font><code>number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">", " </font></font><code>строка</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">", " </font></font><code>boolean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">", " </font></font><code>таблица</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">", " </font></font><code>function</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">", " </font></font><code>thread</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" и " </font></font><code>userdata</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">".




</font></font><p>
</p><hr><h3><a name="pdf-_VERSION"><code>_VERSION</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Глобальная переменная (не функция), которая содержит строку, содержащую работающую версию Lua. </font><font style="vertical-align: inherit;">Текущее значение этой переменной - " </font></font><code>Lua 5.3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">".




</font></font></p><p>
</p><hr><h3><a name="pdf-xpcall"><code>хрвызов (f, msgh [, arg1, ···])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция аналогична </font></font><a href="#pdf-pcall"><code>рвызов</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, за исключением того, что она устанавливает новый обработчик сообщений </font></font><code>msgh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.







</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2 - </font></font><a name="6.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Манипуляция сопрограммой</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта библиотека содержит операции для манипулирования сопрограммами, которые находятся внутри таблицы </font></font><a name="pdf-coroutine"><code>сопрограммы</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Смотрите </font></font><a href="#2.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§2.6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> для общего описания сопрограмм.


</font></font></p><p>
</p><hr><h3><a name="pdf-coroutine.create"><code>сопрограммы.создать (f)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Создает новую сопрограммы, с телом </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.
</font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должен быть функцией. </font><font style="vertical-align: inherit;">Возвращает эту новую сопрограммы, объект с тип </font></font><code>"thread"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-coroutine.isyieldable"><code>сопрограммы.isyieldable ()</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает true, когда запущенные сопрограммы могут дать.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Выполняемая сопрограмма является доходной, если она не является основным потоком и не находится внутри непроизводимой функции C.




</font></font></p><p>
</p><hr><h3><a name="pdf-coroutine.resume"><code>сопрограммы.продолжить (co [, val1, ···])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Запускает или продолжает выполнение сопрограммы </font></font><code>co</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">В первый раз, когда вы возобновляете сопрограммы, она начинает управлять своим телом. </font><font style="vertical-align: inherit;">Значения </font></font><code>val1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... передаются в качестве аргументов функции body. </font><font style="vertical-align: inherit;">Если сопрограммы уступила,
 </font></font><code>resume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">перезапускает ее; </font><font style="vertical-align: inherit;">значения </font></font><code>val1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... передаются как результаты от доходности.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если сопрограммы выполняются без каких-либо ошибок,
 </font></font><code>resume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> плюс любые значения, переданные </font></font><code>yield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(когда уступает сопрограммы), или любые значения, возвращаемые функцией body (когда завершается сопрограммы). </font><font style="vertical-align: inherit;">Если есть какая-то ощибка,
 </font></font><code>resume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> плюс сообщение ощибка.




</font></font></p><p>
</p><hr><h3><a name="pdf-coroutine.running"><code>сопрограммы.запущен ()</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает работающую сопрограммы плюс логическое значение, true, когда работающая сопрограммы является основной.




</font></font></p><p>
</p><hr><h3><a name="pdf-coroutine.status"><code>сопрограммы.статус (co)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает статус сопрограммы </font></font><code>co</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в виде строки:,
 </font></font><code>"running"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если сопрограммы запущены (то есть вызваны </font></font><code>status</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">);
</font></font><code>"suspended"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если сопрограммы приостановлены в вызове </font></font><code>yield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или если он еще не запущен;
</font></font><code>"normal"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если сопрограммы активны, но не запущены (то есть возобновлены другие сопрограммы); </font><font style="vertical-align: inherit;">и </font></font><code>"dead"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если сопрограммы закончили свою функцию тела, или если она остановилась с ощибкой.




</font></font></p><p>
</p><hr><h3><a name="pdf-coroutine.wrap"><code>сопрограммы.обернуть (f)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Создает новую сопрограммы, с телом </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.
</font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должен быть функцией. </font><font style="vertical-align: inherit;">Возвращает функцию, которая возобновляет сопрограммы при каждом ее вызове. </font><font style="vertical-align: inherit;">Любые аргументы, переданные функции, ведут себя как дополнительные аргументы для </font></font><code>resume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Возвращает те же значения, которые возвращает </font></font><code>resume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, кроме первого логического значения. </font><font style="vertical-align: inherit;">В случае ощибка, размножается ощибка.




</font></font></p><p>
</p><hr><h3><a name="pdf-coroutine.yield"><code>сопрограммы.передать (···)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Приостанавливает выполнение призвания сопрограммы. </font><font style="vertical-align: inherit;">Все аргументы для </font></font><code>yield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">передаются как дополнительные результаты </font></font><code>resume</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.







</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3 - </font></font><a name="6.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Модули</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Библиотека модулей предоставляет базовые возможности для загрузки модулей в Lua. </font><font style="vertical-align: inherit;">Она экспортирует одну функцию непосредственно в глобальной среде:
 </font></font><a href="#pdf-require"><code>require</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Все остальное экспортируется в таблицу </font></font><a name="pdf-package"><code>модули</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p>
</p><hr><h3><a name="pdf-require"><code>require (modname)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Загружает данный модуль. </font><font style="vertical-align: inherit;">Функция начинается с просмотра </font></font><a href="#pdf-package.loaded"><code>модули.loaded</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">таблицы, чтобы определить, </font></font><code>modname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">загружена </font><font style="vertical-align: inherit;">ли </font><font style="vertical-align: inherit;">она уже. </font><font style="vertical-align: inherit;">Если это так, то </font></font><code>require</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает значение, сохраненное в </font></font><code>модули.loaded[modname]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">В противном случае он пытается найти </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">загрузчик</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> для модуля.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Чтобы найти загрузчик,
 </font></font><code>require</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">руководствуйтесь </font></font><a href="#pdf-package.searchers"><code>модули.searchers</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">последовательностью. </font><font style="vertical-align: inherit;">Изменяя эту последовательность, мы можем изменить </font></font><code>require</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">внешний вид модуля. </font><font style="vertical-align: inherit;">Следующее объяснение основано на конфигурации по умолчанию для </font></font><a href="#pdf-package.searchers"><code>модули.searchers</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Первые </font></font><code>require</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">запросы </font></font><code>модули.preload[modname]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если оно имеет значение, это значение (которое должно быть функцией) является загрузчиком. </font><font style="vertical-align: inherit;">В противном случае </font></font><code>require</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ищет загрузчик Lua, используя путь, сохраненный в </font></font><a href="#pdf-package.path"><code>модули.path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если это также не удается, он ищет загрузчик C, используя путь, сохраненный в </font></font><a href="#pdf-package.cpath"><code>модули.cpath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если это также не удается, он пытается </font><font style="vertical-align: inherit;">загрузчик « </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">все в одном»</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (см. </font></font><a href="#pdf-package.searchers"><code>модули.searchers</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Как только загрузчик найден,
 </font></font><code>require</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">вызывает загрузчик с двумя аргументами:
 </font></font><code>modname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и дополнительным значением, зависящим от того, как он получил загрузчик. </font><font style="vertical-align: inherit;">(Если загрузчик получен из файла, это дополнительное значение является именем файла.) Если загрузчик возвращает любое значение, </font></font><code>require</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">отличное от </font><font style="vertical-align: inherit;">nil,
 </font><font style="vertical-align: inherit;">присваивает возвращаемое значение </font></font><code>модули.loaded[modname]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если загрузчик не возвращает ненулевое значение и не назначил никакого значения </font></font><code>модули.loaded[modname]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, тогда </font></font><code>require</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">присваивается значение </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> этой записи. </font><font style="vertical-align: inherit;">В любом случае </font></font><code>require</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает окончательное значение </font></font><code>модули.loaded[modname]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если есть какая-либо загрузка или запуск модуля или если он не может найти загрузчик для модуля, то </font></font><code>require</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возникает ошибка.




</font></font></p><p>
</p><hr><h3><a name="pdf-package.config"><code>модули.config</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Строка, описывающая некоторые конфигурации во время компиляции для пакетов. </font><font style="vertical-align: inherit;">Эта строка представляет собой последовательность строк:

</font></font></p><ul>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Первая строка - это строка разделителя каталогов. </font><font style="vertical-align: inherit;">По умолчанию </font></font><code>\</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«для Windows» и </font></font><code>/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«для всех других систем.</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Вторая строка - это символ, который разделяет шаблоны в пути. </font><font style="vertical-align: inherit;">По умолчанию это « </font></font><code>;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">».</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Третья строка - это строка, обозначающая точки замещения в шаблоне. </font><font style="vertical-align: inherit;">По умолчанию это « </font></font><code>?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">».</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Четвертая строка - это строка, которая в пути в Windows заменяется каталогом исполняемого файла. </font><font style="vertical-align: inherit;">По умолчанию это « </font></font><code>!</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">».</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Пятая строка - это метка, которая игнорирует весь текст после нее при построении имени </font></font><code>luaopen_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функции. </font><font style="vertical-align: inherit;">По умолчанию это « </font></font><code>-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">».</font></font></li>

</ul>



<p>
</p><hr><h3><a name="pdf-package.cpath"><code>модули.cpath</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Путь, используемый </font></font><a href="#pdf-require"><code>require</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для поиска загрузчика Си.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua инициализирует путь C так </font></font><a href="#pdf-package.cpath"><code>модули.cpath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">же, как он инициализирует путь Lua </font></font><a href="#pdf-package.path"><code>модули.path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, используя переменную среды </font></font><a name="pdf-LUA_CPATH_5_3"><code>LUA_CPATH_5_3</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, или переменную среды </font></font><a name="pdf-LUA_CPATH"><code>LUA_CPATH</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, или путь по умолчанию, определенный в </font></font><code>luaconf.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-package.loaded"><code>модули.loaded</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Таблица, используемая </font></font><a href="#pdf-require"><code>require</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для управления тем, какие модули уже загружены. </font><font style="vertical-align: inherit;">Когда вам требуется модуль </font></font><code>modname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и
 </font></font><code>модули.loaded[modname]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не ложь,
 </font></font><a href="#pdf-require"><code>require</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">просто возвращает значение, хранящееся там.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта переменная является только ссылкой на реальную таблицу; </font><font style="vertical-align: inherit;">присвоения этой переменной не изменяют таблицу, используемую </font></font><a href="#pdf-require"><code>require</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-package.loadlib"><code>модули.загрузить (libname, funcname)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Динамически связывает программу хоста с библиотекой C </font></font><code>libname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>funcname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это " </font></font><code>*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">", то он только связывается с библиотекой, делая символы, экспортируемые библиотекой, доступными для других динамически связанных библиотек. </font><font style="vertical-align: inherit;">В противном случае он ищет функцию </font></font><code>funcname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">внутри библиотеки и возвращает эту функцию как функцию C. </font><font style="vertical-align: inherit;">Итак, </font></font><code>funcname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должны следовать </font></font><a href="#lua_CFunction"><code>lua_CFunction</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">прототипу (см. </font></font><a href="#lua_CFunction"><code>lua_CFunction</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Это функция низкого уровня. </font><font style="vertical-align: inherit;">Он полностью обходит модули и модульную систему. </font><font style="vertical-align: inherit;">В отличие от этого </font></font><a href="#pdf-require"><code>require</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, он не выполняет поиск пути и не добавляет автоматически расширения.
</font></font><code>libname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должно быть полное имя файла библиотеки C, включая, если необходимо, путь и расширение.
</font></font><code>funcname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должно быть точным именем, экспортируемым библиотекой C (которая может зависеть от используемого компилятора C и компоновщика).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция не поддерживается стандартом C. Как таковая, она доступна только на некоторых платформах (Windows, Linux, Mac OS X, Solaris, BSD и другие системы Unix, поддерживающие </font></font><code>dlfcn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">стандарт).




</font></font></p><p>
</p><hr><h3><a name="pdf-package.path"><code>модули.path</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Путь, используемый </font></font><a href="#pdf-require"><code>require</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для поиска загрузчика Lua.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
При запуске Lua инициализирует эту переменную значением переменной </font></font><a name="pdf-LUA_PATH_5_3"><code>LUA_PATH_5_3</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">среды </font></font><a name="pdf-LUA_PATH"><code>LUA_PATH</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или </font><font style="vertical-align: inherit;">переменной среды </font><font style="vertical-align: inherit;">или путем, заданным в пути по умолчанию </font></font><code>luaconf.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, если эти переменные среды не определены. </font><font style="vertical-align: inherit;">Любое " </font></font><code>;;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" в значении переменной среды заменяется путем по умолчанию.




</font></font></p><p>
</p><hr><h3><a name="pdf-package.preload"><code>модули.preload</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Таблица для хранения загрузчиков для определенных модулей (см. </font></font><a href="#pdf-require"><code>require</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта переменная является только ссылкой на реальную таблицу; </font><font style="vertical-align: inherit;">присвоения этой переменной не изменяют таблицу, используемую </font></font><a href="#pdf-require"><code>require</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-package.searchers"><code>модули.searchers</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Таблица, используемая </font></font><a href="#pdf-require"><code>require</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для управления тем, как загружать модули.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Каждая запись в этой таблице является </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функцией поиска</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">При поиске модуля
 </font></font><a href="#pdf-require"><code>require</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">вызывается каждый из этих искателей в порядке возрастания, причем его имя (аргумент, заданный </font></font><a href="#pdf-require"><code>require</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) является единственным параметром. </font><font style="vertical-align: inherit;">Функция может возвращать другую функцию ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">загрузчик</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> модуля </font><font style="vertical-align: inherit;">) плюс дополнительное значение, которое будет передано этому загрузчику, или строку, объясняющую, почему она не нашла этот модуль (или </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> если ей нечего сказать).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lua инициализирует эту таблицу четырьмя поисковыми функциями.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Первый поисковик просто ищет загрузчик в
 </font></font><a href="#pdf-package.preload"><code>модули.preload</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">таблице.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Второй поисковик ищет загрузчик как библиотеку Lua, используя путь, сохраненный в </font></font><a href="#pdf-package.path"><code>модули.path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Поиск осуществляется как описано в функции </font></font><a href="#pdf-package.searchpath"><code>модули.найтипуть</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Третий поисковик ищет загрузчик как библиотеку C, используя путь, заданный переменной </font></font><a href="#pdf-package.cpath"><code>модули.cpath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Опять же, поиск выполняется, как описано в функции </font></font><a href="#pdf-package.searchpath"><code>модули.найтипуть</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Например, если путь C является строкой

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     "./?.So;./?.dll;/usr/local/?/init.so"
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
искатель для модуля </font></font><code>foo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
попытается открыть файлы </font></font><code>./foo.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>./foo.dll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>/usr/local/foo/init.so</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, в таком порядке. </font><font style="vertical-align: inherit;">Как только он находит библиотеку C, этот поисковик сначала использует средство динамической связи, чтобы связать приложение с библиотекой. </font><font style="vertical-align: inherit;">Затем он пытается найти функцию C внутри библиотеки, которая будет использоваться в качестве загрузчика. </font><font style="vertical-align: inherit;">Имя этой функции C - строка " </font></font><code>luaopen_</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">", объединенная с копией имени модуля, где каждая точка заменена подчеркиванием. </font><font style="vertical-align: inherit;">Более того, если имя модуля имеет дефис, его суффикс после (и включая) первого дефиса удаляется. </font><font style="vertical-align: inherit;">Например, если имя модуля - имя </font></font><code>a.b.c-v2.1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функции </font></font><code>luaopen_a_b_c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Четвертый поисковик пробует </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">загрузчик «все в одном»</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Он ищет путь C для библиотеки для корневого имени данного модуля. </font><font style="vertical-align: inherit;">Например, когда требуется </font></font><code>a.b.c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, он будет искать библиотеку C для </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если он найден, он ищет в нем функцию открытия подмодуля; </font><font style="vertical-align: inherit;">в нашем примере это было бы </font></font><code>luaopen_a_b_c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">С помощью этой функции модули могут упаковать несколько подмодулей C в одну библиотеку, при этом каждый подмодуль сохраняет свою первоначальную открытую функцию.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Все поисковики, кроме первого (preload), возвращают в качестве дополнительного значения имя файла, в котором был найден модуль, как было возвращено </font></font><a href="#pdf-package.searchpath"><code>модули.найтипуть</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Первый поисковик не возвращает никакого дополнительного значения.




</font></font></p><p>
</p><hr><h3><a name="pdf-package.searchpath"><code>модули.найтипуть (name, path [, sep [, rep]])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ищет данные </font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в данном </font></font><code>path</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Путь - это строка, содержащая последовательность
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">шаблонов,</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> разделенных точкой с запятой. </font><font style="vertical-align: inherit;">Для каждого шаблона функция заменяет каждую метку запроса (если таковая имеется) в шаблоне на копию, в </font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
которой все вхождения </font></font><code>sep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(точка по умолчанию) была заменена на </font></font><code>rep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(разделитель каталогов системы по умолчанию), а затем пытается открыть результирующее имя файла.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Например, если путь является строкой

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     "./?.Lua;./?.lc;/usr/local/?/init.lua"
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
поиск имени </font></font><code>foo.a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
попытается открыть файлы
 </font></font><code>./foo/a.lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>./foo/a.lc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и
 </font></font><code>/usr/local/foo/a/init.lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, в таком порядке.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает результирующее имя первого файла, который он может открыть в режиме чтения (после закрытия файла), или </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> плюс сообщение ощибка, если ни один из них не удался. </font><font style="vertical-align: inherit;">(Это сообщение ощибка перечисляет все имена файлов, которые он пытался открыть.)







</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4 - </font></font><a name="6.4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Манипулирование строками</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта библиотека предоставляет универсальные функции для работы со строками, такие как поиск и извлечение подстрок и сопоставление с образцом. </font><font style="vertical-align: inherit;">При индексации строки в Lua первый символ находится в позиции 1 (а не в 0, как в C). </font><font style="vertical-align: inherit;">Индексы могут быть отрицательными и интерпретируются как индексирование в обратном направлении, начиная с конца строки. </font><font style="vertical-align: inherit;">Таким образом, последний символ находится в позиции -1 и так далее.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Библиотека строк предоставляет все свои функции внутри таблицы
 </font></font><a name="pdf-string"><code>строка</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Он также устанавливает метатаблицу для строк, где </font></font><code>__index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">поле указывает на </font></font><code>строка</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">таблицу. </font><font style="vertical-align: inherit;">Поэтому вы можете использовать функции строки в объектно-ориентированном стиле. </font><font style="vertical-align: inherit;">Например, </font></font><code>строка.байт(s,i)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
можно записать как </font></font><code>s:byte(i)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Библиотека строк предполагает однобайтовую кодировку символов.


</font></font></p><p>
</p><hr><h3><a name="pdf-string.byte"><code>строка.байт (s [, i [, j]])</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает внутренние цифровые коды символов </font></font><code>s[i]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><code>s[i+1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ..., </font></font><code>s[j]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Значение по умолчанию для </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1; </font><font style="vertical-align: inherit;">значение по умолчанию для </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is&nbsp; </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Эти показатели корректируются по тем же правилам функционирования </font></font><a href="#pdf-string.sub"><code>строка.подстр</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Числовые коды не обязательно переносимы между платформами.




</font></font></p><p>
</p><hr><h3><a name="pdf-string.char"><code>строка.симв (···)</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Получает ноль или более целых чисел. </font><font style="vertical-align: inherit;">Возвращает строку с длиной, равной количеству аргументов, в которой каждый символ имеет внутренний числовой код, равный соответствующему аргументу.


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Числовые коды не обязательно переносимы между платформами.




</font></font></p><p>
</p><hr><h3><a name="pdf-string.dump"><code>строка.дамп (function [, strip])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает строку, содержащую двоичное представление ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">двоичный фрагмент</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) данной функции, так что позже </font></font><a href="#pdf-load"><code>загрузить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">эта строка возвращает копию функции (но с новыми значениями вверх). </font><font style="vertical-align: inherit;">Если </font></font><code>strip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это истинное значение, двоичное представление может не включать всю отладку информации о функции, чтобы сэкономить место.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Для функций с повышенными значениями сохраняется только их количество повышенных значений. </font><font style="vertical-align: inherit;">Когда (пере) загружены, эти upvalues ​​получают новые экземпляры, содержащие </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">(Вы можете использовать библиотеку отладка для сериализации и перезагрузки значений функции в соответствии с вашими потребностями.)




</font></font></p><p>
</p><hr><h3><a name="pdf-string.find"><code>строка.найти (s, pattern [, init [, plain]])</code></a></h3>


<p><font style="vertical-align: inherit;"><a href="#6.4.1"><font style="vertical-align: inherit;">Ищет</font></a><font style="vertical-align: inherit;"> 
первое совпадение
 </font></font><code>pattern</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(см. </font></font><a href="#6.4.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.4.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) в </font><a href="#6.4.1"><font style="vertical-align: inherit;">строке</font></a></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Если он находит совпадение, то </font></font><code>find</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает индексы того,&nbsp; </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
где это вхождение начинается и заканчивается; </font><font style="vertical-align: inherit;">в противном случае возвращается </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Третий необязательный числовой аргумент </font></font><code>init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">указывает, где начать поиск; </font><font style="vertical-align: inherit;">его значение по умолчанию равно 1 и может быть отрицательным. </font><font style="vertical-align: inherit;">Значение </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> в качестве четвертого необязательного аргумента </font></font><code>plain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
отключает средства сопоставления с образцом, поэтому функция выполняет простую операцию «найти подстроку», при этом символы </font></font><code>pattern</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не считаются магическими. </font><font style="vertical-align: inherit;">Обратите внимание, что если </font></font><code>plain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">дано, то </font></font><code>init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должно быть дано также.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если в шаблоне есть захваты, то при успешном совпадении захваченные значения также возвращаются после двух индексов.




</font></font></p><p>
</p><hr><h3><a name="pdf-string.format"><code>строка.формат (formatstring, ···)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает отформатированную версию своего переменного числа аргументов в соответствии с описанием, приведенным в первом аргументе (который должен быть строкой). </font><font style="vertical-align: inherit;">Формат строка следует тем же правилам, что и </font><font style="vertical-align: inherit;">функции ISO C </font></font><code>sprintf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Единственное отличие заключается в </font><font style="vertical-align: inherit;">том , </font><font style="vertical-align: inherit;">что опции / модификаторы
 </font></font><code>*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>L</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, и </font></font><code>p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не поддерживается , </font><font style="vertical-align: inherit;">и что есть дополнительный вариант, </font></font><code>q</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"></font><code>q</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Вариант форматирует строку между двойными кавычками, используя управляющие последовательностями , </font><font style="vertical-align: inherit;">когда это </font><font style="vertical-align: inherit;">необходимо для того , </font><font style="vertical-align: inherit;">чтобы его можно безопасно прочитать обратно интерпретатор Lua. </font><font style="vertical-align: inherit;">Например, вызов

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     строка.формат ('% q', 'строка с "кавычками" и \ n новой строкой ")
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
может произвести строку:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     "строка с \" кавычками \ "и \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      новая линия"</font></font><font></font>
</pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Функции
 </font></font><code>A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>E</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><code>G</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, и </font></font><code>g</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">все ожидают число как аргумент. </font><font style="vertical-align: inherit;">Функции </font></font><code>c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>o</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>u</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, и </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ожидать целое. </font><font style="vertical-align: inherit;">Когда Lua компилируется с помощью компилятора C89, параметры </font></font><code>A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(шестнадцатеричные числа с плавающей запятой) не поддерживают какой-либо модификатор (флаги, ширина, длина).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Опция </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ожидает строку; </font><font style="vertical-align: inherit;">если его аргумент не является строкой, он конвертируется в один по тем же правилам </font></font><a href="#pdf-tostring"><code>строковой</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если параметр имеет какой-либо модификатор (флаги, ширина, длина), аргумент строки не должен содержать встроенных нулей.




</font></font></p><p>
</p><hr><h3><a name="pdf-string.gmatch"><code>строка.иразбор (s, pattern)</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает функцию итератора, которая при каждом вызове возвращает следующие записи из </font></font><code>pattern</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(см. </font></font><a href="#6.4.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.4.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) по </font><a href="#6.4.1"><font style="vertical-align: inherit;">строке</font></a></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Если не </font></font><code>pattern</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">указан захват, то при каждом вызове создается полное совпадение.


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Например, следующий цикл будет повторять все слова из </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">строки, печатая по одному в строке:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     s = "Привет, мир от Lua"</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     для w в строке.иразбор (s, "% a +") do</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       печать (ж)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     конец</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Следующий пример собирает все пар </font></font><code>key=value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">из данной строки в таблицу:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     т = {}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     s = "from = world, to = Lua"</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     для k, v в строке.иразбор (s, "(% w +) = (% w +)") do</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       t [k] = v</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     конец</font></font><font></font>
</pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Для этой функции каретка ' </font></font><code>^</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' в начале шаблона не работает как якорь, поскольку это предотвратит итерацию.




</font></font></p><p>
</p><hr><h3><a name="pdf-string.gsub"><code>строка.заменить (s, pattern, repl [, n])</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает копию, </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
в которой все (или первые </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, если даны) экземпляры </font></font><code>pattern</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(см. </font></font><a href="#6.4.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.4.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) были заменены указанной </font><a href="#6.4.1"><font style="vertical-align: inherit;">строкой</font></a><font style="vertical-align: inherit;"> замены </font></font><code>repl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, которая может быть строкой, таблицей или функцией.
</font></font><code>gsub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">также возвращает в качестве второго значения общее количество совпадений. </font><font style="vertical-align: inherit;">Название </font></font><code>gsub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">происходит от </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Global SUBstitution</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>repl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это строка, то ее значение используется для замены. </font><font style="vertical-align: inherit;">Символ&nbsp; </font></font><code>%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">работает как escape-символ: любая последовательность в </font></font><code>repl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">форме </font><font style="vertical-align: inherit;">с </font><em><font style="vertical-align: inherit;">d</font></em><font style="vertical-align: inherit;"> между 1 и 9 обозначает значение </font><em><font style="vertical-align: inherit;">d-й</font></em><font style="vertical-align: inherit;"> захваченной подстроки. </font><font style="vertical-align: inherit;">Последовательность </font><font style="vertical-align: inherit;">обозначает весь матч. </font><font style="vertical-align: inherit;">Последовательность </font><font style="vertical-align: inherit;">обозначает один&nbsp; </font><font style="vertical-align: inherit;">.


</font></font><code>%<em>d</em></code><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><code>%0</code><font style="vertical-align: inherit;"></font><code>%%</code><font style="vertical-align: inherit;"></font><code>%</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>repl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это таблица, то таблица запрашивается для каждого совпадения, используя первый захват в качестве ключа.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>repl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это функция, то эта функция вызывается каждый раз, когда происходит совпадение, когда все захваченные подстроки передаются в качестве аргументов по порядку.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В любом случае, если шаблон не определяет захват, он ведет себя так, как если бы весь шаблон был внутри захвата.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если значение, возвращаемое запросом таблицы или вызовом функции, является строкой или числом, то оно используется в качестве строки замены; </font><font style="vertical-align: inherit;">в противном случае, если оно равно </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> или </font><font style="vertical-align: inherit;">равно </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , замена отсутствует (то есть исходное совпадение сохраняется в строке).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вот некоторые примеры:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     x = строка.заменить ("hello world", "(% w +)", "% 1% 1")</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     -&gt; x = "Привет, мир, привет!"</font></font><font></font>
     <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     x = строка.заменить ("hello world", "% w +", "% 0% 0", 1)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     -&gt; x = "Привет, мир!"</font></font><font></font>
     <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     x = строка.заменить ("Привет, мир из Lua", "(% w +)% s * (% w +)", "% 2% 1")</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     -&gt; x = "Мир привет Луа из"</font></font><font></font>
     <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     x = строка.заменить ("home = $ HOME, user = $ USER", "% $ (% w +)", ос.getenv)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     -&gt; x = "home = / home / roberto, user = roberto"</font></font><font></font>
     <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     x = строка.заменить ("4 + 5 = $ return 4 + 5 $", "% $ (.-)% $", функция (ы)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           возврат загрузить (s) ()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         конец)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     -&gt; х = "4 + 5 = 9"</font></font><font></font>
     <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     local t = {name = "lua", version = "5.3"}</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     x = строка.заменить ("$ name- $ version.tar.gz", "% $ (% w +)", t)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     -&gt; x = "lua-5.3.tar.gz"</font></font><font></font>
</pre>



<p>
</p><hr><h3><a name="pdf-string.len"><code>строка.длина (s)</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Получает строку и возвращает ее длину. </font><font style="vertical-align: inherit;">Пустая строка </font></font><code>""</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">имеет длину 0. Подсчитываются встроенные нули, поэтому </font></font><code>"a\000bc\000"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">имеет длину 5.




</font></font><p>
</p><hr><h3><a name="pdf-string.lower"><code>строка.прописные (s)</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Получает строку и возвращает копию этой строки со всеми заглавными буквами, измененными на строчные. </font><font style="vertical-align: inherit;">Все остальные символы остаются без изменений. </font><font style="vertical-align: inherit;">Определение заглавной буквы зависит от текущей локали.




</font></font><p>
</p><hr><h3><a name="pdf-string.match"><code>строка.разбор (s, pattern [, init])</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Похоже на первый </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">матч</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> с
 </font></font><code>pattern</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(см </font></font><a href="#6.4.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.4.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) в строка </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если он находит, то </font></font><code>match</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает захваты из шаблона; </font><font style="vertical-align: inherit;">в противном случае возвращается </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Если </font></font><code>pattern</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">указано отсутствие захвата, то возвращается все совпадение. </font><font style="vertical-align: inherit;">Третий необязательный числовой аргумент </font></font><code>init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">указывает, где начать поиск; </font><font style="vertical-align: inherit;">его значение по умолчанию равно 1 и может быть отрицательным.




</font></font><p>
</p><hr><h3><a name="pdf-string.pack"><code>строка.упаковать (fmt, v1, v2, ···)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает двоичную строку , </font><font style="vertical-align: inherit;">содержащее значение </font></font><code>v1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>v2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и т.д. упакованы (то есть, по </font><font style="vertical-align: inherit;">частям в двоичной форме) в </font><font style="vertical-align: inherit;">соответствии с форматом строка </font></font><code>fmt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(см </font></font><a href="#6.4.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.4.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).




</font></font></p><p>
</p><hr><h3><a name="pdf-string.packsize"><code>строка.длинапак (fmt)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает размер строки, полученной </font></font><a href="#pdf-string.pack"><code>строка.упаковать</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
в указанном формате. </font><font style="vertical-align: inherit;">Строка формата не может иметь параметры переменной длины ' </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' или ' </font></font><code>z</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (см. </font></font><a href="#6.4.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.4.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).




</font></font></p><p>
</p><hr><h3><a name="pdf-string.rep"><code>строка.повторить (s, n [, sep])</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает строку, которая является объединением </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">копий строки, </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">разделенных строкой </font></font><code>sep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Значением по умолчанию для </font></font><code>sep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является пустая строка (то есть без разделителя). </font><font style="vertical-align: inherit;">Возвращает пустую строку, если </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не является положительным.


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Обратите внимание, что очень просто исчерпать память вашей машины с помощью одного вызова этой функции.)




</font></font></p><p>
</p><hr><h3><a name="pdf-string.reverse"><code>строка.перевернуть (s)</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает строку, которая является </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">обратной </font><font style="vertical-align: inherit;">строкой </font><font style="vertical-align: inherit;">.




</font></font><p>
</p><hr><h3><a name="pdf-string.sub"><code>строка.подстр (s, i [, j])</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает подстроку, </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">которая начинается с </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  и продолжается до </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;
</font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">может быть отрицательным. </font><font style="vertical-align: inherit;">Если </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">отсутствует, то предполагается, что он равен -1 (что равно длине строки). </font><font style="vertical-align: inherit;">В частности, вызов </font></font><code>строка.подстр(s,1,j)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает префикс </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
с длиной </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, а </font></font><code>строка.подстр(s, -i)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(для положительного </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) возвращает суффикс </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
с длиной </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если после перевода отрицательных индексов значение
 </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">меньше 1, оно исправляется на 1. Если </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">оно больше длины строки, оно исправляется на эту длину. </font><font style="vertical-align: inherit;">Если после этих исправлений значение
 </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">больше, чем </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, функция возвращает пустую строку.




</font></font></p><p>
</p><hr><h3><a name="pdf-string.unpack"><code>строка.распаковать (fmt, s [, pos])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает значения, упакованные в строку </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(см. </font></font><a href="#pdf-string.pack"><code>строка.упаковать</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) В соответствии с форматом строки </font></font><code>fmt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(см. </font></font><a href="#6.4.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.4.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Необязательные </font></font><code>pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">отметки, с которых начинается чтение </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(по умолчанию 1). </font><font style="vertical-align: inherit;">После считанных значений эта функция также возвращает индекс первого непрочитанного байта в </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-string.upper"><code>строка.строчные (s)</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Получает строку и возвращает копию этой строки со всеми строчными буквами, замененными на прописные. </font><font style="vertical-align: inherit;">Все остальные символы остаются без изменений. </font><font style="vertical-align: inherit;">Определение строчной буквы зависит от текущей локали.





</font></font><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.1 - </font></font><a name="6.4.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Шаблоны</font></font></a></h3>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Шаблоны в Lua описывается регулярными последовательностями, которые интерпретируются как шаблоны функций сопоставления с </font><font style="vertical-align: inherit;">образцом
 </font></font><a href="#pdf-string.find"><code>строка.найти</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a href="#pdf-string.gmatch"><code>строка.иразбор</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a href="#pdf-string.gsub"><code>строка.заменить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, и </font></font><a href="#pdf-string.match"><code>строка.разбор</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">В этом разделе описывается синтаксис и значение (то есть, что они соответствуют) этих строк.



</font></font></p><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Класс персонажа:</font></font></h4><p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Класс символов</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> используется для представления набора символов. </font><font style="vertical-align: inherit;">Следующие комбинации допускаются при описании класса символов:

</font></font></p><ul>

<li><b><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
(где</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> x</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> не является одним из</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> магических символов</font></font></em>
<code>^$()%.[]*+-?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) представляет сам символ</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> x</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .
</font></font></li>

<li><b><code>.</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (точка) представляет все символы.</font></font></li>

<li><b><code>%a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет все буквы.</font></font></li>

<li><b><code>%c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет все управляющие символы.</font></font></li>

<li><b><code>%d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет все цифры.</font></font></li>

<li><b><code>%g</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет все печатные символы, кроме пробела.</font></font></li>

<li><b><code>%l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет все строчные буквы.</font></font></li>

<li><b><code>%p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет все знаки препинания.</font></font></li>

<li><b><code>%s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет все пробелы.</font></font></li>

<li><b><code>%u</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет все заглавные буквы.</font></font></li>

<li><b><code>%w</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет все буквенно-цифровые символы.</font></font></li>

<li><b><code>%x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет все шестнадцатеричные цифры.</font></font></li>

<li><b><code>%<em>x</em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (где </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - любой не алфавитно-цифровой символ) представляет символ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Это стандартный способ избежать магических персонажей. </font><font style="vertical-align: inherit;">Любому не алфавитно-цифровому символу (включая все знаки пунктуации, даже немагическому) может предшествовать « </font></font><code>%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">», когда он используется для представления себя в шаблоне.
</font></font></li>

<li><b><code>[<em>set</em>]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
представляет класс, который является объединением всех символов в </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">наборе</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Диапазон символов можно указать, разделяя конечные символы диапазона в порядке возрастания символом ' </font></font><code>-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'. </font><font style="vertical-align: inherit;">Все классы </font></font><code>%</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x,</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> описанные выше, также могут использоваться в качестве компонентов в </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">наборе</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Все остальные персонажи в </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">наборе</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляют себя. </font><font style="vertical-align: inherit;">Например, </font></font><code>[%w_]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(или </font></font><code>[_%w]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) представляет все буквенно-цифровые символы плюс знак подчеркивания,
 </font></font><code>[0-7]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">представляет восьмеричные цифры и </font></font><code>[0-7%l%-]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">представляет восьмеричные цифры плюс строчные буквы плюс </font></font><code>-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">символ «».


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вы можете поместить закрывающую квадратную скобку в набор, поместив ее в качестве первого символа в наборе. </font><font style="vertical-align: inherit;">Вы можете поместить дефис в набор, поместив его в качестве первого или последнего символа в наборе. </font><font style="vertical-align: inherit;">(Вы также можете использовать escape для обоих случаев.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Взаимодействие между диапазонами и классами не определено. </font><font style="vertical-align: inherit;">Следовательно, шаблоны любят </font></font><code>[%a-z]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или не </font></font><code>[a-%%]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
имеют смысла.
</font></font></p></li>

<li><b><code>[^<em>set</em>]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
представляет собой дополнение </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">множества</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , где </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">множество</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> интерпретируется как указано выше.
</font></font></li>

</ul><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Для всех классов, представленных одинарными буквами ( </font></font><code>%a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>%c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и т. Д.), Соответствующая заглавная буква представляет дополнение класса. </font><font style="vertical-align: inherit;">Например, </font></font><code>%S</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">представляет все непробельные символы.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Определения букв, пробелов и других групп символов зависят от текущей локали. </font><font style="vertical-align: inherit;">В частности, класс </font></font><code>[a-z]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">может быть не эквивалентен </font></font><code>%l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.





</font></font></p><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Пункт шаблона:</font></font></h4><p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Элемент модели</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> может быть

</font></font></p><ul>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
один символьный класс, который соответствует любому отдельному символу в классе;
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
один символьный класс, за которым следует ' </font></font><code>*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">', что соответствует нулю или более повторений символов в классе. </font><font style="vertical-align: inherit;">Эти повторяющиеся элементы всегда будут соответствовать самой длинной последовательности;
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
один символьный класс, за которым следует ' </font></font><code>+</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">', что соответствует одному или нескольким повторениям символов в классе. </font><font style="vertical-align: inherit;">Эти повторяющиеся элементы всегда будут соответствовать самой длинной последовательности;
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
один символьный класс, за которым следует ' </font></font><code>-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">', что также соответствует нулю или более повторений символов в классе. </font><font style="vertical-align: inherit;">В отличие от ' </font></font><code>*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">', эти элементы повторения всегда будут соответствовать кратчайшей возможной последовательности;
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
один символьный класс, за которым следует ' </font></font><code>?</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">', что соответствует нулю или одному вхождению символа в классе. </font><font style="vertical-align: inherit;">Это всегда соответствует одному вхождению, если это возможно;
</font></font></li>

<li>
<code>%<em>n</em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> от 1 до 9; </font><font style="vertical-align: inherit;">такой элемент соответствует подстроке, равной </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n-й</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> захваченной строке (см. ниже);
</font></font></li>

<li>
<code>%b<em>xy</em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">где </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - два разных символа; </font><font style="vertical-align: inherit;">Такой элемент соответствует строкам , </font><font style="vertical-align: inherit;">которые начинаются с&nbsp; </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">й</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , с концом&nbsp; </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">у</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , и где </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">х</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">у</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> являются </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">сбалансированными</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Это означает, что, если кто-то читает строку слева направо, считая </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+1</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> для </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> и </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-1</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> для </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , окончание </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> является первым </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y,</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> где количество достигает 0. Например, элемент </font></font><code>%b()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">сопоставляет выражения со сбалансированными скобками ,
</font></font></li>

<li>
<code>%f[<em>set</em>]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, А </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">граница модель</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">такой элемент соответствует пустой строке в любой позиции, так что следующий символ принадлежит </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">множеству,</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
а предыдущий символ не принадлежит </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">множеству</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Набор </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">набор</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> интерпретируется как описано выше. </font><font style="vertical-align: inherit;">Начало и конец предмета обрабатываются так, как если бы они были персонажем ' </font></font><code>\0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'.
</font></font></li>

</ul>




<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Шаблон:</font></font></h4><p><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Шаблон</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> представляет собой последовательность элементов образца. </font><font style="vertical-align: inherit;">Каретка ' </font></font><code>^</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' в начале шаблона закрепляет совпадение в начале строки темы. </font><font style="vertical-align: inherit;">A ' </font></font><code>$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' в конце шаблона закрепляет совпадение в конце строки темы. </font><font style="vertical-align: inherit;">На других позициях « </font></font><code>^</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">» и « </font></font><code>$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">» не имеют особого значения и представляют себя.





</font></font></p><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Захватывает:</font></font></h4><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Шаблон может содержать вложенные шаблоны в круглых скобках; </font><font style="vertical-align: inherit;">они описывают </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">захваты</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">При успешном совпадении подстроки предметной строки, которые соответствуют захватам, сохраняются ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">фиксируются</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) для будущего использования. </font><font style="vertical-align: inherit;">Захваты нумеруются в соответствии с их левыми скобками. </font><font style="vertical-align: inherit;">Например, в шаблоне </font></font><code>"(a*(.)%w(%s*))"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">часть соответствия строк </font></font><code>"a*(.)%w(%s*)"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">сохраняется как первый захват (и поэтому имеет номер 1); </font><font style="vertical-align: inherit;">совпадение символов " </font></font><code>.</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" фиксируется номером 2, а совпадение частей " </font></font><code>%s*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" имеет номер 3.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Как особый случай, пустой захват </font></font><code>()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">захватывает текущую позицию строки (число). </font><font style="vertical-align: inherit;">Например, если мы применим шаблон </font></font><code>"()aa()"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">к строке </font></font><code>"flaaap"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, будет два захвата: 3 и 5.







</font></font></p><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4.2 - </font></font><a name="6.4.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Форматирование строк для упаковки и распаковки</font></font></a></h3>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Первым аргументом для </font></font><a href="#pdf-string.pack"><code>строка.упаковать</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a href="#pdf-string.packsize"><code>строка.длинапак</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><a href="#pdf-string.unpack"><code>строка.распаковать</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
является строка формата, которая описывает макет создаваемой или читаемой структуры.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Строка формата - это последовательность параметров преобразования. </font><font style="vertical-align: inherit;">Варианты преобразования следующие:

</font></font></p><ul>
<li><b><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> устанавливает порядок байтов</font></font></li>
<li><b><code>&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> устанавливает порядковый номер</font></font></li>
<li><b><code>=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> устанавливает родной порядок байтов</font></font></li>
<li><b><code>![<em>n</em>]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> устанавливает максимальное выравнивание </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(по умолчанию - собственное выравнивание)</font></font></li>
<li><b><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> подписанный байт ( </font></font><code>char</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> неподписанный байт ( </font></font><code>char</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><code>h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> подписанный </font></font><code>short</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(родной размер)</font></font></li>
<li><b><code>H</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> без знака </font></font><code>short</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(родной размер)</font></font></li>
<li><b><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> подписанный </font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(родной размер)</font></font></li>
<li><b><code>L</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> без знака </font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(родной размер)</font></font></li>
<li><b><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>lua_Integer</code></li>
<li><b><code>J</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>lua_Unsigned</code></li>
<li><b><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>size_t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Родной размер)</font></font></li>
<li><b><code>i[<em>n</em>]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Подписанный </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">с </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">байтами ( по </font><font style="vertical-align: inherit;">умолчанию является родным размером)</font></font></li>
<li><b><code>I[<em>n</em>]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> без знака </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">с </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">байтами (по умолчанию - собственный размер)</font></font></li>
<li><b><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Родной размер)</font></font></li>
<li><b><code>d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>double</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Родной размер)</font></font></li>
<li><b><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"></font><code>lua_Number</code></li>
<li><b><code>c<em>n</em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> строка фиксированного размера с </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">байтами</font></font></li>
<li><b><code>z</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> строка с нулевым символом в конце</font></font></li>
<li><b><code>s[<em>n</em>]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> строка, которой предшествует длина, закодированная как целое число без знака с </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">байтами (по умолчанию - a </font></font><code>size_t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><b><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> один байт заполнения</font></font></li>
<li><b><code>X<em>op</em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> пустой элемент, который выравнивается в соответствии с параметром </font></font><code>op</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(который в противном случае игнорируется)</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' </font></font><code> </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">':</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (пустое место) игнорируется</font></font></li>
</ul><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(« </font><font style="vertical-align: inherit;">» Означает необязательную целую цифру.) За исключением отступов, пробелов и конфигураций (опции « </font><font style="vertical-align: inherit;">»), каждая опция соответствует аргументу (in </font><font style="vertical-align: inherit;">) или результату (in </font><font style="vertical-align: inherit;">).


</font></font><code>[<em>n</em>]</code><font style="vertical-align: inherit;"></font><code>xX &lt;=&gt;!</code><font style="vertical-align: inherit;"></font><a href="#pdf-string.pack"><code>строка.упаковать</code></a><font style="vertical-align: inherit;"></font><a href="#pdf-string.unpack"><code>строка.распаковать</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Для параметров " </font><font style="vertical-align: inherit;">", " </font><font style="vertical-align: inherit;">", " </font><font style="vertical-align: inherit;">" и " </font><font style="vertical-align: inherit;">"
 </font><font style="vertical-align: inherit;">может быть любое целое число от 1 до 16. Все встроенные параметры проверяют переполнения;
</font><font style="vertical-align: inherit;">проверяет, соответствует ли данное значение указанному размеру;
</font><font style="vertical-align: inherit;">проверяет, соответствует ли значение чтения целому числу Lua.


</font></font><code>!<em>n</em></code><font style="vertical-align: inherit;"></font><code>s<em>n</em></code><font style="vertical-align: inherit;"></font><code>i<em>n</em></code><font style="vertical-align: inherit;"></font><code>I<em>n</em></code><font style="vertical-align: inherit;"></font><code>n</code><font style="vertical-align: inherit;"></font><a href="#pdf-string.pack"><code>строка.упаковать</code></a><font style="vertical-align: inherit;"></font><a href="#pdf-string.unpack"><code>строка.распаковать</code></a><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Любая строка формата начинается с префикса " </font></font><code>!1=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">", то есть с максимальным выравниванием 1 (без выравнивания) и собственным порядком байтов.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Выравнивание работает следующим образом: для каждого параметра формат получает дополнительное заполнение до тех пор, пока данные не начнут со смещения, кратного минимальному значению между размером параметра и максимальным выравниванием; </font><font style="vertical-align: inherit;">этот минимум должен быть степенью 2. Опции " </font></font><code>c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" и " </font></font><code>z</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" не выровнены; </font><font style="vertical-align: inherit;">опция " </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" следует за выравниванием его начального целого числа.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Все отступы заполнены нулями </font></font><a href="#pdf-string.pack"><code>строка.упаковать</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(и игнорируются </font></font><a href="#pdf-string.unpack"><code>строка.распаковать</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).







</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.5 - </font></font><a name="6.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Поддержка UTF-8</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта библиотека обеспечивает базовую поддержку кодировки UTF-8. </font><font style="vertical-align: inherit;">Он предоставляет все свои функции внутри таблицы </font></font><a name="pdf-utf8"><code>юникод</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Эта библиотека не предоставляет никакой поддержки Unicode, кроме обработки кодировки. </font><font style="vertical-align: inherit;">Любая операция, которая нуждается в значении символа, такая как классификация символов, выходит за рамки ее действия.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если не указано иное, все функции, которые ожидают позицию байта в качестве параметра, предполагают, что данная позиция является либо началом последовательности байтов, либо единицей плюс длина строки объекта. </font><font style="vertical-align: inherit;">Как и в библиотеке строк, отрицательные индексы отсчитываются с конца строки.


</font></font></p><p>
</p><hr><h3><a name="pdf-utf8.char"><code>юникод.знак (···)</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Получает ноль или более целых чисел, преобразует каждое из них в свою соответствующую последовательность байтов UTF-8 и возвращает строку с объединением всех этих последовательностей.




</font></font><p>
</p><hr><h3><a name="pdf-utf8.charpattern"><code>юникод.charpattern</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Шаблон (строка, а не функция) " </font></font><code>[\0-\x7F\xC2-\xF4][\x80-\xBF]*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" (см. </font></font><a href="#6.4.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§6.4.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), который соответствует ровно одной последовательности байтов UTF-8, предполагая, что субъект является допустимой строкой UTF-8.




</font></font><p>
</p><hr><h3><a name="pdf-utf8.codes"><code>юникод.коды (s)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает значения, чтобы конструкция

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     для p, c в юникод.коды делают </font><font style="vertical-align: inherit;">конец
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">тела</font></font></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
будет выполнять итерацию по всем символам в строке </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">с </font><font style="vertical-align: inherit;">указанием </font></font><code>p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">позиции (в байтах) и </font></font><code>c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">кодовой точки каждого символа. </font><font style="vertical-align: inherit;">Он вызывает ощибку, если встречает какую-либо недопустимую последовательность байтов.




</font></font></p><p>
</p><hr><h3><a name="pdf-utf8.codepoint"><code>юникод.кодпоз (s [, i [, j]])</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает кодовые точки (как целые числа) из всех символов в </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
этом начале между позицией байта </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(оба включены). </font><font style="vertical-align: inherit;">По умолчанию </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является 1 и </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Он вызывает ощибку, если встречает какую-либо недопустимую последовательность байтов.




</font></font><p>
</p><hr><h3><a name="pdf-utf8.len"><code>юникод.длина (s [, i [, j]])</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает количество символов UTF-8 в строке, </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
которые начинаются между позициями </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(оба включительно). </font><font style="vertical-align: inherit;">Значение по умолчанию для </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 и для </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-1. </font><font style="vertical-align: inherit;">Если он находит недопустимую последовательность байтов, возвращает ложное значение плюс позицию первого недопустимого байта.




</font></font><p>
</p><hr><h3><a name="pdf-utf8.offset"><code>юникод.сдвиг (s, n [, i])</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает позицию (в байтах), с которой начинается кодирование
 </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-го символа </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(начиная с позиции </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Негатив </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">получает символы перед позицией </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Значение по умолчанию </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">равно 1, когда </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">неотрицательно и в </font></font><code>#s + 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">противном случае, так что </font></font><code>юникод.сдвиг(s, -n)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">получает смещение-го
 </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">символа в конце строки. </font><font style="vertical-align: inherit;">Если указанный символ не находится ни в теме, ни сразу после его окончания, функция возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В особом случае, когда </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0, функция возвращает начало кодировки символа, содержащего </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-й байт </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция предполагает, что </font></font><code>s</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это допустимая строка UTF-8.







</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.6 - </font></font><a name="6.6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Манипуляция за столом</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта библиотека предоставляет универсальные функции для манипулирования таблицами. </font><font style="vertical-align: inherit;">Он предоставляет все свои функции внутри таблицы </font></font><a name="pdf-table"><code>таблица</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Помните, что всякий раз, когда операции требуется длина </font></font><a href="#3.4.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">таблицы,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> применяются все предостережения относительно оператора длины (см. </font><a href="#3.4.7"><font style="vertical-align: inherit;">§3.4.7</font></a><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Все функции игнорируют нечисловые ключи в таблицах, представленных в качестве аргументов.


</font></font></p><p>
</p><hr><h3><a name="pdf-table.concat"><code>таблица.встроку (list [, sep [, i [, j]]])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Учитывая список, где все элементы являются строками или числами, возвращает строку </font></font><code>list[i]..sep..list[i+1] ··· sep..list[j]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Значением по умолчанию для </font></font><code>sep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является пустая строка, для по умолчанию </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 1, а для </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">по умолчанию </font></font><code>#list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">больше чем </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, возвращает пустую строку.




</font></font></p><p>
</p><hr><h3><a name="pdf-table.insert"><code>таблица.вставить (list, [pos,] value)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вставки элемент </font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в положении , </font></font><code>pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в </font></font><code>list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, сдвигая вверх элементы
 </font></font><code>list[pos], list[pos+1], ···, list[#list]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Значение по умолчанию </font></font><code>pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является </font></font><code>#list+1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, таким образом , </font><font style="vertical-align: inherit;">что вызов </font></font><code>таблица.вставить(t,x)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">вставки </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в конец списка </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-table.move"><code>таблица.переместить (a1, f, e, t [,a2])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Перемещение элементов из таблица , </font></font><code>a1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">чтобы таблица </font></font><code>a2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, выполняя эквивалентна следующему множественное присваивание:
 </font></font><code>a2[t],··· = a1[f],···,a1[e]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">По умолчанию </font></font><code>a2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это </font></font><code>a1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Диапазон назначения может перекрываться с диапазоном источника. </font><font style="vertical-align: inherit;">Количество перемещаемых элементов должно соответствовать целому числу Lua.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает таблицу назначения </font></font><code>a2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-table.pack"><code>таблица.упак (···)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает новую таблицу со всеми параметрами, сохраненными в ключах 1, 2 и т. Д., И с полем " </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" с общим количеством параметров. </font><font style="vertical-align: inherit;">Обратите внимание, что результирующая таблица не может быть последовательностью.




</font></font></p><p>
</p><hr><h3><a name="pdf-table.remove"><code>таблица.удалить (list [, pos])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Удаляет из </font></font><code>list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">элемента в позиции </font></font><code>pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, возвращая значение удаленного элемента. </font><font style="vertical-align: inherit;">Когда </font></font><code>pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">целое число от 1 до </font></font><code>#list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, оно сдвигает элементы вниз
 </font></font><code>list[pos+1], list[pos+2], ···, list[#list]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
и удаляет элемент </font></font><code>list[#list]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">Индекс </font></font><code>pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">также может быть 0, когда </font></font><code>#list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">равен 0, или </font></font><code>#list + 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">в этих случаях функция стирает элемент </font></font><code>list[pos]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Значение по умолчанию </font></font><code>pos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является </font></font><code>#list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, таким образом , </font><font style="vertical-align: inherit;">что вызов </font></font><code>таблица.удалить(l)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">удаляет последний элемент списка </font></font><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-table.sort"><code>таблица.сортировать (list [, comp])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Сортирует элементы списка в указанном порядке, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">по месту</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , от </font></font><code>list[1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">до </font></font><code>list[#list]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если </font></font><code>comp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">задано, то это должна быть функция, которая получает два элемента списка и возвращает истину, когда первый элемент должен предшествовать второму в конечном порядке (так, что после сортировки
 </font></font><code>i &lt; j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">подразумевается </font></font><code>not comp(list[j],list[i])</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Если </font></font><code>comp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не указан, то </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">вместо него используется </font><font style="vertical-align: inherit;">стандартный оператор Lua </font><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Обратите внимание, что </font></font><code>comp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функция должна определять строгий частичный порядок для элементов в списке; </font><font style="vertical-align: inherit;">то есть он должен быть асимметричным и переходным. </font><font style="vertical-align: inherit;">В противном случае, допустимая сортировка невозможна.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Алгоритм сортировки нестабилен: элементы, считающиеся равными в данном порядке, могут иметь относительное положение, измененное сортировкой




</font></font></p><p>
</p><hr><h3><a name="pdf-table.unpack"><code>таблица.распак (list [, i [, j]])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает элементы из указанного списка. </font><font style="vertical-align: inherit;">Эта функция эквивалентна

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     возвратный список [i], список [i + 1], ···, список [j]
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
По умолчанию </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 и </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть </font></font><code>#list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.







</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.7 - </font></font><a name="6.7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Математические функции</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта библиотека предоставляет основные математические функции. </font><font style="vertical-align: inherit;">Он предоставляет все свои функции и константы внутри таблицы </font></font><a name="pdf-math"><code>мат</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Функции с аннотацией " </font></font><code>integer/float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" дают целочисленные результаты для целочисленных аргументов и результаты с плавающей точкой для плавающих (или смешанных) аргументов. </font><font style="vertical-align: inherit;">Округление функция ( </font></font><a href="#pdf-math.ceil"><code>мат.ceil</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a href="#pdf-math.floor"><code>мат.floor</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><a href="#pdf-math.modf"><code>мат.modf</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) возвращает целое число , </font><font style="vertical-align: inherit;">когда результат помещается в диапазоне от целого числа, или поплавка в </font><font style="vertical-align: inherit;">противном случае.


</font></font></p><p>
</p><hr><h3><a name="pdf-math.abs"><code>мат.абс (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает абсолютное значение </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(число / с </font><font style="vertical-align: inherit;">плавающей точкой)




</font></font></p><p>
</p><hr><h3><a name="pdf-math.acos"><code>мат.акос (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает арккосинус </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(в радианах).




</font></font></p><p>
</p><hr><h3><a name="pdf-math.asin"><code>мат.асин (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает арксинус </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(в радианах).




</font></font></p><p>
</p><hr><h3><a name="pdf-math.atan"><code>мат.атан (y [, x])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

Возвращает арктангенс </font></font><code>y/x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(в радианах), но использует знаки обоих параметров, чтобы найти квадрант результата. </font><font style="vertical-align: inherit;">(Это также правильно обрабатывает случай </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нуля.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Значение по умолчанию для </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 равно 1, поэтому вызов </font></font><code>мат.атан(y)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
возвращает арктангенс </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-math.ceil"><code>мат.ceil (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает наименьшее целое значение, большее или равное </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-math.cos"><code>мат.кос (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает косинус </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(предполагается в радианах).




</font></font></p><p>
</p><hr><h3><a name="pdf-math.deg"><code>мат.deg (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразует угол </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">из радианов в градусы.




</font></font></p><p>
</p><hr><h3><a name="pdf-math.exp"><code>мат.експ (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает значение </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></sup></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
(где </font></font><code>e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">основание натуральных логарифмов).




</font></font></p><p>
</p><hr><h3><a name="pdf-math.floor"><code>мат.floor (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает наибольшее целое значение, меньшее или равное </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-math.fmod"><code>мат.fmod (x, y)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает остаток от деления на </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
которое округляет частное к нулю. </font><font style="vertical-align: inherit;">(число / с </font><font style="vertical-align: inherit;">плавающей точкой)




</font></font></p><p>
</p><hr><h3><a name="pdf-math.huge"><code>мат.бескон</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Значение с плавающей запятой </font></font><code>HUGE_VAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, значение больше, чем любое другое числовое значение.




</font></font></p><p>
</p><hr><h3><a name="pdf-math.log"><code>мат.log (x [, base])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает логарифм </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в указанной базе. </font><font style="vertical-align: inherit;">По умолчанию </font></font><code>base</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">е</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
(так , </font><font style="vertical-align: inherit;">что функция возвращает натуральный логарифм </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).




</font></font></p><p>
</p><hr><h3><a name="pdf-math.max"><code>мат.max (x, ···)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает аргумент с максимальным значением согласно оператору Lua </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(число / с </font><font style="vertical-align: inherit;">плавающей точкой)




</font></font></p><p>
</p><hr><h3><a name="pdf-math.maxinteger"><code>мат.наибцел</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Целое число с максимальным значением для целого числа.




</font></font><p>
</p><hr><h3><a name="pdf-math.min"><code>мат.min (x, ···)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает аргумент с минимальным значением согласно оператору Lua </font></font><code>&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(число / с </font><font style="vertical-align: inherit;">плавающей точкой)




</font></font></p><p>
</p><hr><h3><a name="pdf-math.mininteger"><code>мат.наимцел</code></a></h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Целое число с минимальным значением для целого числа.




</font></font><p>
</p><hr><h3><a name="pdf-math.modf"><code>мат.modf (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает неотъемлемую часть </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и дробную часть </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Его второй результат - это всегда число с плавающей точкой.




</font></font></p><p>
</p><hr><h3><a name="pdf-math.pi"><code>мат.пи</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Значение </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">π</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .




</font></font></p><p>
</p><hr><h3><a name="pdf-math.rad"><code>мат.rad (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразует угол </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">из градусов в радианы.




</font></font></p><p>
</p><hr><h3><a name="pdf-math.random"><code>мат.random ([m [, n]])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
При вызове без аргументов возвращает псевдослучайное число с плавающей точкой с равномерным распределением в диапазоне   </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[0,1)</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">При вызове с двумя целыми числами </font></font><code>m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><code>мат.random</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает псевдослучайное число с равномерным распределением в диапазоне </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[м, н]</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">(Значение </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nm</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> не может быть отрицательным и должно вписываться в целое число Lua.) Вызов </font></font><code>мат.random(n)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">эквивалентен </font></font><code>мат.random(1,n)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция является интерфейсом к основной функции генератора псевдослучайных сигналов, предоставляемой C.




</font></font></p><p>
</p><hr><h3><a name="pdf-math.randomseed"><code>мат.randomseed (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Устанавливается </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в качестве «семени» для генератора псевдослучайных чисел: равные начальные числа создают равные последовательности чисел.




</font></font></p><p>
</p><hr><h3><a name="pdf-math.sin"><code>мат.sin (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает синус </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(предполагается в радианах).




</font></font></p><p>
</p><hr><h3><a name="pdf-math.sqrt"><code>мат.sqrt (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает квадратный корень из </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(Вы также можете использовать выражение </font></font><code>x^0.5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для вычисления этого значения.)




</font></font></p><p>
</p><hr><h3><a name="pdf-math.tan"><code>мат.tan (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает тангенс </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(предполагается в радианах).




</font></font></p><p>
</p><hr><h3><a name="pdf-math.tointeger"><code>мат.вцелое (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если значение </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">может быть преобразовано в целое число, возвращает это целое число. </font><font style="vertical-align: inherit;">В противном случае возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .




</font></font></p><p>
</p><hr><h3><a name="pdf-math.type"><code>мат.type (x)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает " </font></font><code>integer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">", если </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является целым числом, " </font></font><code>float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">", если это число с плавающей запятой, или </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> если </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это не число.




</font></font></p><p>
</p><hr><h3><a name="pdf-math.ult"><code>мат.ult (m, n)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает логическое значение true, если и только если целое число </font></font><code>m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">меньше целого, </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">когда они сравниваются как целые числа без знака.







</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.8 - </font></font><a name="6.8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Средства ввода и вывода</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Библиотека ввода / вывода предоставляет два разных стиля для манипулирования файлами. </font><font style="vertical-align: inherit;">Первый использует неявные файловые дескрипторы; </font><font style="vertical-align: inherit;">то есть есть операции для установки файла ввода по умолчанию и файла вывода по умолчанию, и все операции ввода / вывода выполняются над этими файлами по умолчанию. </font><font style="vertical-align: inherit;">Второй стиль использует явные файловые дескрипторы.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
При использовании неявных файловых дескрипторов все операции предоставляются таблицей </font></font><a name="pdf-io"><code>вв</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">При использовании явных файловых дескрипторов операция </font></font><a href="#pdf-io.open"><code>вв.открой</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает файловый дескриптор, а затем все операции предоставляются как методы файлового дескриптора.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Таблица </font></font><code>вв</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">также обеспечивает три предопределенных дескрипторов файлов с их обычными значениями из C:
 </font></font><a name="pdf-io.stdin"><code>вв.stdin</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><a name="pdf-io.stdout"><code>вв.stdout</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><a name="pdf-io.stderr"><code>вв.stderr</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Библиотека ввода / вывода никогда не закрывает эти файлы.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если не указано иное, все функции ввода-вывода возвращают </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> при ошибке (плюс сообщение ощибка в качестве второго результата и системно-зависимый код ощибка в качестве третьего результата) и некоторое значение, отличное от </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">нуля</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> при успехе. </font><font style="vertical-align: inherit;">На не-POSIX систем, вычисление сообщения ощибка и ощибка код в случае ошибок может быть не поточно, поскольку они опираются на глобальную переменную C </font></font><code>errno</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p>
</p><hr><h3><a name="pdf-io.close"><code>вв.закрой ([file])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эквивалент </font></font><code>file:close()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Без </font></font><code>file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, закрывает выходной файл по умолчанию.




</font></font></p><p>
</p><hr><h3><a name="pdf-io.flush"><code>вв.сброс ()</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эквивалент </font></font><code>вв.output():flush()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-io.input"><code>вв.input ([file])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
При вызове с именем файла он открывает указанный файл (в текстовом режиме) и устанавливает его дескриптор в качестве входного файла по умолчанию. </font><font style="vertical-align: inherit;">При вызове с дескриптором файла он просто устанавливает этот дескриптор файла в качестве входного файла по умолчанию. </font><font style="vertical-align: inherit;">При вызове без параметров возвращает текущий входной файл по умолчанию.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В случае ошибок эта функция вызывает ощибку вместо возврата кода ощибка.




</font></font></p><p>
</p><hr><h3><a name="pdf-io.lines"><code>вв.построчно ([filename, ···])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Открывает данное имя файла в режиме чтения и возвращает функцию итератора, которая работает как </font></font><code>file:lines(···)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">над открытым файлом. </font><font style="vertical-align: inherit;">Когда функция итератора обнаруживает конец файла, она не возвращает значений (для завершения цикла) и автоматически закрывает файл.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вызов </font></font><code>вв.построчно()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(без имени файла) эквивалентен </font></font><code>вв.input():lines("*l")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">то есть он перебирает строки входного файла по умолчанию. </font><font style="vertical-align: inherit;">В этом случае он не закрывает файл после окончания цикла.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В случае ошибок эта функция вызывает ощибку вместо возврата кода ощибка.




</font></font></p><p>
</p><hr><h3><a name="pdf-io.open"><code>вв.открой (filename [, mode])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция открывает файл в режиме, указанном в строке </font></font><code>mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">В случае успеха возвращает новый дескриптор файла.


</font></font></p><p><font style="vertical-align: inherit;"></font><code>mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Строка может быть любой из следующих:

</font></font></p><ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><code>r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">":</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> режим чтения (по умолчанию);</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><code>w</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">":</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> режим записи;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">":</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> режим добавления;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><code>r+</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">":</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> режим обновления, все предыдущие данные сохраняются;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><code>w+</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">":</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> режим обновления, все предыдущие данные стираются;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><code>a+</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">":</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> добавить режим обновления, предыдущие данные сохранены, запись разрешена только в конец файла.</font></font></li>
</ul><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
У </font></font><code>mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">строки также может быть символ ' </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' в конце, который необходим в некоторых системах для открытия файла в двоичном режиме.




</font></font></p><p>
</p><hr><h3><a name="pdf-io.output"><code>вв.output ([file])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Аналогично </font></font><a href="#pdf-io.input"><code>вв.input</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, но работает с выходным файлом по умолчанию.




</font></font></p><p>
</p><hr><h3><a name="pdf-io.popen"><code>вв.popen (prog [, mode])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция зависит от системы и доступна не на всех платформах.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Запускает программу </font></font><code>prog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в отдельном процессе и возвращает дескриптор файла, который можно использовать для чтения данных из этой программы (если </font></font><code>mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть </font></font><code>"r"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, по умолчанию) или для записи данных в эту программу (если </font></font><code>mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">есть </font></font><code>"w"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).




</font></font></p><p>
</p><hr><h3><a name="pdf-io.read"><code>вв.читай (···)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эквивалент </font></font><code>вв.input():read(···)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-io.tmpfile"><code>вв.tmpfile ()</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В случае успеха возвращает дескриптор временного файла. </font><font style="vertical-align: inherit;">Этот файл открывается в режиме обновления и автоматически удаляется после завершения программы.




</font></font></p><p>
</p><hr><h3><a name="pdf-io.type"><code>вв.type (obj)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Проверяет, </font></font><code>obj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является </font><font style="vertical-align: inherit;">ли </font><font style="vertical-align: inherit;">допустимый дескриптор файла. </font><font style="vertical-align: inherit;">Возвращает строку , </font></font><code>"file"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если </font></font><code>obj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это открытый дескриптор файла,
 </font></font><code>"closed file"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если </font></font><code>obj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это замкнутый дескриптор файла, или </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , если </font></font><code>obj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не дескриптор файла.




</font></font></p><p>
</p><hr><h3><a name="pdf-io.write"><code>вв.пиши (···)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эквивалент </font></font><code>вв.output():write(···)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-file:close"><code>file:close ()</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Закрывает </font></font><code>file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Обратите внимание, что файлы автоматически закрываются, когда их дескрипторы собираются мусором, но на это уходит непредсказуемое время.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
При закрытии дескриптора файла, созданного с помощью </font></font><a href="#pdf-io.popen"><code>вв.popen</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><a href="#pdf-file:close"><code>file:close</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает те же значения, которые возвращает </font></font><a href="#pdf-os.execute"><code>ос.выполнить</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-file:flush"><code>file:flush ()</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Сохраняет любые записанные данные в </font></font><code>file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-file:lines"><code>file:lines (···)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает функцию итератора, которая при каждом вызове читает файл в соответствии с заданными форматами. </font><font style="vertical-align: inherit;">Если формат не указан, </font></font><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">по умолчанию </font><font style="vertical-align: inherit;">используется " </font><font style="vertical-align: inherit;">". </font><font style="vertical-align: inherit;">Как пример, строительство

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     для c в файле: lines (1) </font><font style="vertical-align: inherit;">конец
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">тела</font></font></em><font style="vertical-align: inherit;"></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
будет перебирать все символы файла, начиная с текущей позиции. </font><font style="vertical-align: inherit;">В отличие от </font></font><a href="#pdf-io.lines"><code>вв.построчно</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">этого, эта функция не закрывает файл после окончания цикла.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В случае ошибок эта функция вызывает ощибку вместо возврата кода ощибка.




</font></font></p><p>
</p><hr><h3><a name="pdf-file:read"><code>file:read (···)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Читает файл в </font></font><code>file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">соответствии с заданными форматами, в которых указывается, что читать. </font><font style="vertical-align: inherit;">Для каждого формата функция возвращает строку или число с прочитанными символами или </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> если не может прочитать данные в указанном формате. </font><font style="vertical-align: inherit;">(В этом последнем случае функция не читает последующие форматы.) При вызове без форматов она использует формат по умолчанию, который читает следующую строку (см. Ниже).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Доступные форматы

</font></font></p><ul>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">« </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">»:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
читает число и возвращает его как число с плавающей точкой или целое число, следуя лексическим соглашениям Lua. </font><font style="vertical-align: inherit;">(Цифра может иметь начальные пробелы и знак.) Этот формат всегда считывает самую длинную входную последовательность, которая является действительным префиксом для цифры; </font><font style="vertical-align: inherit;">если этот префикс не образует допустимую цифру (например, пустую строку, " </font></font><code>0x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" или " </font></font><code>3.4e-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"), он отбрасывается и функция возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">« </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">»:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
читает весь файл, начиная с текущей позиции. </font><font style="vertical-align: inherit;">В конце файла возвращает пустую строку.
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">« </font></font><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">»:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
читает следующую строку, пропуская конец строки, возвращая </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> в конце файла. </font><font style="vertical-align: inherit;">Это формат по умолчанию.
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">« </font></font><code>L</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">»:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
читает следующую строку, сохраняя символ конца строки (если присутствует), возвращая </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> в конце файла.
</font></font></li>

<li><b><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">число</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
читает строку длиной до этого количества байтов, возвращая</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> в конце файла. </font><font style="vertical-align: inherit;">Если</font></font><code>number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль, он ничего не читает и возвращает пустую строку или</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> в конце файла.
</font></font></li>

</ul><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Форматы " </font></font><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" и " </font></font><code>L</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" должны использоваться только для текстовых файлов.




</font></font></p><p>
</p><hr><h3><a name="pdf-file:seek"><code>file:seek ([whence [, offset]])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Устанавливает и возвращает позицию файла, измеренную от начала файла, до позиции, заданной </font></font><code>offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">плюс основание, указанное в строке </font></font><code>whence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, следующим образом:

</font></font></p><ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><code>set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">":</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> база - это позиция 0 (начало файла);</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">« </font></font><code>cur</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">»:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> база - текущая позиция;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><code>end</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">":</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> база - это конец файла;</font></font></li>
</ul><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В случае успеха </font></font><code>seek</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает окончательную позицию файла, измеренную в байтах от начала файла. </font><font style="vertical-align: inherit;">Если происходит </font></font><code>seek</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">сбой, возвращается </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> плюс строка, описывающая ощибка.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Значением по умолчанию для </font></font><code>whence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является </font></font><code>"cur"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, а для </font></font><code>offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 0. Следовательно, вызов </font></font><code>file:seek()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает текущую позицию файла, не изменяя ее; </font><font style="vertical-align: inherit;">вызов </font></font><code>file:seek("set")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">устанавливает позицию в начало файла (и возвращает 0); </font><font style="vertical-align: inherit;">и вызов </font></font><code>file:seek("end")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">устанавливает позицию в конец файла и возвращает его размер.




</font></font></p><p>
</p><hr><h3><a name="pdf-file:setvbuf"><code>file:setvbuf (mode [, size])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Устанавливает режим буферизации для выходного файла. </font><font style="vertical-align: inherit;">Есть три доступных режима:

</font></font></p><ul>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><code>no</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">":</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
без буферизации; </font><font style="vertical-align: inherit;">результат любой операции вывода появляется немедленно.
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><code>full</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">":</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
полная буферизация; </font><font style="vertical-align: inherit;">Операция вывода выполняется только тогда, когда буфер заполнен или когда вы явно указываете </font></font><code>flush</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">файл (см. </font></font><a href="#pdf-io.flush"><code>вв.сброс</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><code>line</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">":</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
буферизация строки; </font><font style="vertical-align: inherit;">выходные данные буферизуются до тех пор, пока не будет выведен символ новой строки или пока не появятся какие-либо входные данные из некоторых специальных файлов (например, оконечного устройства).
</font></font></li>

</ul><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Для двух последних случаев </font></font><code>size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
указывает размер буфера в байтах. </font><font style="vertical-align: inherit;">По умолчанию используется соответствующий размер.




</font></font></p><p>
</p><hr><h3><a name="pdf-file:write"><code>file:write (···)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Записывает значение каждого из своих аргументов в </font></font><code>file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Аргументы должны быть строками или числами.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В случае успеха эта функция возвращает </font></font><code>file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">В противном случае возвращается </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> плюс строка, описывающая ощибка.







</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.9 - </font></font><a name="6.9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Возможности операционной системы</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта библиотека реализована через таблицу </font></font><a name="pdf-os"><code>ос</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p>
</p><hr><h3><a name="pdf-os.clock"><code>ос.clock ()</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает приблизительную величину в секундах процессорного времени, используемого программой.




</font></font></p><p>
</p><hr><h3><a name="pdf-os.date"><code>ос.дата ([format [, time]])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает строку или таблицу, содержащую дату и время, отформатированные в соответствии с заданной строкой </font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">аргумент присутствует, это время для форматирования (см. </font></font><a href="#pdf-os.time"><code>ос.время</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Функцию для описания этого значения). </font><font style="vertical-align: inherit;">В противном случае </font></font><code>date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">форматирует текущее время.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">начинается с ' </font></font><code>!</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">', то дата форматируется в формате всемирного координированного времени. </font><font style="vertical-align: inherit;">После этого дополнительного символа, если </font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это строка " </font></font><code>*t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">", а </font><font style="vertical-align: inherit;">затем </font></font><code>date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает таблицу со следующими полями:
 </font></font><code>year</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>month</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1-12), </font></font><code>day</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1-31),
 </font></font><code>hour</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(0-23), </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(0-59), </font></font><code>sec</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(0-61 ),
 </font></font><code>wday</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(день недели, 1–7, воскресенье - 1),
 </font></font><code>yday</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(день года, 1–366) и </font></font><code>isdst</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(флаг перехода на летнее время, логическое значение). </font><font style="vertical-align: inherit;">Это последнее поле может отсутствовать, если информация недоступна.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>format</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не « </font></font><code>*t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">», а </font><font style="vertical-align: inherit;">затем </font></font><code>date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает дату как строка, отформатированную в </font><font style="vertical-align: inherit;">соответствии с теми же правилами, что и </font><font style="vertical-align: inherit;">функции ISO C </font></font><code>strftime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
При вызове без аргументов
 </font></font><code>date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает разумное представление даты и времени, которое зависит от хост-системы и текущей локали. </font><font style="vertical-align: inherit;">(Более конкретно, </font></font><code>ос.дата()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">эквивалентно </font></font><code>ос.дата("%c")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В системах без POSIX, эта функция может быть не поточно из - </font><font style="vertical-align: inherit;">за своей зависимости от функции C </font></font><code>gmtime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и функции C </font></font><code>localtime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-os.difftime"><code>ос.difftime (t2, t1)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает разницу в секундах, время от </font></font><code>t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ко времени </font></font><code>t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(где времена возвращаемые значения </font></font><a href="#pdf-os.time"><code>ос.время</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">В POSIX, Windows и некоторых других систем, это значение точно </font></font><code>t2</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></em><code>t1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .




</font></font></p><p>
</p><hr><h3><a name="pdf-os.execute"><code>ос.выполнить ([command])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция эквивалентна функции ISO C </font></font><code>system</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Это проходит, </font></font><code>command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">чтобы быть выполненным оболочкой операционной системы. </font><font style="vertical-align: inherit;">Его первый результат - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
если команда завершилась успешно, или </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil в</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> противном случае. </font><font style="vertical-align: inherit;">После этого первого результата функция возвращает строку плюс число следующим образом:

</font></font></p><ul>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">« </font></font><code>exit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">»:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
команда завершилась нормально; </font><font style="vertical-align: inherit;">следующий номер - это статус выхода команды.
</font></font></li>

<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">« </font></font><code>signal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">»:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
команда была прервана сигналом; </font><font style="vertical-align: inherit;">следующий номер является сигналом, который завершил команду.
</font></font></li>

</ul>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
При вызове без </font></font><code>command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><code>ос.выполнить</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает логическое значение, которое истинно , </font><font style="vertical-align: inherit;">если оболочка доступна.




</font></font></p><p>
</p><hr><h3><a name="pdf-os.exit"><code>ос.выход ([code [, close]])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вызывает функцию ISO C </font></font><code>exit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для завершения программы хоста. </font><font style="vertical-align: inherit;">Если </font></font><code>code</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">правда</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , возвращаемый статус есть </font></font><code>EXIT_SUCCESS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">если </font></font><code>code</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ложь</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , возвращаемый статус </font></font><code>EXIT_FAILURE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">если </font></font><code>code</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это число, возвращаемый статус - это число. </font><font style="vertical-align: inherit;">Значение по умолчанию </font></font><code>code</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">истинным</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если необязательный второй аргумент </font></font><code>close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">имеет значение true, перед выходом закрывается состояние Lua.




</font></font></p><p>
</p><hr><h3><a name="pdf-os.getenv"><code>ос.getenv (varname)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает значение переменной среды процесса </font></font><code>varname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> если переменная не определена.




</font></font></p><p>
</p><hr><h3><a name="pdf-os.remove"><code>ос.удалить (filename)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Удаляет файл (или пустой каталог в системах POSIX) с указанным именем. </font><font style="vertical-align: inherit;">Если эта функция завершается ошибкой, она возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , плюс строку, описывающую код ощибка и код ощибка. </font><font style="vertical-align: inherit;">В противном случае он возвращает истину.




</font></font></p><p>
</p><hr><h3><a name="pdf-os.rename"><code>ос.переименовать (oldname, newname)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Переименовывает файл или каталог с именем </font></font><code>oldname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в </font></font><code>newname</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если эта функция завершается ошибкой, она возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , плюс строку, описывающую код ощибка и код ощибка. </font><font style="vertical-align: inherit;">В противном случае он возвращает истину.




</font></font></p><p>
</p><hr><h3><a name="pdf-os.setlocale"><code>ос.устлокаль (locale [, category])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Устанавливает текущую локаль программы.
</font></font><code>locale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">системно-зависимая строка, указывающая локаль;
</font></font><code>category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">является необязательной строкой , </font><font style="vertical-align: inherit;">описывающая какой категория для изменения:
 </font></font><code>"all"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>"collate"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>"ctype"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><code>"monetary"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>"numeric"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, или </font></font><code>"time"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">категория по умолчанию </font></font><code>"all"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Функция возвращает имя новой локали или </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> если запрос не может быть выполнен.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>locale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это пустая строка, текущим языковым стандартом является собственная локаль, определяемая реализацией. </font><font style="vertical-align: inherit;">Если </font></font><code>locale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это строка " </font></font><code>C</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">", текущая локаль установлена ​​на стандартную локаль C.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
При вызове с </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> в качестве первого аргумента эта функция возвращает только имя текущей локали для данной категории.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция может быть не поточно из - </font><font style="vertical-align: inherit;">за своей зависимости от функции C </font></font><code>setlocale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-os.time"><code>ос.время ([таблица])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает текущее время при вызове без аргументов или время, представляющее локальную дату и время, указанные в данной таблице. </font><font style="vertical-align: inherit;">Эта таблица должна иметь поля </font></font><code>year</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>month</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>day</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, и может иметь поля
 </font></font><code>hour</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(по умолчанию 12),
 </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(по умолчанию 0),
 </font></font><code>sec</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(по умолчанию 0) и </font></font><code>isdst</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(по умолчанию </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Другие поля игнорируются. </font><font style="vertical-align: inherit;">Описание этих полей см. В </font></font><a href="#pdf-os.date"><code>ос.дата</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функции.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Значения в этих полях не обязательно должны находиться в допустимых диапазонах. </font><font style="vertical-align: inherit;">Например, если </font></font><code>sec</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-10, это означает -10 секунд от времени, указанного в других полях; </font><font style="vertical-align: inherit;">Если </font></font><code>hour</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1000, это означает +1000 часов от времени, указанного в других полях.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращаемое значение - это число, значение которого зависит от вашей системы. </font><font style="vertical-align: inherit;">В POSIX, Windows и некоторых других системах это число подсчитывает количество секунд, прошедшее с некоторого заданного времени начала («эпоха»). </font><font style="vertical-align: inherit;">В других системах значение не указано, а возвращаемое число </font></font><code>time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">может использоваться только в качестве аргумента для
 </font></font><a href="#pdf-os.date"><code>ос.дата</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><a href="#pdf-os.difftime"><code>ос.difftime</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-os.tmpname"><code>ос.tmpname ()</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает строку с именем файла, которую можно использовать для временного файла. </font><font style="vertical-align: inherit;">Файл должен быть явно открыт перед использованием и явно удален, когда он больше не нужен.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В системах POSIX эта функция также создает файл с таким именем, чтобы избежать угроз безопасности. </font><font style="vertical-align: inherit;">(Кто-то другой может создать файл с неправильными разрешениями во время между получением имени и созданием файла.) Вам все равно нужно открыть файл, чтобы использовать его и удалить (даже если вы его не используете).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда это возможно, вы можете предпочесть использовать </font></font><a href="#pdf-io.tmpfile"><code>вв.tmpfile</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, который автоматически удаляет файл, когда программа заканчивается.







</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.10 - </font></font><a name="6.10"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Библиотека отладки</font></font></a></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта библиотека обеспечивает функциональность интерфейса </font></font><a href="#4.9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">отладка</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font><a href="#4.9"><font style="vertical-align: inherit;">§4.9</font></a><font style="vertical-align: inherit;"> ) для программ Lua. </font><font style="vertical-align: inherit;">Вы должны проявлять осторожность при использовании этой библиотеки. </font><font style="vertical-align: inherit;">Некоторые из его функций нарушают основные предположения о Lua-коде (например, что локальные для функции переменные не могут быть доступны извне; что метатаблицы пользовательских данных не могут быть изменены с помощью Lua-кода; что Lua-программы не аварийно завершаются) и, следовательно, могут поставить под угрозу безопасность кода в противном случае. </font><font style="vertical-align: inherit;">Более того, некоторые функции в этой библиотеке могут быть медленными.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Все функции в этой библиотеке предоставляются внутри </font></font><a name="pdf-debug"><code>отладка</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">таблицы. </font><font style="vertical-align: inherit;">Все функции, которые работают над потоком, имеют необязательный первый аргумент, которым является поток, с которым нужно работать. </font><font style="vertical-align: inherit;">По умолчанию всегда используется текущий поток.


</font></font></p><p>
</p><hr><h3><a name="pdf-debug.debug"><code>отладка.отладка ()</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вводит интерактивный режим с пользователем, запуская каждую строку, которую вводит пользователь. </font><font style="vertical-align: inherit;">Используя простые команды и другие средства отладки, пользователь может проверять глобальные и локальные переменные, изменять их значения, оценивать выражения и так далее. </font><font style="vertical-align: inherit;">Строка, содержащая только слово, </font></font><code>cont</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">завершает эту функцию, так что вызывающая сторона продолжает ее выполнение.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Обратите внимание, что команды для </font></font><code>отладка.отладка</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не лексически вложены в какую-либо функцию и поэтому не имеют прямого доступа к локальным переменным.




</font></font></p><p>
</p><hr><h3><a name="pdf-debug.gethook"><code>отладка.хук ([thread])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает текущие настройки ловушек потока в виде трех значений: текущая функция ловушек, текущая маска ловушек и текущий счетчик ловушек (как установлено </font></font><a href="#pdf-debug.sethook"><code>отладка.устхук</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функцией).




</font></font></p><p>
</p><hr><h3><a name="pdf-debug.getinfo"><code>отладка.инфо ([thread,] f [, what])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает таблицу с информацией о функции. </font><font style="vertical-align: inherit;">Вы можете передать функцию напрямую или указать число в качестве значения </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, что означает, что функция работает на уровне </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">стека вызовов данного потока: уровень 0 - текущая функция ( </font></font><code>getinfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">сама по себе); </font><font style="vertical-align: inherit;">уровень 1 - это вызываемая функция </font></font><code>getinfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(кроме хвостовых вызовов, которые не учитываются в стеке); </font><font style="vertical-align: inherit;">и так далее. </font><font style="vertical-align: inherit;">Если </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">это число больше, чем число активных функций, то </font></font><code>getinfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращаемая таблица может содержать все возвращаемые поля </font></font><a href="#lua_getinfo"><code>lua_getinfo</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">со строкой, </font></font><code>what</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">описывающей, какие поля нужно заполнить. По умолчанию для этого </font></font><code>what</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">используется вся доступная информация, кроме таблицы действительных строк. </font><font style="vertical-align: inherit;">Если присутствует, опция ' </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' добавляет поле с именем </font></font><code>func</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">самой функции. </font><font style="vertical-align: inherit;">Если присутствует, опция ' </font></font><code>L</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' добавляет поле с именем </font></font><code>activelines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">таблицы допустимых строк.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Например, выражение </font></font><code>отладка.инфо(1,"n").name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает имя для текущей функции, если можно найти разумное имя, а выражение </font></font><code>отладка.инфо(печать)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
возвращает таблицу со всей доступной информацией о </font></font><a href="#pdf-print"><code>печать</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функции.




</font></font></p><p>
</p><hr><h3><a name="pdf-debug.getlocal"><code>отладка.дайлокал ([thread,] f, local)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция возвращает имя и значение локальной переменной с индексом </font></font><code>local</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функции на уровне </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">стека. </font><font style="vertical-align: inherit;">Эта функция обращается не только к явным локальным переменным, но также к параметрам, временным значениям и т. Д.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Первый параметр или локальная переменная имеет индекс 1 и т. Д., Следуя порядку, в котором они объявлены в коде, считая только те переменные, которые активны в текущей области действия функции. </font><font style="vertical-align: inherit;">Отрицательные индексы относятся к параметрам vararg; </font><font style="vertical-align: inherit;">-1 является первым параметром vararg. </font><font style="vertical-align: inherit;">Функция возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> если нет переменной с данным индексом, и вызывает ощибку при вызове с уровнем вне диапазона. </font><font style="vertical-align: inherit;">(Вы можете позвонить, </font></font><a href="#pdf-debug.getinfo"><code>отладка.инфо</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">чтобы проверить, является ли уровень действительным.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Имена переменных, начинающиеся с ' </font></font><code>(</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (открывающая скобка), представляют переменные без известных имен (внутренние переменные, такие как переменные управления циклами, и переменные из чанков, сохраненные без информации об отладке).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Параметр </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">также может быть функцией. </font><font style="vertical-align: inherit;">В этом случае </font></font><code>getlocal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает только имя параметров функции.




</font></font></p><p>
</p><hr><h3><a name="pdf-debug.getmetatable"><code>отладка.метатаб (value)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает метатабель данного </font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
или </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> если у него нет метатабеля.




</font></font></p><p>
</p><hr><h3><a name="pdf-debug.getregistry"><code>отладка.регистр ()</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает </font></font><a href="#4.5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">таблицу</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> реестра (см. </font><a href="#4.5"><font style="vertical-align: inherit;">§4.5</font></a><font style="vertical-align: inherit;"> ).




</font></font></p><p>
</p><hr><h3><a name="pdf-debug.getupvalue"><code>отладка.getupvalue (f, up)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция возвращает имя и значение значения с индексом </font></font><code>up</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функции </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Функция возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> если нет никакого значения с данным индексом.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Имена переменных, начинающиеся с ' </font></font><code>(</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' (открывающая скобка), представляют переменные без известных имен (переменные из чанков сохраняются без информации об отладке).




</font></font></p><p>
</p><hr><h3><a name="pdf-debug.getuservalue"><code>отладка.getuservalue (u)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает значение Lua, связанное с </font></font><code>u</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Если </font></font><code>u</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не полные данные пользователя, возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .




</font></font></p><p>
</p><hr><h3><a name="pdf-debug.sethook"><code>отладка.устхук ([thread,] hook, mask [, count])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Устанавливает данную функцию как хук. </font><font style="vertical-align: inherit;">Строка </font></font><code>mask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и номер </font></font><code>count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">описывают, когда будет вызван хук. </font><font style="vertical-align: inherit;">Маска строки может иметь любую комбинацию следующих символов с заданным значением:

</font></font></p><ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' </font></font><code>c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">':</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ловушка вызывается каждый раз, когда Lua вызывает функцию;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' </font></font><code>r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">':</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> хук вызывается каждый раз, когда Lua возвращается из функции;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' </font></font><code>l</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">':</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> хук вызывается каждый раз, когда Lua вводит новую строку кода.</font></font></li>
</ul><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Более того, при </font></font><code>count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">отличном от нуля хуке вызывается также после каждой </font></font><code>count</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">инструкции.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
При вызове без аргументов
 </font></font><a href="#pdf-debug.sethook"><code>отладка.устхук</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">отключается хук.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда крюк называют его первым параметром является строка , </font><font style="vertical-align: inherit;">описывающая событие , </font><font style="vertical-align: inherit;">которое вызвало его вызов:
 </font></font><code>"call"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(или </font></font><code>"tail call"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">),
 </font></font><code>"return"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><code>"line"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, и </font></font><code>"count"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Для событий строки хук также получает новый номер строки в качестве второго параметра. </font><font style="vertical-align: inherit;">Внутри ловушки вы можете вызвать </font></font><code>getinfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">уровень 2, чтобы получить больше информации о выполняющейся функции (уровень 0 - </font></font><code>getinfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функция, а уровень 1 - функция ловушки).




</font></font></p><p>
</p><hr><h3><a name="pdf-debug.setlocal"><code>отладка.устлокал ([thread,] level, local, value)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция присваивает значение </font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">локальной переменной с индексом </font></font><code>local</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функции на уровне </font></font><code>level</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">стека. </font><font style="vertical-align: inherit;">Функция возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> если не существует локальной переменной с данным индексом, и вызывает ощибку при вызове с </font></font><code>level</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">выходом за пределы диапазона. </font><font style="vertical-align: inherit;">(Вы можете позвонить, </font></font><code>getinfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">чтобы проверить, является ли уровень действительным.) В противном случае он возвращает имя локальной переменной.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Смотрите </font></font><a href="#pdf-debug.getlocal"><code>отладка.дайлокал</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для получения дополнительной информации о переменных переменных и именах.




</font></font></p><p>
</p><hr><h3><a name="pdf-debug.setmetatable"><code>отладка.устметатаб (value, таблица)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Устанавливает метатабельный для данного </font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">к данному </font></font><code>таблица</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(который может быть </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ноль</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Возвращает </font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-debug.setupvalue"><code>отладка.устзнач (f, up, value)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эта функция присваивает значение </font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">верхнему значению с индексом </font></font><code>up</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">функции </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Функция возвращает </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> если нет никакого значения с данным индексом. </font><font style="vertical-align: inherit;">В противном случае он возвращает имя upvalue.




</font></font></p><p>
</p><hr><h3><a name="pdf-debug.setuservalue"><code>отладка.setuservalue (udata, value)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Устанавливает данное </font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">как значение Lua, связанное с данным </font></font><code>udata</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.
</font></font><code>udata</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">должны быть полными данными пользователя.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает </font></font><code>udata</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.




</font></font></p><p>
</p><hr><h3><a name="pdf-debug.traceback"><code>отладка.трассировка ([thread,] [message [, level]])</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если </font></font><code>message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">присутствует, но не является ни строкой, ни </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , эта функция возвращается </font></font><code>message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">без дальнейшей обработки. </font><font style="vertical-align: inherit;">В противном случае он возвращает строку с трассировкой стека вызовов. </font><font style="vertical-align: inherit;">Необязательная </font></font><code>message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">строка добавляется в начале трассировки. </font><font style="vertical-align: inherit;">Необязательный </font></font><code>level</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">номер указывает, на каком уровне запускать трассировку (по умолчанию 1, вызов функции </font></font><code>traceback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).




</font></font></p><p>
</p><hr><h3><a name="pdf-debug.upvalueid"><code>отладка.upvalueid (f, n)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Возвращает уникальный идентификатор (в виде легких пользовательских данных) для повышения значения, пронумерованного </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
из данной функции.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Эти уникальные идентификаторы позволяют программе проверять, имеют ли разные замыкания общие значения. </font><font style="vertical-align: inherit;">Закрытия Lua с общим значением повышения (то есть с доступом к одной и той же внешней локальной переменной) будут возвращать идентичные идентификаторы для этих индексов повышения.




</font></font></p><p>
</p><hr><h3><a name="pdf-debug.upvaluejoin"><code>отладка.upvaluejoin (f1, n1, f2, n2)</code></a></h3>


<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Сделайте, чтобы </font></font><code>n1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">верхнее значение закрытия Lua </font></font><code>f1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
было </font></font><code>n2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">равно значению, относящемуся к седьмому значению закрытия Lua </font></font><code>f2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.







</font></font></p><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7 - </font></font><a name="7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lua Standalone</font></font></a></h1>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Хотя Lua был разработан как язык расширения, чтобы быть встроенным в программу на языке C, он также часто используется как самостоятельный язык. </font><font style="vertical-align: inherit;">Интерпретатор Lua как отдельного языка, называемого просто </font></font><code>lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, поставляется со стандартным дистрибутивом. </font><font style="vertical-align: inherit;">Автономный интерпретатор включает в себя все стандартные библиотеки, включая библиотеку отладка. </font><font style="vertical-align: inherit;">Его использование:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     lua [options] [script [args]]
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Варианты:

</font></font></p><ul>
<li><b><code>-e <em>stat</em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняет строку </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stat</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><b><code>-l <em>mod</em></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "требуется" </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">мод</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><b><code>-i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> входит в интерактивный режим после запуска </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">скрипта</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><b><code>-v</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> печатает информацию о версии;</font></font></li>
<li><b><code>-E</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> игнорирует переменные среды;</font></font></li>
<li><b><code>--</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> останавливает обработку параметров;</font></font></li>
<li><b><code>-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> выполняется </font></font><code>stdin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">как файл и останавливает обработку параметров.</font></font></li>
</ul><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
После обработки его параметров </font></font><code>lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">запускается данный </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">скрипт</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Когда </font><font style="vertical-align: inherit;">вызывается </font><font style="vertical-align: inherit;">без аргументов,
 </font></font><code>lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ведет себя так же, как </font></font><code>lua -v -i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
когда стандартная input ( </font></font><code>stdin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) является терминалом, и как в </font></font><code>lua -</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">противном случае.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Когда </font><font style="vertical-align: inherit;">вызывается </font><font style="vertical-align: inherit;">без опции </font></font><code>-E</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, интерпретатор проверяет переменную среды </font></font><a name="pdf-LUA_INIT_5_3"><code>LUA_INIT_5_3</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(или </font></font><a name="pdf-LUA_INIT"><code>LUA_INIT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если версионное имя не определено) перед запуском любого аргумента. </font><font style="vertical-align: inherit;">Если содержимое переменной имеет формат </font><font style="vertical-align: inherit;">, то </font><font style="vertical-align: inherit;">исполняется файл. </font><font style="vertical-align: inherit;">В противном случае </font><font style="vertical-align: inherit;">выполняет саму строку.


</font></font><code>@<em>filename</em></code><font style="vertical-align: inherit;"></font><code>lua</code><font style="vertical-align: inherit;"></font><code>lua</code><font style="vertical-align: inherit;"></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
При вызове с параметром </font></font><code>-E</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, помимо игнорирования </font></font><code>LUA_INIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Lua также игнорирует значения </font></font><code>LUA_PATH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>LUA_CPATH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, устанавливая значения
 </font></font><a href="#pdf-package.path"><code>модули.path</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><a href="#pdf-package.cpath"><code>модули.cpath</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
с путями по умолчанию, определенными в </font></font><code>luaconf.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Все параметры обрабатываются по порядку, кроме </font></font><code>-i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и </font></font><code>-E</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Например, вызов как

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     $ lua -e'a = 1 '-e' печать (a) 'script.lua
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
сначала установите </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">значение 1, затем напечатайте значение </font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и, наконец, запустите файл </font></font><code>script.lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">без аргументов. </font><font style="vertical-align: inherit;">(Вот </font></font><code>$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">подсказка оболочки. Ваша подсказка может отличаться.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Перед выполнением любого кода
 </font></font><code>lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">собирает все аргументы командной строки в глобальной таблице с именем </font></font><code>arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Имя сценария переходит в индекс 0, первый аргумент после имени сценария переходит в индекс 1 и т. Д. </font><font style="vertical-align: inherit;">Любые аргументы перед именем скрипта (то есть имя интерпретатора плюс его опции) переходят в отрицательные индексы. </font><font style="vertical-align: inherit;">Например, в вызове

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     $ lua -la b.lua t1 t2
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
таблица выглядит так:

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     arg = {[-2] = "lua", [-1] = "-la",</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             [0] = "b.lua",</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             [1] = "t1", [2] = "t2"}</font></font><font></font>
</pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если в вызове нет сценария, имя интерпретатора переходит к индексу 0, за которым следуют другие аргументы. </font><font style="vertical-align: inherit;">Например, вызов

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     $ lua -e "print (arg [1])"
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
будет печать " </font></font><code>-e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">". </font><font style="vertical-align: inherit;">Если есть сценарий, сценарий вызывается с параметрами
 </font></font><code>arg[1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ···, </font></font><code>arg[#arg]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(Как и все куски в Lua, скрипт скомпилирован как функция vararg.)


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В интерактивном режиме Lua неоднократно запрашивает и ждет линии. </font><font style="vertical-align: inherit;">После прочтения строки Lua сначала попытается интерпретировать строку как выражение. </font><font style="vertical-align: inherit;">Если это удается, он печатает свое значение. </font><font style="vertical-align: inherit;">В противном случае он интерпретирует строку как утверждение. </font><font style="vertical-align: inherit;">Если вы пишете неполное утверждение, интерпретатор ожидает его завершения, выдавая другое приглашение.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Если глобальная переменная </font></font><a name="pdf-_PROMPT"><code>_PROMPT</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">содержит строку, то в качестве подсказки используется ее значение. </font><font style="vertical-align: inherit;">Точно так же, если глобальная переменная </font></font><a name="pdf-_PROMPT2"><code>_PROMPT2</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">содержит строку, ее значение используется в качестве вторичной подсказки (выдается во время незавершенных операторов).


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
В случае незащищенных ошибок в скрипте интерпретатор сообщает о ощибке в стандартный поток ощибка. </font><font style="vertical-align: inherit;">Если объект ощибка не является строкой, но имеет метаметод </font></font><code>__tostring</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, интерпретатор вызывает этот метаметод для создания окончательного сообщения. </font><font style="vertical-align: inherit;">В противном случае интерпретатор преобразует объект ощибка в строку и добавляет к ней трассировку стека.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
При нормальном завершении интерпретатор закрывает свое основное состояние Lua (см. </font></font><a href="#lua_close"><code>lua_close</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Сценарий может избежать этого шага, вызывая </font></font><a href="#pdf-os.exit"><code>ос.выход</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">прекратить.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Чтобы разрешить использование Lua в качестве интерпретатора сценариев в системах Unix, автономный интерпретатор пропускает первую строку фрагмента, если он начинается с </font></font><code>#</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Поэтому сценарии Lua можно превратить в исполняемые программы с помощью </font></font><code>chmod +x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и&nbsp; </font></font><code>#!</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">формы, как в

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     #! / USR / местные / бен / Lua
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Конечно, местоположение интерпретатора Lua может отличаться на вашем компьютере. Если </font></font><code>lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">на вашем </font></font><code>PATH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, то

</font></font></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">     #! / usr / bin / env lua
</font></font></pre><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
это более портативное решение.)



</font></font></p><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8 - </font></font><a name="8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Несовместимость с предыдущей версией</font></font></a></h1>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Здесь мы перечисляем несовместимости, которые вы можете обнаружить при переносе программы с Lua 5.2 на Lua 5.3. </font><font style="vertical-align: inherit;">Вы можете избежать некоторых несовместимостей, компилируя Lua с соответствующими параметрами (см. Файл </font></font><code>luaconf.h</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Однако все эти параметры совместимости будут удалены в будущем.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Версии Lua всегда могут изменить C API таким образом, чтобы не подразумевать изменения исходного кода в программе, такие как числовые значения для констант или реализация функций в виде макросов. </font><font style="vertical-align: inherit;">Следовательно, вы не должны предполагать, что двоичные файлы совместимы между различными версиями Lua. </font><font style="vertical-align: inherit;">Всегда перекомпилируйте клиенты Lua API при использовании новой версии.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Точно так же версии Lua всегда могут изменить внутреннее представление предварительно скомпилированных фрагментов; </font><font style="vertical-align: inherit;">предварительно скомпилированные чанки не совместимы между разными версиями Lua.


</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Стандартные пути в официальном дистрибутиве могут меняться между версиями.



</font></font></p><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1 - </font></font><a name="8.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Изменения в языке</font></font></a></h2>
<ul>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Основное различие между Lua 5.2 и Lua 5.3 заключается во введении целочисленного подтипа для чисел. </font><font style="vertical-align: inherit;">Хотя это изменение не должно влиять на «нормальные» вычисления, некоторые вычисления (в основном те, которые связаны с каким-либо переполнением) могут давать разные результаты.


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вы можете исправить эти различия, задав число с плавающей точкой (в Lua 5.2 все числа были с плавающей точкой), в частности, записав константы с окончанием </font></font><code>.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
или используя </font></font><code>x = x + 0.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для преобразования переменную. </font><font style="vertical-align: inherit;">(Эта рекомендация предназначена только для быстрого исправления случайной несовместимости; это не общее руководство для хорошего программирования. Для хорошего программирования используйте числа с плавающей точкой, где вам нужны числа с плавающей точкой, и целые числа, где вам нужны целые числа.)
</font></font></p></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Преобразование числа с плавающей точкой в ​​строку теперь добавляет </font></font><code>.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">суффикс к результату, если он выглядит как целое число. </font><font style="vertical-align: inherit;">(Например, float 2.0 будет напечатан как </font></font><code>2.0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">а </font><font style="vertical-align: inherit;">не как </font></font><code>2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.) Вы всегда должны использовать явный формат, когда вам нужен определенный формат для чисел.


</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Формально это не является несовместимостью, потому что Lua не указывает, как числа форматируются как строки, но некоторые программы предполагают определенный формат.)
</font></font></p></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Режим генерации для сборщика мусора был удален. </font><font style="vertical-align: inherit;">(Это была экспериментальная функция в Lua 5.2.)
</font></font></li>

</ul>




<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2 - </font></font><a name="8.2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Изменения в библиотеках</font></font></a></h2>
<ul>

<li><font style="vertical-align: inherit;"></font><code>бит</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Библиотека устарела. </font><font style="vertical-align: inherit;">Легко требовать совместимую внешнюю библиотеку или, что еще лучше, заменить ее функции соответствующими побитовыми операциями. </font><font style="vertical-align: inherit;">(Имейте в виду, что он </font></font><code>бит</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">работает с 32-разрядными целыми числами, тогда как побитовые операторы в Lua 5.3 работают с целыми числами Lua, которые по умолчанию имеют 64-разрядные числа.)
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Библиотека таблиц теперь учитывает метаметоды для установки и получения элементов.
</font></font></li>

<li><font style="vertical-align: inherit;"></font><a href="#pdf-ipairs"><code>перечисли</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Итератор теперь учитывает метаметоды и его </font></font><code>__ipairs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Метаметод устарела.
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Имена опций в </font></font><a href="#pdf-io.read"><code>вв.читай</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">больше не имеют начального ' </font></font><code>*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'. </font><font style="vertical-align: inherit;">Для совместимости Lua будет продолжать принимать (и игнорировать) этот символ.
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Следующие функции были устаревшими в математической библиотеке:
 </font></font><code>atan2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>cosh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>sinh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>tanh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>pow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><code>frexp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, и </font></font><code>ldexp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Вы можете заменить </font></font><code>мат.pow(x,y)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">на </font></font><code>x^y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">Вы можете заменить </font></font><code>мат.atan2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">на </font></font><code>мат.атан</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, который теперь принимает один или два параметра; </font><font style="vertical-align: inherit;">Вы можете заменить </font></font><code>мат.ldexp(x,exp)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">на </font></font><code>x * 2.0^exp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Для других операций вы можете использовать внешнюю библиотеку или внедрить их в Lua.
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Используемый поисковиком загрузчик Си </font></font><a href="#pdf-require"><code>require</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
изменил способ обработки версионных имен. </font><font style="vertical-align: inherit;">Теперь версия должна идти после имени модуля (как обычно в большинстве других инструментов). </font><font style="vertical-align: inherit;">Для совместимости этот поисковик все еще пробует старый формат, если он не может найти открытую функцию в соответствии с новым стилем. </font><font style="vertical-align: inherit;">(Lua 5.2 уже работал таким образом, но он не задокументировал изменение.)
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Теперь вызов </font></font><code>собратьмусор("count")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">возвращает только один результат. </font><font style="vertical-align: inherit;">(Вы можете вычислить этот второй результат из дробной части первого результата.)
</font></font></li>

</ul>




<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3 - </font></font><a name="8.3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Изменения в API</font></font></a></h2>


<ul>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Функции продолжения теперь получают в качестве параметров то, что им нужно было пройти </font></font><code>lua_getctx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, поэтому </font></font><code>lua_getctx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">они были удалены. </font><font style="vertical-align: inherit;">Адаптируйте свой код соответственно.
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Функция </font></font><a href="#lua_dump"><code>lua_dump</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">имеет дополнительный параметр </font></font><code>strip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Используйте 0 в качестве значения этого параметра, чтобы получить старое поведение.
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Функции для введения / проект целых чисел без знака ( </font></font><code>lua_pushunsigned</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>lua_tounsigned</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>lua_tounsignedx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,
 </font></font><code>luaL_checkunsigned</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>luaL_optunsigned</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) были устаревшими. </font><font style="vertical-align: inherit;">Используйте их подписанные эквиваленты с типом броска.
</font></font></li>

<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Макросы проект не по умолчанию целочисленных типов ( </font></font><code>luaL_checkint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>luaL_optint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>luaL_checklong</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>luaL_optlong</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) были устаревшими. </font><font style="vertical-align: inherit;">Используйте их эквивалент по </font></font><a href="#lua_Integer"><code>lua_Integer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">типу (или, если возможно, используйте </font></font><a href="#lua_Integer"><code>lua_Integer</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в своем коде).
</font></font></li>

</ul>




<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9 - </font></font><a name="9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Полный синтаксис Lua</font></font></a></h1>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Вот полный синтаксис Lua в расширенном BNF. </font><font style="vertical-align: inherit;">Как обычно в расширенной BNF, {A} означает 0 или более As, а [A] означает необязательный A. (Приоритеты операторов см. В </font></font><a href="#3.4.8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§3.4.8</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; описание терминалов Name, Numeral и LiteralString см. В </font></font><a href="#3.1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">§ 3.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .)




</font></font></p><pre><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	чанк :: = блок</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	block :: = {stat} [retstat]</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	stat :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
		 varlist ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' explist |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
		 функциональный звонок | </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
		 этикетка | </font></font><font></font>
		 <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">перерыв</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> | 
		 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Перейти к</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> названию | 
		 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">сделать </font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">конец</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> блока </font><font style="vertical-align: inherit;">| 
		 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">в то время как</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exp </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">делает </font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">конец</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> блока </font><font style="vertical-align: inherit;">| 
		 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">повторять</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> блок </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">до</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> эксп | 
		 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">если</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exp, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">то</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> block { </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elseif</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exp </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">then</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> block} [ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">else</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> block] </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">end</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> | 
		 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">для</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Name « </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> » ехр « </font><font style="vertical-align: inherit;">» ехр [ « </font><font style="vertical-align: inherit;">» ехр] </font><b><font style="vertical-align: inherit;">действительно</font></b><font style="vertical-align: inherit;"> блокировать </font><b><font style="vertical-align: inherit;">конец</font></b><font style="vertical-align: inherit;"> | 
		 </font><b><font style="vertical-align: inherit;">для</font></b><font style="vertical-align: inherit;"> списка имен </font><b><font style="vertical-align: inherit;">в</font></b><font style="vertical-align: inherit;"> explist </font><b><font style="vertical-align: inherit;">сделать </font></b><b><font style="vertical-align: inherit;">конец</font></b><font style="vertical-align: inherit;"> блока </font><font style="vertical-align: inherit;">| 
		 </font><b><font style="vertical-align: inherit;">функция</font></b><font style="vertical-align: inherit;"> funcname funcbody | 
		 </font><b><font style="vertical-align: inherit;">локальная </font></b><b><font style="vertical-align: inherit;">функция</font></b><font style="vertical-align: inherit;"> Имя funcbody | 
		 </font><b><font style="vertical-align: inherit;">локальный</font></b><font style="vertical-align: inherit;"> список имен [' </font><b><font style="vertical-align: inherit;">=</font></b><font style="vertical-align: inherit;"> ' explist]</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b> <b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	retstat :: = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [explist] [' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«]</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	label :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">::</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' Name ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">::</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	funcname :: = Name {' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'Имя} [' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'Имя]</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	varlist :: = var {' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' var}</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	var :: = Имя | </font><font style="vertical-align: inherit;">prefixexp ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' exp ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">prefixexp ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' Название</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	namelist :: = Name {' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' Name}</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	explist :: = exp {' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' exp}</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	exp :: =   </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> | </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ложь</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> | </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">правда</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> | </font><font style="vertical-align: inherit;">Цифра | </font><font style="vertical-align: inherit;">LiteralString | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">functiondef |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
		 префиксexp | </font><font style="vertical-align: inherit;">столостроитель | </font><font style="vertical-align: inherit;">exp binop exp | </font><font style="vertical-align: inherit;">unop exp</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	prefixexp :: = var | </font><font style="vertical-align: inherit;">функциональный звонок | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' exp ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	functioncall :: = prefixexp args | </font><font style="vertical-align: inherit;">prefixexp ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' Name args</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	args :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' [explist] ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">столостроитель | </font><font style="vertical-align: inherit;">LiteralString</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	functiondef :: = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">function</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> funcbody</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	funcbody :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' [parlist] ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' </font><b><font style="vertical-align: inherit;">конец</font></b><font style="vertical-align: inherit;"> блока</font></font><b><font style="vertical-align: inherit;"></font></b><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	parlist :: = namelist [' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '] | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	tableconstructor :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' [fieldlist] ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	fieldlist :: = field {fieldsep field} [fieldsep]</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	поле :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' exp ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' exp | </font><font style="vertical-align: inherit;">Имя ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' exp | </font><font style="vertical-align: inherit;">ехр</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	fieldsep :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	binop :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">^</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">%</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
		 ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'| </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;&lt;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">..</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
		 ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;=</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; =</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~ =</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | 
		 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">и</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> | </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">или же</font></font></b><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	unop :: = ' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">не</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' | </font><font style="vertical-align: inherit;">' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '</font></font><font></font>
<font></font>
</pre>

<p>







</p></body>
</html>